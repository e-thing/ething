(function (root, factory) {
    if (typeof define === 'function' && define.amd) {
        // AMD. Register as an anonymous module.
        define(['jquery', 'table', 'ething', './core', 'css!font-awesome', 'css!./browser'], factory);
    } else {
        // Browser globals
        root.Browser = factory(root.jQuery, root.Table, root.EThing);
    }
}(this, function ($, Table, EThing, UI) {
	
	
	function inherits(extended, parent){
		extended.prototype = Object.create(parent.prototype);
	};
	
	
	
	/*
	* Browser
	*/
	
	function generateSvgResourceIcon(resource, square, style){
		var content, type = typeof resource == 'string' ? resource : resource.baseType();
		if(resource instanceof EThing.Device.RTSP) {
			content = '<path transform="scale(0.05) translate(120,120)" stroke-width="0" d="M395.928,187.794l-272.1-135.687c-5.358-2.669-11.866-0.494-14.538,4.864L51.24,173.379 c-1.283,2.573-1.491,5.55-0.579,8.276c0.912,2.727,2.869,4.979,5.443,6.262l81.242,40.511l-7.208,14.455    c-2.671,5.358-0.494,11.866,4.864,14.538l2.561,1.278l-13.998,24.929H41.027C33.351,268.782,17.867,258.626,0,258.626v92.338 c17.454,0,32.642-9.688,40.49-23.978h95.766c7.838,0,15.065-4.229,18.903-11.063l21.255-37.85l3.695,1.842 c5.357,2.671,11.867,0.493,14.539-4.863l7.208-14.455l60.7,30.271c3.501,1.746,7.671,1.471,10.911-0.723l16.753-11.332 l29.912,14.916c1.518,0.758,3.174,1.14,4.837,1.14c1.159,0,2.32-0.188,3.439-0.562c2.727-0.91,4.979-2.869,6.262-5.441 l30.624-61.413l31.757-20.903c3.239-2.132,5.092-5.832,4.86-9.702C401.679,192.976,399.397,189.525,395.928,187.794z"/>';
		} else if(resource instanceof EThing.Device.Http && resource.url()) {
			content = '<path transform="scale(0.03) translate(270,270)" stroke-width="0" d="M349.938,127.345c0,12.539,10.18,22.715,22.717,22.715  c12.535,0,22.711-10.177,22.711-22.715c0-12.536-10.176-22.713-22.711-22.713C360.118,104.632,349.938,114.809,349.938,127.345z   M349.938,272.715c0,12.537,10.18,22.712,22.717,22.712c12.535,0,22.711-10.175,22.711-22.712c0-12.54-10.176-22.715-22.711-22.715  C360.118,250,349.938,260.175,349.938,272.715z M31.949,331.771c0,20.074,16.264,36.341,36.34,36.341h154.454v25.072  c-4.453,2.999-8.269,6.815-11.268,11.268H100.089c-12.537,0-22.714,10.179-22.714,22.716c0,12.535,10.177,22.711,22.714,22.711  h111.386c7.355,10.997,19.804,18.172,33.981,18.172c14.18,0,26.616-7.175,33.983-18.172h120.469  c12.54,0,22.715-10.176,22.715-22.711c0-12.537-10.175-22.716-22.715-22.716H279.44c-3-4.452-6.817-8.269-11.269-11.268v-25.072  h163.539c20.078,0,36.34-16.267,36.34-36.341V68.29c0-20.077-16.262-36.34-36.34-36.34H68.29c-20.077,0-36.34,16.264-36.34,36.34  V331.771z M97.367,77.375h305.267c11.084,0,19.99,8.905,19.99,19.991v59.959c0,11.086-8.906,19.991-19.99,19.991H97.367  c-11.083,0-19.991-8.905-19.991-19.991V97.367C77.375,86.28,86.284,77.375,97.367,77.375z M97.367,222.744h305.267  c11.084,0,19.99,8.904,19.99,19.989v59.961c0,11.081-8.906,19.991-19.99,19.991H97.367c-11.083,0-19.991-8.91-19.991-19.991v-59.961  C77.375,231.648,86.284,222.744,97.367,222.744z" />';
		} else if (resource instanceof EThing.Device.MySensorsSensor && resource.sensorType() === 'S_TEMP') {
			content = '<g transform="scale(0.04) translate(120,120)" stroke-width="0"><path d="M305.949,424.6c0-1.9,0-1.9,0-3.799V229.5c0-11.5-7.6-19.1-19.099-19.1c-11.5,0-19.1,9.6-19.1,19.1v191.199c0,1.9,0,1.9,0,3.801c-23,7.699-38.2,28.699-38.2,53.5c0,32.5,24.9,57.4,57.4,57.4c32.499,0,57.399-24.9,57.399-57.4C344.25,453.301,328.949,432.301,305.949,424.6z"/><path d="M344.25,401.699V57.4c0-32.5-24.9-57.4-57.4-57.4c-32.5,0-57.4,26.8-57.4,57.4v344.2c-23,17.201-38.2,45.9-38.2,76.5c0,53.5,42.1,95.6,95.6,95.6c53.5,0,95.599-42.1,95.599-95.6C382.449,447.5,367.15,418.9,344.25,401.699z M286.85,554.699c-42.1,0-76.5-34.398-76.5-76.5c0-28.699,15.3-53.5,38.2-66.898V57.4c0-21,17.2-38.2,38.2-38.2s38.199,17.2,38.199,38.2v353.799c23,13.4,38.201,38.201,38.201,66.9C363.35,520.199,328.949,554.699,286.85,554.699z"/>';
		} else if(resource instanceof EThing.Device.MySensorsSensor && resource.sensorType() === 'S_HUM') {
			content = '<g transform="scale(0.06) translate(100,100)" stroke-width="0">	<path d="M209.306,50.798c-2.452-3.337-7.147-4.055-10.485-1.602c-3.338,2.453-4.055,7.147-1.603,10.485		c54.576,74.266,66.032,123.541,66.032,151.8c0,27.691-8.272,52.794-23.293,70.685c-17.519,20.866-42.972,31.446-75.651,31.446		c-73.031,0-98.944-55.018-98.944-102.131c0-52.227,28.103-103.234,51.679-136.829c25.858-36.847,52.11-61.415,52.37-61.657		c3.035-2.819,3.209-7.565,0.39-10.6c-2.819-3.034-7.565-3.209-10.599-0.39c-1.11,1.031-27.497,25.698-54.254,63.765		c-24.901,35.428-54.586,89.465-54.586,145.71c0,31.062,9.673,59.599,27.236,80.353c20.361,24.061,50.345,36.779,86.708,36.779		c36.794,0,66.926-12.726,87.139-36.801c17.286-20.588,26.806-49.117,26.806-80.33C278.25,156.216,240.758,93.597,209.306,50.798z"		/>	<path d="M198.43,148.146l-95.162,95.162c-2.929,2.929-2.929,7.678,0,10.606c1.465,1.464,3.385,2.197,5.304,2.197		s3.839-0.732,5.304-2.197l95.162-95.162c2.929-2.929,2.929-7.678,0-10.606C206.107,145.217,201.359,145.217,198.43,148.146z"/>	<path d="M191.965,207.899c-13.292,0-24.106,10.814-24.106,24.106s10.814,24.106,24.106,24.106s24.106-10.814,24.106-24.106		S205.257,207.899,191.965,207.899z M191.965,241.111c-5.021,0-9.106-4.085-9.106-9.106s4.085-9.106,9.106-9.106		s9.106,4.085,9.106,9.106S196.986,241.111,191.965,241.111z"/>	<path d="M125.178,194.162c13.292,0,24.106-10.814,24.106-24.106s-10.814-24.106-24.106-24.106s-24.106,10.814-24.106,24.106		S111.886,194.162,125.178,194.162z M125.178,160.949c5.021,0,9.106,4.085,9.106,9.106s-4.085,9.106-9.106,9.106		c-5.021,0-9.106-4.085-9.106-9.106S120.156,160.949,125.178,160.949z"/></g>';
		} else if(resource instanceof EThing.Device.MySensorsSensor && resource.sensorType() === 'S_BARO') {
			content = '<g transform="scale(0.04) translate(160,160)" stroke-width="0"><path d="M401.17,68.83C356.785,24.444,297.771,0,235,0S113.215,24.444,68.83,68.83C24.444,113.216,0,172.229,0,235s24.444,121.784,68.83,166.17C113.215,445.556,172.229,470,235,470s121.785-24.444,166.17-68.83C445.556,356.784,470,297.771,470,235S445.556,113.216,401.17,68.83z M235,455c-121.309,0-220-98.691-220-220S113.691,15,235,15s220,98.691,220,220S356.309,455,235,455z"/><path d="M235,30C121.962,30,30,121.963,30,235s91.962,205,205,205s205-91.963,205-205S348.038,30,235,30z M235,425c-104.766,0-190-85.233-190-190S130.234,45,235,45s190,85.233,190,190S339.766,425,235,425z"/><path d="M369.968,157.838c-0.092-0.198-0.19-0.395-0.301-0.588c-0.136-0.235-0.283-0.458-0.439-0.673c-13.509-23.033-32.772-42.296-55.805-55.805c-0.214-0.156-0.438-0.304-0.673-0.439c-0.193-0.111-0.389-0.208-0.587-0.301C289.41,86.974,263.062,79.5,235,79.5c-28.063,0-54.412,7.474-77.165,20.534c-0.197,0.092-0.393,0.189-0.585,0.299c-0.235,0.136-0.458,0.283-0.673,0.439c-23.033,13.509-42.296,32.772-55.805,55.805c-0.156,0.214-0.304,0.438-0.439,0.673c-0.111,0.193-0.209,0.39-0.301,0.588C86.974,180.59,79.5,206.938,79.5,235c0,27.312,7.215,54.195,20.873,77.762c0.385,0.66,3.967,6.332,11.159,2.183l20.697-11.949c3.587-2.071,4.816-6.658,2.745-10.245c-2.071-3.588-6.658-4.815-10.245-2.745c0,0-8.613,4.973-14.966,8.641c-8.874-17.413-14.004-36.571-15.052-56.146H112c4.142,0,7.5-3.357,7.5-7.5s-3.358-7.5-7.5-7.5H94.701c1.063-20.119,6.379-39.128,15.062-56.146l14.966,8.641c1.181,0.682,2.471,1.006,3.743,1.006c2.592,0,5.113-1.345,6.502-3.751c2.071-3.587,0.842-8.174-2.745-10.245l-14.94-8.625c10.696-16.377,24.713-30.394,41.09-41.09l8.625,14.939c1.389,2.406,3.91,3.751,6.502,3.751c1.272,0,2.562-0.324,3.743-1.006c3.587-2.071,4.816-6.658,2.745-10.245l-8.641-14.966c17.017-8.683,36.027-13.999,56.145-15.062V112c0,4.143,3.358,7.5,7.5,7.5s7.5-3.357,7.5-7.5V94.701c20.119,1.063,39.128,6.379,56.145,15.062l-8.641,14.966c-2.071,3.587-0.842,8.174,2.745,10.245c1.181,0.682,2.471,1.006,3.743,1.006c2.592,0,5.113-1.345,6.502-3.751l8.625-14.939c16.377,10.697,30.394,24.713,41.09,41.09l-14.94,8.625c-3.587,2.071-4.816,6.658-2.745,10.245c1.389,2.406,3.91,3.751,6.502,3.751c1.272,0,2.562-0.324,3.743-1.006l14.966-8.641c8.683,17.017,13.998,36.027,15.062,56.146H358c-4.142,0-7.5,3.357-7.5,7.5s3.358,7.5,7.5,7.5h17.29c-1.048,19.561-6.172,38.723-15.034,56.156l-14.984-8.651c-3.588-2.071-8.174-0.843-10.245,2.745c-2.071,3.587-0.842,8.174,2.745,10.245l21.651,12.5c1.181,0.682,2.47,1.006,3.743,1.006c2.59,0,5.11-1.344,6.5-3.748c13.63-23.58,20.835-50.467,20.835-77.753C390.5,206.938,383.026,180.59,369.968,157.838z"/><path d="M260.554,189.15c-3.618-2.01-8.179-0.71-10.192,2.904l-11.582,20.769c-1.23-0.209-2.491-0.324-3.78-0.324c-12.407,0-22.5,10.094-22.5,22.5c0,1.404,0.136,2.776,0.383,4.109l-62.173,35.896c-3.587,2.071-4.816,6.658-2.745,10.245c1.389,2.406,3.91,3.751,6.502,3.751c1.272,0,2.562-0.324,3.743-1.006l62.184-35.902c3.934,3.367,9.035,5.407,14.607,5.407c9.66,0,17.915-6.12,21.098-14.685l23.775,0.354c0.038,0.001,0.076,0.001,0.114,0.001c4.085,0,7.429-3.277,7.497-7.376c0.157-9.47-2.27-18.821-7.018-27.045C275.719,200.527,268.833,193.75,260.554,189.15z M235,242.5c-4.136,0-7.5-3.364-7.5-7.5s3.364-7.5,7.5-7.5c1.302,0,2.528,0.335,3.596,0.921c0.019,0.011,0.035,0.023,0.054,0.034c2.297,1.29,3.85,3.738,3.85,6.545c0,0.032-0.004,0.064-0.005,0.096C242.432,239.197,239.097,242.5,235,242.5z M256.317,227.817c-0.966-2.858-2.489-5.461-4.443-7.677l7.571-13.576c3.188,2.737,5.908,6.009,8.031,9.686c2.123,3.678,3.596,7.669,4.373,11.799L256.317,227.817z"/><path d="M261.147,375.5h-52.294c-4.142,0-7.5,3.357-7.5,7.5s3.358,7.5,7.5,7.5h52.294c4.142,0,7.5-3.357,7.5-7.5S265.289,375.5,261.147,375.5z"/><path d="M251.147,360.5c4.142,0,7.5-3.357,7.5-7.5s-3.358-7.5-7.5-7.5h-32.294c-4.142,0-7.5,3.357-7.5,7.5s3.358,7.5,7.5,7.5H251.147z"/></g>';
		} else if(resource instanceof EThing.Device.MySensorsSensor && resource.sensorType() === 'S_SPRINKLER') {
			content = '<g transform="scale(0.04) translate(160,160)" stroke-width="0"><path d="M222.254,41.992c-14.017-12.749-30.196-22.23-48.087-28.178c-5.433-1.802-11.299,1.132-13.106,6.566c-1.804,5.433,1.134,11.3,6.567,13.107c15.128,5.03,28.814,13.05,40.677,23.841c1.987,1.807,4.482,2.698,6.972,2.698c2.817,0,5.626-1.143,7.67-3.391C226.799,52.399,226.491,45.843,222.254,41.992z"/><path d="M38.242,58.874c-4.578-3.43-11.077-2.503-14.511,2.076C12.364,76.111,4.469,93.123,0.263,111.513c-1.275,5.581,2.212,11.14,7.794,12.417c0.777,0.177,1.554,0.263,2.321,0.263c4.725,0,8.996-3.254,10.095-8.056c3.556-15.543,10.231-29.927,19.845-42.751C43.752,68.805,42.823,62.308,38.242,58.874z"/><path d="M130.104,16.899c-0.537-5.7-5.623-9.881-11.294-9.347C99.975,9.329,82.075,14.931,65.609,24.2c-4.99,2.809-6.757,9.129-3.948,14.118c1.903,3.381,5.418,5.281,9.042,5.281c1.721,0,3.467-0.429,5.074-1.334c13.921-7.837,29.054-12.572,44.982-14.074C126.458,27.654,130.641,22.598,130.104,16.899z"/><path d="M446.391,24.2c-16.467-9.27-34.366-14.871-53.201-16.648c-5.691-0.533-10.758,3.647-11.294,9.347c-0.536,5.699,3.647,10.755,9.345,11.293c15.928,1.502,31.061,6.237,44.982,14.074c1.607,0.905,3.353,1.334,5.074,1.334c3.621,0,7.139-1.901,9.042-5.281C453.148,33.33,451.382,27.009,446.391,24.2z"/><path d="M350.939,20.379c-1.807-5.433-7.693-8.367-13.106-6.566c-17.891,5.948-34.07,15.429-48.087,28.178c-4.236,3.852-4.545,10.407-0.693,14.642c2.045,2.249,4.854,3.391,7.67,3.391c2.49,0,4.985-0.891,6.972-2.698c11.863-10.791,25.549-18.811,40.677-23.841C349.805,31.679,352.743,25.812,350.939,20.379z"/><path d="M270.804,81.891c-5.228-2.317-11.36,0.042-13.675,5.279c-0.401,0.905-0.748,1.826-1.129,2.737c-0.38-0.911-0.728-1.832-1.129-2.737c-2.318-5.233-8.445-7.597-13.675-5.279c-5.233,2.319-7.597,8.442-5.279,13.675c6.448,14.555,9.718,30.078,9.718,46.137v51.827c0,5.724,4.641,10.365,10.365,10.365s10.365-4.641,10.365-10.365v-51.827c0-16.059,3.269-31.582,9.718-46.137C278.401,90.333,276.038,84.21,270.804,81.891z"/><path d="M511.737,111.513c-4.206-18.39-12.101-35.402-23.469-50.563c-3.432-4.582-9.928-5.507-14.511-2.076c-4.581,3.434-5.509,9.931-2.075,14.512c9.614,12.824,16.289,27.208,19.845,42.751c1.098,4.802,5.37,8.056,10.095,8.056c0.767,0,1.544-0.086,2.321-0.263C509.525,122.653,513.012,117.094,511.737,111.513z"/><path d="M256,442.301c-5.724,0-10.365,4.641-10.365,10.365v41.462c0,5.724,4.641,10.365,10.365,10.365s10.365-4.641,10.365-10.365v-41.462C266.366,446.942,261.724,442.301,256,442.301z"/><path d="M256,234.992c-5.724,0-10.365,4.641-10.365,10.365v51.827c0,5.724,4.641,10.365,10.365,10.365s10.365-4.641,10.365-10.365v-51.827C266.366,239.633,261.724,234.992,256,234.992z"/><path d="M256,338.647c-5.724,0-10.365,4.641-10.365,10.365v51.827c0,5.724,4.641,10.365,10.365,10.365s10.365-4.641,10.365-10.365v-51.827C266.366,343.288,261.724,338.647,256,338.647z"/></g>';
		} else if(resource instanceof EThing.Device.MySensorsSensor && resource.sensorType() === 'S_WATER') {
			content = '<g transform="scale(0.05) translate(160,160)" stroke-width="0"><path d="M320.392,18.183c-10.189,0-18.446,8.259-18.446,18.446V62.78l-34.756,20.882c-2.774,1.675-9.344,1.618-12.105-0.129l-25.646-16.12c-14.327-9.01-35.53-9.716-50.416-1.693l-33.931,18.27c-2.963,1.597-9.764,1.267-12.568-0.604l-22.83-15.255c-14.261-9.529-35.542-10.496-50.612-2.293L36.894,77.921V36.629c0-10.187-8.256-18.446-18.447-18.446C8.26,18.183,0,26.442,0,36.629v247.134c0,20.35,16.549,36.893,36.894,36.893h265.052c20.345,0,36.894-16.543,36.894-36.893V36.629C338.839,26.442,330.576,18.183,320.392,18.183z M301.945,283.775H36.888V119.937l39.833-21.695c2.933-1.591,9.686-1.297,12.466,0.567l22.83,15.255c14.234,9.511,35.503,10.526,50.575,2.408l33.921-18.267c3.111-1.666,10.305-1.438,13.295,0.447l25.652,16.123c14.604,9.182,35.957,9.403,50.74,0.511l15.751-9.464v177.952H301.945z"/><path d="M178.69,148.484c-5.125-5.122-13.417-5.122-18.54,0l-40.172,40.175c-5.122,5.116-3.399,9.271,3.837,9.271h19.38v39.325c0,7.236,5.873,13.109,13.112,13.109h26.213c7.242,0,13.115-5.873,13.115-13.109V197.93h19.383c7.23,0,8.96-4.155,3.831-9.271L178.69,148.484z"/></g>';
		} else if(resource instanceof EThing.Device.MySensorsSensor && resource.sensorType() === 'S_CAM') {
			content = '<g transform="scale(0.03) translate(250,250)" stroke-width="0"><path d="M526.76,131.045c-14.277-14.274-31.498-21.413-51.675-21.413h-63.953l-14.558-38.826c-3.618-9.325-10.229-17.368-19.846-24.128c-9.613-6.757-19.462-10.138-29.551-10.138H200.996c-10.088,0-19.939,3.381-29.552,10.138c-9.613,6.76-16.225,14.803-19.842,24.128l-14.56,38.826H73.089c-20.179,0-37.401,7.139-51.678,21.413C7.137,145.32,0,162.544,0,182.721v255.813c0,20.178,7.137,37.404,21.411,51.675c14.277,14.277,31.5,21.416,51.678,21.416h401.989c20.177,0,37.397-7.139,51.675-21.416c14.273-14.271,21.412-31.497,21.412-51.675V182.721C548.169,162.544,541.03,145.32,526.76,131.045z M364.446,400.993c-25.029,25.03-55.147,37.548-90.362,37.548s-65.331-12.518-90.362-37.548c-25.031-25.026-37.544-55.151-37.544-90.358c0-35.218,12.517-65.333,37.544-90.364c25.028-25.031,55.148-37.544,90.362-37.544s65.333,12.516,90.362,37.544c25.03,25.028,37.545,55.146,37.545,90.364C401.991,345.842,389.477,375.964,364.446,400.993z"/><path d="M274.084,228.403c-22.651,0-42.018,8.042-58.102,24.128c-16.084,16.084-24.126,35.448-24.126,58.104c0,22.647,8.042,42.014,24.126,58.098c16.084,16.081,35.45,24.123,58.102,24.123c22.648,0,42.017-8.042,58.101-24.123c16.084-16.084,24.127-35.45,24.127-58.098c0-22.655-8.043-42.019-24.127-58.104C316.102,236.446,296.732,228.403,274.084,228.403z"/></g>';
		} else if(resource instanceof EThing.Device.RFLinkSwitch || (resource instanceof EThing.Device.MySensorsSensor && resource.sensorType() === 'S_BINARY')) {
			content = '<g transform="scale(0.03) translate(220,220)" stroke-width="0"><path d="M178.624,242.367c-38.651,0-58.198,30.622-58.198,63.656c0,32.971,19.563,63.623,58.198,63.623c38.619,0,58.23-30.67,58.23-63.623C236.854,272.99,217.227,242.367,178.624,242.367z M178.624,351.625c-26.989,0-38.333-23.277-38.333-45.584c0-22.356,11.344-45.632,38.333-45.632c26.989,0,38.333,23.276,38.333,45.632C216.958,328.348,205.613,351.625,178.624,351.625z"/><path d="M592.611,136.855H19.436C8.711,136.855,0,145.518,0,156.26v299.511c0,10.758,8.711,19.389,19.436,19.389h573.175c10.726,0,19.404-8.631,19.404-19.389V156.26C612,145.518,603.321,136.855,592.611,136.855z M436.01,251.062h23.244v116.412H436.01V251.062z M38.793,175.665h264.113v260.701H38.793V175.665z"/></g>';
		} else if(resource instanceof EThing.Device.MySensorsSensor && (resource.sensorType() === 'S_LIGHT' || resource.sensorType() === 'S_RGB_LIGHT' || resource.sensorType() === 'S_RGBW_LIGHT')) {
			content = '<g transform="scale(0.6) translate(10,10)" ><path d="M21.59,23.694L21.59,23.694l-10.413-0.003c-0.253,0-0.467-0.189-0.497-0.441c-0.121-1.022-0.478-2.465-1.499-3.526c-0.001-0.002-0.002-0.003-0.004-0.005c-2.524-2.132-3.971-5.241-3.971-8.54C5.207,5.015,10.222,0,16.385,0s11.178,5.015,11.178,11.179c0,3.321-1.465,6.449-4.019,8.581c-0.98,1.026-1.337,2.47-1.458,3.493C22.058,23.505,21.844,23.694,21.59,23.694z M11.611,22.691l9.545,0.003c0.187-1.127,0.64-2.552,1.708-3.664c2.366-1.979,3.7-4.828,3.7-7.852C26.563,5.566,21.998,1,16.385,1S6.207,5.566,6.207,11.179c0,3.021,1.333,5.869,3.659,7.812c0.03,0.025,0.057,0.054,0.08,0.085C10.983,20.18,11.426,21.58,11.611,22.691z"/><path d="M21.59,26.718H11.177c-0.276,0-0.5-0.224-0.5-0.5s0.224-0.5,0.5-0.5H21.59c0.276,0,0.5,0.224,0.5,0.5S21.867,26.718,21.59,26.718z"/><path d="M21.59,29.744H11.177c-0.276,0-0.5-0.224-0.5-0.5s0.224-0.5,0.5-0.5H21.59c0.276,0,0.5,0.224,0.5,0.5S21.867,29.744,21.59,29.744z"/><path d="M18.564,32.771h-4.36c-0.276,0-0.5-0.224-0.5-0.5s0.224-0.5,0.5-0.5h4.36c0.276,0,0.5,0.224,0.5,0.5S18.84,32.771,18.564,32.771z"/></g>';
		} else if(resource instanceof EThing.Device.MySensorsSensor && resource.sensorType() === 'S_DOOR') {
			content = '<path transform="scale(0.04) translate(150,150)" stroke-width="0" d="M184.646,0v21.72H99.704v433.358h31.403V53.123h53.539V492.5l208.15-37.422v-61.235V37.5L184.646,0z M222.938,263.129c-6.997,0-12.67-7.381-12.67-16.486c0-9.104,5.673-16.485,12.67-16.485s12.67,7.381,12.67,16.485C235.608,255.748,229.935,263.129,222.938,263.129z"/>';
		} else if(resource instanceof EThing.Device.MySensorsSensor && resource.sensorType() === 'S_LOCK') {
			content = '<path transform="scale(0.04) translate(190,180)" stroke-width="0" d="M357.45,190.721c-5.331-5.33-11.8-7.993-19.417-7.993h-9.131v-54.821c0-35.022-12.559-65.093-37.685-90.218C266.093,12.563,236.025,0,200.998,0c-35.026,0-65.1,12.563-90.222,37.688C85.65,62.814,73.091,92.884,73.091,127.907v54.821h-9.135c-7.611,0-14.084,2.663-19.414,7.993c-5.33,5.326-7.994,11.799-7.994,19.417V374.59c0,7.611,2.665,14.086,7.994,19.417c5.33,5.325,11.803,7.991,19.414,7.991H338.04c7.617,0,14.085-2.663,19.417-7.991c5.325-5.331,7.994-11.806,7.994-19.417V210.135C365.455,202.523,362.782,196.051,357.45,190.721z M274.087,182.728H127.909v-54.821c0-20.175,7.139-37.402,21.414-51.675c14.277-14.275,31.501-21.411,51.678-21.411c20.179,0,37.399,7.135,51.677,21.411c14.271,14.272,21.409,31.5,21.409,51.675V182.728z"/>';
		} else if(resource instanceof EThing.Device.MySensorsSensor && resource.sensorType() === 'S_RAIN') {
			content = '<g transform="scale(0.04) translate(150,150)" stroke-width="0"><path d="M256,152.408V120h-16v32.408C151.088,156.624,80,230.064,80,320v16h16c0-17.648,14.352-32,32-32s32,14.352,32,32h16c0-17.648,14.352-32,32-32s32,14.352,32,32v128c0,17.648,14.352,32,32,32s32-14.352,32-32v-16h-16v16c0,8.824-7.176,16-16,16c-8.824,0-16-7.176-16-16V336c0-17.648,14.352-32,32-32s32,14.352,32,32h16c0-17.648,14.352-32,32-32s32,14.352,32,32h16v-16C416,230.064,344.912,156.624,256,152.408z M160.464,300.664C151.912,292.808,140.504,288,128,288c-11.6,0-22.248,4.136-30.552,11.008c9.104-65.616,60.28-117.872,125.304-128.808C186.248,204.016,163.792,250.696,160.464,300.664z M288,288c-16.672,0-31.392,8.544-40,21.496C239.392,296.544,224.672,288,208,288c-12.016,0-22.968,4.48-31.4,11.808c3.984-51.376,29.952-98.792,71.4-129.824c41.448,31.032,67.416,78.448,71.4,129.824C310.968,292.488,300.016,288,288,288z M368,288c-12.504,0-23.912,4.808-32.464,12.672c-3.328-49.968-25.784-96.648-62.288-130.464c65.024,10.928,116.2,63.192,125.304,128.808C390.248,292.136,379.6,288,368,288z"/><rect x="384" width="16" height="32"/><rect x="288" width="16" height="32"/><rect x="192" width="16" height="32"/><rect x="384" y="96" width="16" height="32"/><rect x="384" y="48" width="16" height="32"/><rect x="336" y="72" width="16" height="32"/><rect x="384" y="144" width="16" height="32"/><rect x="336" y="120" width="16" height="32"/><rect x="336" y="24" width="16" height="32"/><rect x="288" y="96" width="16" height="32"/><rect x="288" y="48" width="16" height="32"/><rect x="240" y="72" width="16" height="32"/><rect x="240" y="24" width="16" height="32"/><rect x="192" y="96" width="16" height="32"/><rect x="192" y="48" width="16" height="32"/><rect x="144" y="72" width="16" height="32"/><rect x="144" y="120" width="16" height="32"/><rect x="144" y="24" width="16" height="32"/><rect x="96" y="48" width="16" height="32"/><rect x="96" y="96" width="16" height="32"/><rect x="96" y="144" width="16" height="32"/><rect x="96" width="16" height="32"/></g>';
		} else if(resource instanceof EThing.Device.MySensorsSensor && resource.sensorType() === 'S_MOISTURE') {
			content = '<path transform="scale(0.4) translate(15,15)" stroke-width="0" d="M 31 1.28125 L 30.1875 2.40625 C 30.1875 2.40625 28.905933 4.1737068 27.625 6.4375 C 26.344067 8.7012932 25 11.40975 25 13.78125 C 25 17.181998 27.67447 20 31 20 C 34.32553 20 37 17.181998 37 13.78125 C 37 11.40975 35.655933 8.7012932 34.375 6.4375 C 33.094067 4.1737068 31.8125 2.40625 31.8125 2.40625 L 31 1.28125 z M 31 4.875 C 31.451815 5.533411 31.812289 6.0011955 32.625 7.4375 C 33.844067 9.5919568 35 12.26775 35 13.78125 C 35 16.146502 33.19647 18 31 18 C 28.80353 18 27 16.146502 27 13.78125 C 27 12.26775 28.155933 9.5919568 29.375 7.4375 C 30.187711 6.0011955 30.548185 5.533411 31 4.875 z M 19.5 11.90625 A 1.0001 1.0001 0 0 0 19.375 11.9375 A 1.0001 1.0001 0 0 0 18.8125 12.28125 C 18.801394 12.292205 18.791946 12.300919 18.78125 12.3125 C 17.427135 13.545812 15.30328 14 14 14 C 12.751304 14 10.763698 13.559697 9.40625 12.4375 A 1.0001 1.0001 0 0 0 8.40625 11.96875 A 1.0001 1.0001 0 0 0 8.3125 12 A 1.0001 1.0001 0 0 0 7.9375 12.15625 A 1.0001 1.0001 0 0 0 7.875 12.1875 A 1.0001 1.0001 0 0 0 7.875 12.21875 A 1.0001 1.0001 0 0 0 7.8125 12.25 A 1.0001 1.0001 0 0 0 7.8125 12.28125 A 1.0001 1.0001 0 0 0 7.6875 12.40625 C 6.3307716 13.573266 4.2717899 14 3 14 A 1.0001 1.0001 0 1 0 3 16 C 4.5444336 16 6.7036338 15.570147 8.5 14.25 C 10.29695 15.569994 12.456328 16 14 16 C 15.540017 16 17.706606 15.592425 19.5 14.28125 C 20.822719 15.235053 22.427068 15.727348 23.8125 15.90625 C 23.6275 15.24625 23.505 14.56375 23.5 13.84375 C 22.498427 13.645375 21.415907 13.247281 20.53125 12.5625 A 1.0001 1.0001 0 0 0 19.5 11.90625 z M 41.34375 12 A 1.0001 1.0001 0 0 0 40.8125 12.28125 C 40.801594 12.291386 40.792244 12.302469 40.78125 12.3125 A 1.0001 1.0001 0 0 0 40.75 12.34375 C 40.095525 12.930047 39.307653 13.328724 38.5 13.59375 C 38.502 13.65775 38.5 13.71725 38.5 13.78125 C 38.5 14.45625 38.409 15.09475 38.25 15.71875 C 39.35544 15.45965 40.497653 14.97768 41.5 14.25 C 43.29695 15.569994 45.456328 16 47 16 A 1.0001 1.0001 0 1 0 47 14 C 45.697852 14 43.573989 13.546096 42.21875 12.3125 C 42.208025 12.300919 42.198632 12.292207 42.1875 12.28125 A 1.0001 1.0001 0 0 0 41.90625 12.09375 C 41.885333 12.084331 41.865153 12.070411 41.84375 12.0625 A 1.0001 1.0001 0 0 0 41.34375 12 z M 19.5625 22.90625 A 1.0001 1.0001 0 0 0 19.375 22.9375 A 1.0001 1.0001 0 0 0 19.09375 23.0625 A 1.0001 1.0001 0 0 0 19.03125 23.09375 A 1.0001 1.0001 0 0 0 18.6875 23.40625 C 17.330771 24.573266 15.27179 25 14 25 C 12.739802 25 10.701578 24.583141 9.34375 23.4375 A 1.0001 1.0001 0 0 0 9.1875 23.28125 A 1.0001 1.0001 0 0 0 9.15625 23.21875 A 1.0001 1.0001 0 0 0 8.9375 23.09375 A 1.0001 1.0001 0 0 0 8.90625 23.0625 A 1.0001 1.0001 0 0 0 8.84375 23.0625 A 1.0001 1.0001 0 0 0 8.8125 23.03125 A 1.0001 1.0001 0 0 0 8.75 23.03125 A 1.0001 1.0001 0 0 0 8.71875 23 A 1.0001 1.0001 0 0 0 8.65625 23 A 1.0001 1.0001 0 0 0 8.625 23 A 1.0001 1.0001 0 0 0 8.3125 23 A 1.0001 1.0001 0 0 0 7.9375 23.15625 A 1.0001 1.0001 0 0 0 7.875 23.1875 A 1.0001 1.0001 0 0 0 7.875 23.21875 A 1.0001 1.0001 0 0 0 7.8125 23.25 A 1.0001 1.0001 0 0 0 7.8125 23.28125 A 1.0001 1.0001 0 0 0 7.6875 23.40625 C 6.3307716 24.573266 4.2717899 25 3 25 A 1.0001 1.0001 0 1 0 3 27 C 4.5444336 27 6.7036338 26.570147 8.5 25.25 C 10.29695 26.569994 12.456328 27 14 27 C 15.544433 27 17.703634 26.570147 19.5 25.25 C 21.29695 26.569994 23.456328 27 25 27 C 26.544433 27 28.703634 26.570147 30.5 25.25 C 32.29695 26.569994 34.456328 27 36 27 C 37.544433 27 39.703634 26.570147 41.5 25.25 C 43.29695 26.569994 45.456328 27 47 27 A 1.0001 1.0001 0 1 0 47 25 C 45.787503 25 43.853303 24.612786 42.5 23.5625 A 1.0001 1.0001 0 0 0 41.375 22.9375 A 1.0001 1.0001 0 0 0 41.03125 23.09375 A 1.0001 1.0001 0 0 0 40.6875 23.40625 C 39.330771 24.573266 37.27179 25 36 25 C 34.787503 25 32.853303 24.612786 31.5 23.5625 A 1.0001 1.0001 0 0 0 30.09375 23.0625 A 1.0001 1.0001 0 0 0 30.0625 23.09375 A 1.0001 1.0001 0 0 0 30.03125 23.09375 A 1.0001 1.0001 0 0 0 29.78125 23.3125 C 29.770344 23.322433 29.761005 23.333918 29.75 23.34375 A 1.0001 1.0001 0 0 0 29.6875 23.40625 C 28.330771 24.573266 26.27179 25 25 25 C 23.787503 25 21.853303 24.612786 20.5 23.5625 A 1.0001 1.0001 0 0 0 20.5 23.53125 A 1.0001 1.0001 0 0 0 19.5625 22.90625 z M 19 29.28125 L 18.1875 30.40625 C 18.1875 30.40625 16.905933 32.173707 15.625 34.4375 C 14.344067 36.701293 13 39.40975 13 41.78125 C 13 45.181998 15.67447 48 19 48 C 22.32553 48 25 45.181998 25 41.78125 C 25 39.40975 23.655933 36.701293 22.375 34.4375 C 21.094067 32.173707 19.8125 30.40625 19.8125 30.40625 L 19 29.28125 z M 19 32.875 C 19.451815 33.533411 19.812289 34.001195 20.625 35.4375 C 21.844067 37.591957 23 40.26775 23 41.78125 C 23 44.146502 21.19647 46 19 46 C 16.80353 46 15 44.146502 15 41.78125 C 15 40.26775 16.155933 37.591957 17.375 35.4375 C 18.187711 34.001195 18.548185 33.533411 19 32.875 z M 41.5625 33.90625 A 1.0001 1.0001 0 0 0 41.375 33.9375 A 1.0001 1.0001 0 0 0 41.09375 34.0625 A 1.0001 1.0001 0 0 0 41.03125 34.09375 A 1.0001 1.0001 0 0 0 40.6875 34.40625 C 39.330771 35.573266 37.27179 36 36 36 C 34.697852 36 32.573989 35.546096 31.21875 34.3125 C 31.208025 34.300919 31.198632 34.292205 31.1875 34.28125 A 1.0001 1.0001 0 0 0 31.03125 34.15625 A 1.0001 1.0001 0 0 0 30.90625 34.09375 C 30.885333 34.084345 30.865153 34.070397 30.84375 34.0625 A 1.0001 1.0001 0 0 0 30.5625 34 A 1.0001 1.0001 0 0 0 30.46875 34 A 1.0001 1.0001 0 0 0 30.34375 34 A 1.0001 1.0001 0 0 0 30.25 34.03125 A 1.0001 1.0001 0 0 0 30.15625 34.0625 A 1.0001 1.0001 0 0 0 29.8125 34.28125 C 29.80149 34.291469 29.792349 34.302386 29.78125 34.3125 A 1.0001 1.0001 0 0 0 29.6875 34.40625 C 28.311507 35.593695 26.318472 36 25 36 C 24.961 36 24.915 36.001 24.875 36 C 25.18 36.651 25.4475 37.30575 25.6875 37.96875 C 27.1885 37.851552 29.040735 37.368805 30.53125 36.28125 C 32.32142 37.580999 34.466317 38 36 38 C 37.544433 38 39.703634 37.570147 41.5 36.25 C 43.29695 37.569994 45.456328 38 47 38 A 1.0001 1.0001 0 1 0 47 36 C 45.787503 36 43.853303 35.612786 42.5 34.5625 A 1.0001 1.0001 0 0 0 42.5 34.53125 A 1.0001 1.0001 0 0 0 41.5625 33.90625 z M 8.40625 33.96875 A 1.0001 1.0001 0 0 0 8.3125 34 A 1.0001 1.0001 0 0 0 7.8125 34.28125 C 7.8013683 34.292205 7.7919748 34.300919 7.78125 34.3125 C 6.427135 35.545812 4.3032799 36 3 36 A 1.0001 1.0001 0 1 0 3 38 C 4.5400176 38 6.7066056 37.592425 8.5 36.28125 C 9.6811343 37.133472 11.072917 37.622083 12.34375 37.84375 C 12.58075 37.20475 12.86125 36.5635 13.15625 35.9375 C 11.951595 35.79561 10.504688 35.348862 9.40625 34.4375 A 1.0001 1.0001 0 0 0 8.40625 33.96875 z"></path>';
		} else if(resource instanceof EThing.Device.MySensorsSensor && resource.sensorType() === 'S_POWER') {
			content = '<g transform="scale(0.05) translate(100,100)" stroke-width="0"><path d="M390.334,205c-7.621-86.85-80.74-155.203-169.535-155.203S58.886,118.15,51.265,205H0v30h51.265c7.621,86.85,80.739,155.203,169.534,155.203S382.713,321.85,390.334,235H440v-30H390.334z M220.799,360.203c-77.308,0-140.203-62.895-140.203-140.203S143.491,79.797,220.799,79.797S361.002,142.692,361.002,220S298.107,360.203,220.799,360.203z"/><path d="M206.844,124.476L141.639,295.31h34.167l15.64-42.588h59.671l15.88,42.588h34.167l-64.965-170.834H206.844z M196.979,229.383l24.542-67.131l23.58,67.131H196.979z"/></g>';
		} else if(resource instanceof EThing.Device.MySensorsSensor && resource.sensorType() === 'S_MULTIMETER') {
			content = '<g transform="scale(0.002) translate(13000,8000) rotate(180)" stroke-width="0"><path d="M2125.7,4953.6c-132.4-65.1-253.9-191-319.1-332.1l-45.6-99.8V104.6v-4417.1l45.6-99.8c56.4-123.7,191-260.5,316.9-327.8l93.3-49.9h2778.3h2778.3l115,62.9c130.2,71.6,219.2,165,290.9,301.7l49.9,91.2L8235.8,72c6.5,4953.2,19.6,4516.9-164.9,4723.1c-58.6,65.1-147.6,134.6-210.6,162.8l-108.5,52.1H4993H2236.4L2125.7,4953.6z M7764.8,4619.3c112.9-60.8,106.4,195.3,106.4-4503.9c0-4744.8,6.5-4469.2-121.5-4521.2c-47.8-19.5-722.8-26-2780.5-21.7l-2719.7,6.5l-58.6,60.8l-60.8,58.6l-6.5,4354.1c-2.2,2982.3,2.2,4380.2,17.4,4438.8c43.4,158.4-167.1,147.6,2860.8,149.8C6827.2,4641,7736.6,4634.5,7764.8,4619.3z"></path><path d="M2878.9,2600.7V1298.4h2127.1h2127.2v1302.3V3903H5006.1H2878.9V2600.7z M6764.2,2600.7v-933.3H6074h-690.2l-497.1,622.9c-275.7,342.9-514.4,642.5-534,666.3c-34.7,43.4-36.9,41.2-180.2-71.6c-95.5-78.1-138.9-123.7-125.9-141.1c10.8-13,197.5-247.4,416.7-523.1c219.2-273.5,405.9-512.2,418.9-525.3c15.2-21.7-147.6-28.2-807.4-28.2h-827v933.3V3534h1758.1h1758.1V2600.7z"></path><path d="M3124.2,276c-149.8-43.4-271.3-236.6-236.6-375.5c32.6-128.1,191-251.8,323.4-251.8c154.1,0,336.4,210.5,308.2,356C3486.7,180.5,3280.5,319.5,3124.2,276z M3237.1-23.5c15.2-26-26-52.1-54.3-34.7C3158.9-43,3174.1-4,3204.5-4C3215.4-4,3228.4-12.6,3237.1-23.5z"></path><path d="M4932.3,278.2c-78.1-23.9-197.5-136.7-230.1-219.2c-71.6-171.5,104.2-410.2,303.9-410.2c86.8,0,175.8,47.8,245.3,128.1c69.5,84.6,91.2,178,58.6,271.3c-26,80.3-173.6,230.1-225.7,230.1c-17.4,0-43.4,4.3-60.8,8.7C5008.2,291.2,4967,286.9,4932.3,278.2z M5038.6-23.5c15.2-26-26.1-52.1-54.3-34.7C4960.5-43,4975.7-4,5006.1-4C5016.9-4,5029.9-12.6,5038.6-23.5z"></path><path d="M6709.9,258.7c-104.2-47.8-197.5-149.8-217.1-240.9c-10.9-47.8,0-95.5,36.9-169.3c123.7-251.8,395-264.8,553.5-28.2c62.9,93.3,62.9,178,2.2,288.7C6998.6,260.9,6848.9,321.6,6709.9,258.7z M6840.2-23.5c15.2-26-26.1-52.1-54.3-34.7C6762-43,6777.2-4,6807.6-4C6818.5-4,6831.5-12.6,6840.2-23.5z"></path><path d="M4769.5-1688.3c-384.2-102-701.1-449.3-768.4-842.2c-86.8-512.2,319.1-1054.9,861.7-1148.2C5490.1-3785,6117.4-3157.8,6011-2530.5C5911.2-1946.6,5312.1-1540.7,4769.5-1688.3z M5294.7-2083.3c121.6-54.3,247.5-180.1,303.9-306.1c67.3-147.6,65.1-429.8-6.5-575.2c-65.1-134.6-160.6-230.1-295.2-295.2c-145.4-71.6-427.6-73.8-575.2-6.5c-271.3,123.7-412.4,427.6-347.3,748.8c47.8,225.7,212.7,403.7,431.9,466.7C4938.8-2013.9,5173.2-2029.1,5294.7-2083.3z"></path></g>';
		} else if(resource instanceof EThing.Device.MySensorsGateway) {
			content = '<text x="16" y="17" font-size="5" font-family="Bookman Old Style" text-anchor="middle">MySensors</text>';
		} else if(resource instanceof EThing.Device.RFLinkGateway) {
			content = '<text x="16" y="17" font-size="5" font-family="Bookman Old Style" text-anchor="middle">RFLink</text>';
		} else if(resource instanceof EThing.Device.MQTT) {
			content = '<g transform="scale(0.08)"><text font-weight="bold" stroke-width="0" stroke-opacity="null" fill-opacity="null" x="92.86185" y="263.57692" font-size="24" font-family="Helvetica, Arial, sans-serif" text-anchor="start" xml:space="preserve" transform="matrix(3.761095958998766,0,0,3.710528337381942,-276.3656812632361,-615.3815860358596) " stroke="#000">MQTT</text><ellipse  cx="200" cy="200" id="svg_4" rx="34.5" ry="35"/><path stroke-width="0" transform="rotate(-45 145.000503540039,144.98031616210938) " d="m222.08805,165.16902c-0.87301,0 -1.74602,-0.34873 -2.41442,-1.03908c-41.17474,-42.97246 -108.17833,-42.96534 -149.35307,0c-1.32998,1.38782 -3.49204,1.38782 -4.82202,0s-1.32998,-3.64391 0,-5.03172c43.8347,-45.74809 115.16242,-45.74097 159.00393,0c1.32998,1.38782 1.32998,3.64391 0,5.03172c-0.6684,0.69035 -1.54141,1.03908 -2.41442,1.03908z"/><path stroke-width="0" transform="rotate(-45 124.50050354003898,123.48031616210935) " d="m225.28782,149.32539c-1.14141,0 -2.28283,-0.44644 -3.15671,-1.3302c-53.83351,-55.01224 -141.43665,-55.00312 -195.27016,0c-1.73886,1.77664 -4.56563,1.77664 -6.3045,0s-1.73886,-4.66484 0,-6.44148c57.31123,-58.56553 150.56793,-58.55643 207.88808,0c1.73886,1.77664 1.73886,4.66483 0,6.44148c-0.87389,0.88377 -2.0153,1.3302 -3.15671,1.3302z"/><path stroke-width="0" transform="rotate(-45 103.50049591064449,103.98033142089841) " d="m227.64904,136.54232c-1.40596,0 -2.81195,-0.56247 -3.88838,-1.67591c-66.31143,-69.30947 -174.21987,-69.29799 -240.5313,0c-2.14189,2.23836 -5.62388,2.23836 -7.7658,0s-2.14189,-5.87719 0,-8.11557c70.59525,-73.78623 185.46766,-73.77477 256.07388,0c2.14191,2.23837 2.14191,5.87717 0,8.11557c-1.07645,1.11344 -2.48242,1.67591 -3.88839,1.67591z"/></g>';
		} else if(resource instanceof EThing.Device.MySensorsNode) {
			content = '<g transform="scale(0.05) translate(160,160)" stroke-width="0"><path d="M266.911,109.898c-20.498,0-37.894,13.125-44.354,31.408H116.406l51.734-51.732c6.147,2.936,13,4.631,20.27,4.631c26.004,0,47.104-21.095,47.104-47.104C235.513,21.087,214.414,0,188.41,0c-26.005,0-47.104,21.087-47.104,47.102c0,7.268,1.695,14.122,4.631,20.264l-61.278,61.288c-8.59-11.383-22.201-18.747-37.558-18.747C21.093,109.906,0,130.991,0,157.007c0,26.004,21.093,47.103,47.101,47.103c15.365,0,28.968-7.361,37.558-18.755l61.278,61.286c-2.936,6.151-4.631,13.004-4.631,20.27c0,26.004,21.099,47.104,47.104,47.104c26.004,0,47.104-21.1,47.104-47.104c0-26.017-21.1-47.1-47.104-47.1c-7.27,0-14.122,1.691-20.27,4.629l-51.734-51.732h106.151c6.468,18.286,23.855,31.402,44.354,31.402c26.009,0,47.104-21.099,47.104-47.103C314.014,130.991,292.919,109.898,266.911,109.898z M188.41,31.402c8.664,0,15.701,7.025,15.701,15.699c0,8.668-7.037,15.701-15.701,15.701s-15.701-7.033-15.701-15.701C172.708,38.428,179.746,31.402,188.41,31.402z M47.102,172.708c-8.666,0-15.699-7.037-15.699-15.701c0-8.674,7.033-15.701,15.699-15.701c8.668,0,15.701,7.027,15.701,15.701C62.803,165.671,55.77,172.708,47.102,172.708z M188.41,251.214c8.664,0,15.701,7.021,15.701,15.697c0,8.664-7.037,15.701-15.701,15.701s-15.701-7.037-15.701-15.701C172.708,258.234,179.746,251.214,188.41,251.214zM266.911,172.708c-8.66,0-15.697-7.037-15.697-15.701c0-8.674,7.037-15.701,15.697-15.701c8.664,0,15.701,7.027,15.701,15.701C282.612,165.671,275.575,172.708,266.911,172.708z"/></g>';
		} else if(resource instanceof EThing.Device.Denon) {
			content = '<g transform="scale(0.04) translate(140,140)" stroke-width="0"><path d="M454.837,7.765c-11.584-8.078-26.41-9.984-39.661-5.103L197.309,82.92c-16.915,6.231-28.28,22.53-28.28,40.555v245.242c-12.431-8.824-28.382-12.304-45.873-9.805c-19.734,2.819-39.255,13.025-54.966,28.737c-15.712,15.712-25.918,35.233-28.737,54.966c-2.997,20.982,2.579,39.767,15.703,52.89c10.805,10.805,25.445,16.492,41.993,16.492c3.55,0,7.191-0.262,10.896-0.791c19.734-2.819,39.255-13.025,54.967-28.737c15.711-15.712,25.918-35.233,28.737-54.967c0.446-3.128,0.68-6.2,0.75-9.221c0.008-0.182,0.027-212.657,0.027-212.657l257.317-94.791v154.435c-12.43-8.822-28.381-12.303-45.873-9.805c-19.734,2.818-39.255,13.025-54.967,28.737s-25.918,35.233-28.737,54.967c-2.998,20.982,2.579,39.767,15.702,52.89c10.805,10.805,25.445,16.494,41.994,16.494c3.55,0,7.191-0.262,10.896-0.792c19.734-2.819,39.255-13.025,54.967-28.737c15.711-15.712,25.918-35.233,28.737-54.967c0.445-3.125,0.775-280.839,0.775-280.839C473.336,29.095,466.42,15.843,454.837,7.765z M169.029,416.976c-0.012,2.334-0.188,4.739-0.54,7.205c-2.105,14.735-9.95,29.536-22.092,41.677c-12.141,12.141-26.942,19.987-41.676,22.091c-13.48,1.925-25.186-1.29-32.953-9.056c-7.766-7.766-10.983-19.47-9.056-32.954c2.105-14.734,9.95-29.535,22.091-41.675c12.141-12.141,26.942-19.987,41.676-22.093c2.554-0.365,5.041-0.545,7.453-0.545c10.32,0,19.205,3.307,25.5,9.603c6.27,6.27,9.571,15.107,9.598,25.375V416.976z M449.842,85.798L192.524,180.59v-57.113c0-8.227,5.187-15.664,12.907-18.508l217.867-80.26c6.137-2.26,12.734-1.413,18.101,2.33c5.365,3.74,8.443,9.639,8.443,16.179V85.798z M449.841,313.51c-0.011,2.34-0.188,4.752-0.54,7.225c-2.105,14.734-9.951,29.533-22.091,41.675c-12.141,12.142-26.942,19.987-41.676,22.093c-13.485,1.927-25.187-1.291-32.953-9.057c-7.766-7.766-10.984-19.469-9.057-32.953c2.105-14.734,9.95-29.535,22.093-41.676c12.141-12.141,26.941-19.986,41.675-22.091c2.554-0.365,5.042-0.545,7.453-0.545c10.32,0,19.205,3.306,25.5,9.602c6.274,6.274,9.575,15.119,9.598,25.396V313.51z"/></g>';
		} else if(resource instanceof EThing.File && resource.extension()==='plot') {
			content = '<g transform="scale(0.04) translate(180,200)" stroke-width="0"><path d="M415,102.509c-22.091,0-40,17.909-40,40c0,5.542,1.128,10.821,3.166,15.62l-83.791,83.792c-4.799-2.038-10.078-3.167-15.621-3.167s-10.822,1.129-15.621,3.167l-50.053-50.053c2.038-4.799,3.166-10.078,3.166-15.621c0-22.091-17.909-40-40-40c-22.091,0-40,17.909-40,40c0,5.542,1.128,10.821,3.166,15.62l-83.792,83.791c-4.799-2.038-10.078-3.167-15.621-3.167c-22.091,0-40,17.909-40,40s17.909,40,40,40s40-17.909,40-40c0-5.542-1.128-10.821-3.166-15.62l83.792-83.791c4.799,2.038,10.078,3.166,15.621,3.166c5.542,0,10.821-1.128,15.62-3.166l50.054,50.054c-2.038,4.799-3.166,10.078-3.166,15.62c0,22.091,17.909,40,40,40c22.091,0,40-17.909,40-40c0-5.542-1.128-10.821-3.166-15.62l83.791-83.792c4.799,2.038,10.078,3.166,15.621,3.166c22.091,0,40-17.909,40-40S437.091,102.509,415,102.509z"/></g>';
		} else if(resource instanceof EThing.File && /^text/.test(resource.mime())) {
			content = '<g transform="scale(0.09) translate(30,30)" stroke-width="0"><path d="M63.928,106.078H194.79v15.562H63.928V106.078z M63.928,177.707H194.79v15.562H63.928V177.707z M236.072,229.081H63.928v-15.562h172.144V229.081z M236.072,157.454H63.928v-15.562h172.144V157.454z M236.072,85.827H63.928 V70.265h172.144V85.827z"/></g>';
		} else if(resource instanceof EThing.Table) {
			content = '<g transform="scale(0.035) translate(200,200)" stroke-width="0"><rect y="22.261" width="512" height="100.174"/><rect y="155.826" width="144.696" height="89.043"/><rect y="400.696" width="144.696" height="89.043"/><rect y="278.261" width="144.696" height="89.043"/><rect x="178.087" y="155.826" width="155.826" height="89.043"/><rect x="178.087" y="400.696" width="155.826" height="89.043"/><rect x="178.087" y="278.261" width="155.826" height="89.043"/><rect x="367.304" y="155.826" width="144.696" height="89.043"/><rect x="367.304" y="400.696" width="144.696" height="89.043"/><rect x="367.304" y="278.261" width="144.696" height="89.043"/></g>';
		} else if(resource instanceof EThing.File && /^image/.test(resource.mime())) {
			content = '<g transform="scale(0.035) translate(190,190)" stroke-width="0"><path d="M534.75,68.238c-8.945-8.945-19.694-13.417-32.261-13.417H45.681c-12.562,0-23.313,4.471-32.264,13.417C4.471,77.185,0,87.936,0,100.499v347.173c0,12.566,4.471,23.318,13.417,32.264c8.951,8.946,19.702,13.419,32.264,13.419h456.815c12.56,0,23.312-4.473,32.258-13.419c8.945-8.945,13.422-19.697,13.422-32.264V100.499C548.176,87.936,543.699,77.185,534.75,68.238z M511.623,447.672c0,2.478-0.899,4.613-2.707,6.427c-1.81,1.8-3.952,2.703-6.427,2.703H45.681c-2.473,0-4.615-0.903-6.423-2.703c-1.807-1.813-2.712-3.949-2.712-6.427V100.495c0-2.474,0.902-4.611,2.712-6.423c1.809-1.803,3.951-2.708,6.423-2.708h456.815c2.471,0,4.613,0.905,6.42,2.708c1.801,1.812,2.707,3.949,2.707,6.423V447.672L511.623,447.672z"/><path d="M127.91,237.541c15.229,0,28.171-5.327,38.831-15.987c10.657-10.66,15.987-23.601,15.987-38.826c0-15.23-5.333-28.171-15.987-38.832c-10.66-10.656-23.603-15.986-38.831-15.986c-15.227,0-28.168,5.33-38.828,15.986c-10.656,10.66-15.986,23.601-15.986,38.832c0,15.225,5.327,28.169,15.986,38.826C99.742,232.211,112.683,237.541,127.91,237.541z"/><polygon points="210.134,319.765 164.452,274.088 73.092,365.447 73.092,420.267 475.085,420.267 475.085,292.36 356.315,173.587 "/></g>';
		} else if(resource instanceof EThing.File && /^video/.test(resource.mime())) {
			content = '<g transform="scale(0.035) translate(220,200)" stroke-width="0"><path d="M357.714,423.331c0,9.328-10.676,16.891-23.847,16.891H23.847C10.676,440.222,0,432.659,0,423.331V203.735c0-9.33,10.676-16.892,23.847-16.892h310.02c13.171,0,23.847,7.564,23.847,16.892V423.331L357.714,423.331z"/><circle cx="89.428" cy="118.706" r="59.619"/><circle cx="253.381" cy="103.801" r="74.524"/><path d="M491.858,447.677c0,0-1.986,14.904-15.899,14.904c-13.912,0-103.34-83.42-103.34-94.397V258.882c0-10.976,87.443-94.398,103.34-94.398c15.899,0,15.899,14.905,15.899,14.905V447.677z"/></g>';
		} else if(resource instanceof EThing.Folder) {
			content = '<g transform="scale(0.3) translate(23,23)" stroke-width="0"><path d="M56.981,11.5H28.019V6.52c0-1.665-1.354-3.02-3.019-3.02H3.019C1.354,3.5,0,4.854,0,6.52V20.5h60v-5.98C60,12.854,58.646,11.5,56.981,11.5z"/><path d="M0,53.48c0,1.665,1.354,3.02,3.019,3.02h53.962c1.665,0,3.019-1.354,3.019-3.02V22.5H0V53.48z"/></g>';
		} else if(resource instanceof EThing.File && /^application/.test(resource.mime())) {
			content = '<g transform="scale(0.04) translate(140,140)" stroke-width="0"><rect x="14.94" y="243.2" transform="matrix(0.3417 -0.9398 0.9398 0.3417 -74.4662 422.7561)" width="499.196" height="42.666"/><polygon points="121.6,142.933 0,264.533 121.6,386.133 151.467,356.267 59.733,264.533 151.467,172.8 "/><polygon points="407.467,142.933 377.6,172.8 469.333,264.533 377.6,356.267 407.467,386.133 529.067,264.533 "/></g>';
		} else {
			var icon = {
				'File': 'F',
				'Device': 'D',
				'Table': 'T',
				'App': 'A',
				'Folder': '+',
				'Unk': '?',
				'Select' : 'x'
			};
			if(!icon.hasOwnProperty(type))
				type = 'Unk';
			content = (type==='Select') ? '<path d="M 6 14 L 15 22 L 26 8"  stroke-width="2"/>' : ('<text x="16" y="24" font-size="22" font-weight="bold" font-family="Arial" text-anchor="middle">'+icon[type]+'</text>');
		}
		return '<svg class="icon-'+type+'" '+(style ? 'style="'+style+'"' : '')+' viewBox="0 0 32 32">'+(square ? '<rect x="0" y="0" width="32" height="32"/>' : '<circle cx="16" cy="16" r="16" />')+content+'</svg>';
	}
	
	
	
	
	function Browser(dom,opt){
		
		var options = $.extend(true,{
			model:null, // will be set after
			// table options
			class: "explorer",
			view: 'Table',
			row: {
				class: 'item'
			},
			openable:{
				enable: true
			},
			sortBy: '-modifiedDate',
			selectable: {}
		},opt);
		
		if(!(options.model instanceof Table.Model))
			options.model = new ArboModel(options.model);
			
		if(typeof options.view == 'string'){
			options.view = new Browser.Views[options.view]();
		}
		else if($.isPlainObject(options.view)){
			options.view = new Browser.Views['Table'](options.view);
		}
		
		var userFilter = options.selectable.filter;
		options.selectable.filter = function(r){
			return r.__prev === true ? false : (typeof userFilter == 'function' ? userFilter.apply(this, Array.prototype.slice.call(arguments)) : true);
		};
		
		Table.call(this,dom,options);
		
		this.$element.find('table').addClass('table');
		
	}
	inherits(Browser,Table);
	
	Browser.prototype.pwd = function(){
		return this.model().getResource(this._parent || null);
	}
	
	
	
	
	
	var ArboModel = function(options){
		
		this._options = $.extend(true,{
			filter: null, // function(resource) -> return boolean , if it returns false, the resource is ignored
			root: null, // root directory, may be a EThing.Folder instance or a string of a path or an array of resources (default to null which means the root of the user system files)
			allowTraversing: true, // display the previous directory link, no sort is made on that item : always on top (not available if root field is an array)
			flat: false
		},options);
		
		
		Table.Model.call(this,this._options);
		
		this._sort = null; // by default, no sort is made
		this._filter = this._options.filter;
	}
	inherits(ArboModel,Table.Model);
	
	ArboModel.prototype.init = function(tableInstance){
		EThing.on('ething.arbo.changed',function(){
			tableInstance.reload();
		});
		return EThing.arbo.load();
	}
	
	// return the keys/columns
	ArboModel.prototype.keys = function(){
		return ['name','size','modifiedDate'];
	}
	// return the number of rows, null if not known
	ArboModel.prototype.rows = function(){
		var root = this.getResource();
		return (root instanceof EThing.Folder) ? root.ls().length : ($.isArray(root) ? root.length : null);
	}
	
	ArboModel.prototype.currentFolder = function(){
		return this._currentFolder || null;
	}
	
	// return the items, may be a deferred object
	// offset and length are used for pagination
	ArboModel.prototype.data = function(parent, offset, length){
		// parent is null if root
		
		parent = this.getResource(parent);
		
		this._currentFolder = (parent instanceof EThing.Folder) ? parent : null;
		
		var children = (parent instanceof EThing.Folder) ? (this._options.flat ? parent.find() : parent.children()) : ($.isArray(parent) ? parent : []);
		
		if(this._filter)
			children = $.grep(children,this._filter)
		
		if(this._sort)
			children.sort(this._sort);
		
		if(this._options.allowTraversing && (parent instanceof EThing.Folder)){
			if(parent!==EThing.arbo.root()){
				var prev = new EThing.Folder($.extend({}, parent.parent().json(), {
						'name': '.. (go to parent directory)'
					}));
				prev.__prev = true;
				children.unshift(prev);
			}
		}
		
		// pagination
		if(typeof offset == 'number')
			children = children.slice(offset,length ? (offset+length) : undefined);
		
		return children;
	}
	// check if an item has children or not (tree model may have)
	ArboModel.prototype.hasChildren = function(item){
		return this._options.allowTraversing && !this._options.flat && (item instanceof EThing.Folder);
	}
	// sort the data
	ArboModel.prototype.sort = function(field, ascending){
		var sortfn;
		
		if(field=="size"){
			sortfn = function(a, b) {
				return (
					isFinite(a) && isFinite(b) ?
					((ascending ? 1 : -1) * (a - b)):
					NaN
				);
			};
			// special case (mix between table length & resource size)
			this._sort = function(a,b){
				a = (typeof a.size != 'undefined') ? a.size() : (typeof a.length != 'undefined' ? a.length() : null);
				b = (typeof b.size != 'undefined') ? b.size() : (typeof b.length != 'undefined' ? b.length() : null);
				return sortfn(a,b);
			};
			return;
			
		}
		else if(field=="modifiedDate"){
			sortfn = function(a, b) {
				return (
					isFinite(a) && isFinite(b) ?
					((ascending ? 1 : -1) * ((a>b)-(a<b))):
					NaN
				);
			};
		}
		else {
			// default
			sortfn = function(a,b){
				return (ascending ? 1 : -1) * a.localeCompare(b);
			};
		}
		
		this._sort = function(a,b){
			a = (typeof a[field] != 'undefined') ? a[field]() : null;
			b = (typeof b[field] != 'undefined') ? b[field]() : null;
			return sortfn(a,b);
		};
		
	}
	// return a unique index identifying an items according to the data given in argument
	ArboModel.prototype.index = function(resource){
		var r = (resource instanceof EThing.Resource) ? resource : EThing.arbo.findOneById(resource);
		return r ? r.id() : null;
	}
	// specific
	ArboModel.prototype.getResource = function(item){
		if(!item){
			// root directory asked
			if(typeof this._options.root == 'string')
				return EThing.arbo.findOneById(this._options.root);
			if(!this._options.root)
				return EThing.arbo.root();
			return this._options.root;
		}
		if(item.__prev===true)
			return EThing.arbo.findOneById(item.id());
		return item;
	}
	ArboModel.prototype.filter = function(filter){
		if(typeof filter == 'undefined')
			return this._filter;
		else
			this._filter = filter;
	}
	
	
	
	var ArboTableView = function(opt) {
		
		opt = $.extend(true,{
			fields: {
				'icon': {
					label: "",
					get: function(r){
						return generateSvgResourceIcon(r);
					},
					class: "col-icon",
					sortable: false
				},
				'name':{
					get: function(r){
						var html = r.basename();
						
						// append the name of the creator
						var createdBy = r.createdBy();
						if(createdBy){
							var createdByRess = EThing.arbo.findOneById(createdBy.id);
							if(createdByRess){
								var icon;
								if(createdByRess instanceof EThing.Device)
									icon = 'phone';
								else if(createdByRess instanceof EThing.App)
									icon = 'flash';
								else
									icon = 'asterisk';
								html += '<span class="createdBy"><span class="glyphicon glyphicon-'+icon+'" aria-hidden="true"></span> '+createdByRess.name()+'</span>';
							}
						}
						
						// is public
						if(r.public()){
							html += '<span class="public"><i class="fa fa-users col-share" aria-hidden="true"></i></span>';
						}
						
						return html;
					},
					class: "col-name"
				},
				'size':{
					get: function(resource){
						if(typeof resource.size === "function"){
							return UI.sizeToString(resource.size());
						}
						else if(resource instanceof EThing.Table)
							return resource.length()+' rows';
						else if(resource instanceof EThing.Folder)
							return resource.length()+' resources';
						else
							return '-';
					},
					class: "col-size"
				},
				'modifiedDate':{
					label: "modified",
					formatter: function(v){
						return v===null ? '-' : UI.dateToString(v);
					},
					class: "col-modified"
				}
			},
			showOnlySpecifiedField: true
		},opt);
		
		Table.TableView.call(this,opt);
	}
	inherits(ArboTableView,Table.TableView);
	
	ArboTableView.prototype.createItem = function(item,index){
		var $tr = Table.TableView.prototype.createItem.call(this,item,index);
		
		$tr.attr('data-type', item.type());
		
		if(item instanceof EThing.Folder){
			// put it at the top
			var $lastFolder = this._$tbody.children('[data-type="Folder"]').not($tr).last();
			if($lastFolder.length){
				$tr.insertAfter($lastFolder);
			} else {
				this._$tbody.prepend($tr);
			}
		}
		
		return $tr;
	}
	
	
	var ArboWallView = function(opt) {
		
		this._options = $.extend(true,{
			class: 'wallview'
		},opt);
		
		Table.View.call(this);
	}
	inherits(ArboWallView,Table.View);
	
	ArboWallView.prototype.init = function($container, table){
		
		Table.View.prototype.init.call(this,$container,table);
		
		this._$grid = $('<div>').appendTo(this.$()).addClass(this._options.class).addClass('clearfix');
		
	}
	ArboWallView.prototype.clear = function(){
		this._$grid.empty();
	}
	ArboWallView.prototype.createItem = function(resource, id){
		
		var $item = $('<div>');
		
		// construct the item dom element
		
		// icon
		var $icon = $('<div>').html(generateSvgResourceIcon(resource,true)).addClass("col-icon");
		
		// name
		var $name = $('<div>').html(resource.name()).addClass("col-name");
		
		$item.append(
			$icon,
			$name
		);
		
		this._$grid.append($item);
		
		return $item;
	}
	ArboWallView.prototype.setSelectState = function(item, checked, $item){
		/*ar $icon = $item.find('.col-icon > svg').toggleClass('col-select', checked);
		$icon.replaceWith($.Browser.generateSvgResourceIcon(checked ? 'Select' : item, true));*/
	}
	
	

	
	
	Browser.Views = {
		'Wall': ArboWallView,
		'Table': ArboTableView
	};
	
	Browser.Models = {
		'Standard': ArboModel
	};
	
	
	Browser.generateSvgResourceIcon = generateSvgResourceIcon;
	
	
	/* register as a plugin in jQuery */
	
	$.Browser = Browser;
	
	$.fn.browser = function(){
		var args = [].slice.call(arguments);
		
		if (this[0]) { // this[0] is the renderTo div
			
			var instance = $(this[0]).data('browser');
			
			if(instance){
				if(args.length){
					if(typeof args[0] == 'string'){
						// access the attribute or method
						var prop = instance[args.shift()];
						if(typeof prop == 'function'){
							var r = prop.apply(instance,args);
							return (r === instance) ? this : r; // make it chainable
						}
						else {
							if(args.length==0){
								// getter
								return prop;
							}
							else if(args.length==1){
								// setter
								prop = args[0];
								return this;
							}
						}
					}
				}
				else
					return instance;// When called without parameters return the instance
			}
			
			// if we are are, it means that there is no instance or that the user wants to create a new one !
			// /!\ NOTE : be sure to not emit any event in the constructor, or delay them using the setTimeout function !
			instance = new Browser(this[0],args[0],args[1],args[2],args[3],args[4],args[5],args[6]);
			$(this[0]).data('browser',instance);
			
			return this;
		}
	};
	
	
	return Browser;
	
	
	
}));
