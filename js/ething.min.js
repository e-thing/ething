!function(e){function t(e,n,r){var o;if(Array.isArray(n))for(var i in n){var s=n[i];/\[\]$/.test(e)?r(e,s):t(e+"["+("object"==typeof s?i:"")+"]",s,r)}else if("object"==typeof n)for(o in n)t(e+"["+o+"]",n[o],r);else r(e,n)}var n=e.EThing||{utils:{}},r=n.utils;r.isNode="undefined"!=typeof module&&module.exports,r.isId=function(e){return"string"==typeof e&&7===e.length&&/^[0-9a-zA-Z\-_]+$/.test(e)},r.parseUrl=function(e){var t=/^((([a-z]+):)?\/\/)?(([^:]*)(:([^@]*))?@)?([^:\/?#]+)?(:([0-9]+))?([^?#]+)?(\?[^#]*)?(#.*)?$/i.exec(e);return!!t&&{scheme:t[3],user:t[5],password:t[7],hostname:t[8],port:t[10],path:t[11],search:t[12],hash:t[13]}},r.getParam=function(e,t){var n=e.indexOf("?"),r=new RegExp("[\\?&]"+encodeURIComponent(t)+"=([^&#]*)"),o=-1!==n?r.exec(e.substr(n)):null;return null===o?"":decodeURIComponent(o[1])},r.getQueryString=function(e,t){var n=e.indexOf("?"),r=new RegExp("[\\?&]"+encodeURIComponent(t)+"=([^&#]*)"),o=-1!==n?r.exec(e.substr(n)):null;return null===o?"":decodeURIComponent(o[1])},r.removeParam=function(e,t){var n=e.split("?");if(n.length>=2){var r=n[1].indexOf("#"),o="";-1!==r&&(o=n[1].substr(r),n[1]=n[1].substr(0,r));for(var i=encodeURIComponent(t)+"=",s=n[1].split(/[&;]/g),a=s.length;a-- >0;)-1!==s[a].lastIndexOf(i,0)&&s.splice(a,1);return e=n[0]+(s.length>0?"?"+s.join("&"):"")+o}return e},r.insertParam=function(e,t,n){var o=(e=r.removeParam(e,t)).indexOf("#"),i="";-1!==o&&(i=e.substr(o),e=e.substr(0,o));var s=e.indexOf("?"),a="";return-1!==s&&(a=e.substr(s),e=e.substr(0,s)),a+=a.length?"&":"?",a+=encodeURIComponent(t)+"="+encodeURIComponent(n),e+a+i},r.param=function(e){var n,r=[];for(n in e)null!==e[n]&&void 0!==e[n]&&t(n,e[n],function(e,t){t="function"==typeof t?t():null==t?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)});return r.join("&").replace(/%20/g,"+")};var o=r.pad=function(e,t,n){return n=n||"0",(e+="").length>=t?e:new Array(t-e.length+1).join(n)+e};r.sizeToString=function(e){if(e=parseInt(e),isNaN(e))return"-";return e>9e8?e=Math.floor(e/1e9*100)/100+" GB":e>9e5?e=Math.floor(e/1e6*100)/100+" MB":e>900?e=Math.floor(e/1e3*100)/100+" KB":e+=" B",e},r.dateToString=function(e){var t=new Date;if("number"==typeof e&&(e=new Date(1e3*e)),e){if(t.getTime()-e.getTime()<864e5)return o(e.getHours(),2)+":"+o(e.getMinutes(),2);var n=e.getFullYear(),r=e.getDate(),i=e.getMonth();return n==t.getFullYear()?r+" "+new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec")[i]+".":n+"/"+o(i+1,2)+"/"+o(r,2)}return"-"},r.dateDiffToString=function(e){if(e=parseInt(e),isNaN(e))return"-";var t,n={w:604800,d:86400,h:3600,m:60},r=0,o="";return(t=Math.floor(e/n.w))>=1&&r<2&&(o+=Math.floor(t)+" week"+(t>1?"s":""),e-=t*n.w,r++),(t=Math.floor(e/n.d))>=1&&r<2&&(r&&(o+=" "),o+=Math.floor(t)+" day"+(t>1?"s":""),e-=t*n.d,r++),(t=Math.floor(e/n.h))>=1&&r<2&&(r&&(o+=" "),o+=Math.floor(t)+" hour"+(t>1?"s":""),e-=t*n.h,r++),(t=Math.floor(e/n.m))>=1&&r<2&&(r&&(o+=" "),o+=Math.floor(t)+" minute"+(t>1?"s":""),e-=t*n.m,r++),(t=e)>=1&&r<2&&(r&&(o+=" "),o+=Math.floor(t)+" seconde"+(t>1?"s":""),r++),o};var i={};r.createCache=function(e){return function(t,n){return(!i[t]||"function"==typeof i[t].state&&"rejected"===i[t].state())&&(i[t]=e(t)),i[t].done(n)}};var s={},a=s.toString,u=s.hasOwnProperty;"Boolean Number String Function Array Date RegExp Object Error Symbol".split(" ").forEach(function(e){s["[object "+e+"]"]=e.toLowerCase()}),r.type=function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?s[a.call(e)]||"object":typeof e},r.isPlainObject=function(e){var t;if("object"!==r.type(e)||e.nodeType||null!=e&&e===e.window)return!1;try{if(e.constructor&&!u.call(e,"constructor")&&!u.call(e.constructor.prototype||{},"isPrototypeOf"))return!1}catch(e){return!1}for(t in e);return void 0===t||u.call(e,t)},r.extend=function(){var e,t,n,o,i,s,a=arguments[0]||{},u=1,c=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[1]||{},u=2),"object"!=typeof a&&"function"!=typeof a&&(a={}),c===u&&(a=this,--u);u<c;u++)if(null!=(e=arguments[u]))for(t in e)n=a[t],a!==(o=e[t])&&(l&&o&&(r.isPlainObject(o)||(i=Array.isArray(o)))?(i?(i=!1,s=n&&Array.isArray(n)?n:[]):s=n&&r.isPlainObject(n)?n:{},a[t]=r.extend(l,s,o)):void 0!==o&&(a[t]=o));return a},r.isEqual=function(e,t){"use strict";if(null===e||void 0===e||null===t||void 0===t)return e===t;if(e.constructor!==t.constructor)return!1;if(e instanceof Function)return e===t;if(e instanceof RegExp)return e===t;if(e===t||e.valueOf()===t.valueOf())return!0;if(Array.isArray(e)&&e.length!==t.length)return!1;if(e instanceof Date)return!1;if(!(e instanceof Object))return!1;if(!(t instanceof Object))return!1;var n=Object.keys(e);return Object.keys(t).every(function(e){return-1!==n.indexOf(e)})&&n.every(function(n){return r.isEqual(e[n],t[n])})},r.inherits=function(e,t){e.prototype=new t,e.prototype.constructor=e},e.EThing=n}(this),function(e){if("undefined"!=typeof module&&module.exports){e.btoa=function(e){return(e instanceof Buffer?e:new Buffer(e.toString(),"binary")).toString("base64")},e.atob=function(e){return new Buffer(e,"base64").toString("binary")};var t=require("url");e.XMLHttpRequest=function(){"use strict";var e,n,r=this,o=require("http"),i=require("https"),s={},a={"User-Agent":"node-XMLHttpRequest",Accept:"*/*"},u={},c={},l=!1,p=!1,f={};this.UNSENT=0,this.OPENED=1,this.HEADERS_RECEIVED=2,this.LOADING=3,this.DONE=4,this.readyState=this.UNSENT,this.onreadystatechange=null,this.responseType="",this.response="",this.responseText="",this.status=null,this.statusText=null,this.withCredentials=!1,this.open=function(e,t,n,r,o){this.abort(),p=!1,s={method:e,url:t.toString(),async:"boolean"!=typeof n||n,user:r||null,password:o||null},h(this.OPENED)},this.setRequestHeader=function(e,t){if(this.readyState!==this.OPENED)throw new Error("INVALID_STATE_ERR: setRequestHeader can only be called when state is OPEN");if(l)throw new Error("INVALID_STATE_ERR: send flag is true");e=c[e.toLowerCase()]||e,c[e.toLowerCase()]=e,u[e]=u[e]?u[e]+", "+t:t},this.getResponseHeader=function(e){return"string"==typeof e&&this.readyState>this.OPENED&&n&&n.headers&&n.headers[e.toLowerCase()]&&!p?n.headers[e.toLowerCase()]:null},this.getAllResponseHeaders=function(){if(this.readyState<this.HEADERS_RECEIVED||p)return"";var e="";for(var t in n.headers)"set-cookie"!==t&&"set-cookie2"!==t&&(e+=t+": "+n.headers[t]+"\r\n");return e.substr(0,e.length-2)},this.getRequestHeader=function(e){return"string"==typeof e&&c[e.toLowerCase()]?u[c[e.toLowerCase()]]:""},this.send=function(f){if(this.readyState!==this.OPENED)throw new Error("INVALID_STATE_ERR: connection must be opened before send() is called");if(l)throw new Error("INVALID_STATE_ERR: send has already been called");var d,y=!1,v=t.parse(s.url);switch(v.protocol){case"https:":y=!0;case"http:":d=v.hostname;break;case void 0:case null:case"":d="localhost";break;default:throw new Error("Protocol not supported.")}var g=v.port||(y?443:80),m=v.pathname+(v.search?v.search:"");for(var T in a)c[T.toLowerCase()]||(u[T]=a[T]);if(u.Host=d,y&&443===g||80===g||(u.Host+=":"+v.port),s.user){void 0===s.password&&(s.password="");var b=new Buffer(s.user+":"+s.password);u.Authorization="Basic "+b.toString("base64")}"GET"===s.method||"HEAD"===s.method?f=null:f?(u["Content-Length"]=Buffer.isBuffer(f)?f.length:Buffer.byteLength(f),u["Content-Type"]||(u["Content-Type"]="text/plain;charset=UTF-8")):"POST"===s.method&&(u["Content-Length"]=0);var j={host:d,port:g,path:m,method:s.method,headers:u,agent:!1,withCredentials:r.withCredentials};if(p=!1,!s.async)throw new Error("Synchronous mode not supported.");var D=y?i.request:o.request;l=!0,r.dispatchEvent("readystatechange");var R=function(e){r.handleError(e)};e=D(j,function o(i){var a=[];if(301!==(n=i).statusCode&&302!==n.statusCode&&303!==n.statusCode&&307!==n.statusCode)h(r.HEADERS_RECEIVED),r.status=n.statusCode,r.statusText=n.statusMessage,n.on("data",function(e){e&&a.push(e),l&&h(r.LOADING)}),n.on("end",function(){switch(a=Buffer.concat(a),r.responseType){case"":case"text":r.response=a.toString("utf8"),r.responseText=r.response;break;case"json":try{r.response=JSON.parse(a.toString("utf8"))}catch(e){r.handleError(e)}break;case"arraybuffer":for(var e=new ArrayBuffer(a.length),t=new Uint8Array(e),n=0;n<a.length;++n)t[n]=a[n];r.response=e;break;case"buffer":r.response=a;break;default:throw new Error(r.responseType+" response type not supported.")}l&&(h(r.DONE),l=!1)}),n.on("error",function(e){r.handleError(e)});else{s.url=n.headers.location;var c=t.parse(s.url);d=c.hostname;var p={hostname:c.hostname,port:c.port,path:c.path,method:303===n.statusCode?"GET":s.method,headers:u,withCredentials:r.withCredentials};(e=D(p,o).on("error",R)).end()}}).on("error",R),f&&e.write(f),e.end(),r.dispatchEvent("loadstart")},this.handleError=function(e){this.status=0,this.statusText=e,this.responseText=e.stack,p=!0,h(this.DONE),this.dispatchEvent("error")},this.abort=function(){e&&(e.abort(),e=null),u=a,this.status=0,this.responseText="",p=!0,this.readyState===this.UNSENT||this.readyState===this.OPENED&&!l||this.readyState===this.DONE||(l=!1,h(this.DONE)),this.readyState=this.UNSENT,this.dispatchEvent("abort")},this.addEventListener=function(e,t){e in f||(f[e]=[]),f[e].push(t)},this.removeEventListener=function(e,t){e in f&&(f[e]=f[e].filter(function(e){return e!==t}))},this.dispatchEvent=function(e){if("function"==typeof r["on"+e]&&r["on"+e](),e in f)for(var t=0,n=f[e].length;t<n;t++)f[e][t].call(r)};var h=function(e){e!=r.LOADING&&r.readyState===e||(r.readyState=e,(s.async||r.readyState<r.OPENED||r.readyState===r.DONE)&&r.dispatchEvent("readystatechange"),r.readyState!==r.DONE||p||(r.dispatchEvent("load"),r.dispatchEvent("loadend")))}}}}(this),function(e){function t(){return!0}function n(){return!1}function r(e){var t={};e.on=function(e,n){if("function"==typeof n){e=e.split(" ");for(var r=0;r<e.length;r++){var o=e[r];o.length&&(t[o]||(t[o]=[]),t[o].push(n))}}},e.off=function(e,n){e=e.split(" ");for(var r=0;r<e.length;r++){var o=e[r];if(o.length&&t[o])if("function"==typeof n)for(var i=0;i<t[o].length;i++)t[o][i]===n&&(t[o].splice(i,1),i--);else t[o]=[]}},e.one=function(t,n){"function"==typeof n&&e.on(t,function(){e.off(t,n),n.apply(this,Array.prototype.slice.call(arguments))})},e.trigger=function(n,r){"string"==typeof n&&(n=o.Event(n));for(var i=n.type,s=t[i]||[],a=0;a<s.length;a++){var u=[n];if(Array.isArray(r)&&(u=u.concat(r)),s[a].apply(e,u),n.isImmediatePropagationStopped()||n.isPropagationStopped())break}return n}}var o=e.EThing||{};o.Event=function(e,t){if(!(this instanceof o.Event))return new o.Event(e,t);this.type=e,t&&o.utils.extend(this,t),this.timeStamp=Date.now()},o.Event.prototype={constructor:o.Event,isDefaultPrevented:n,isPropagationStopped:n,isImmediatePropagationStopped:n,preventDefault:function(){this.isDefaultPrevented=t},stopPropagation:function(){this.isPropagationStopped=t},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=t,this.stopPropagation()}},r(o),o.EventEngine=r}(this),function(e){function t(e){var n="pending",r=[],o=[],i=[],s=null,a=[["resolve","done"],["reject","fail"],["notify","progress"]],u={done:function(){for(var e=0;e<arguments.length;e++)if(arguments[e])if(Array.isArray(arguments[e]))for(var t=arguments[e],o=0;o<t.length;o++)"resolved"===n&&t[o].apply(this,s),r.push(t[o]);else"resolved"===n&&arguments[e].apply(this,s),r.push(arguments[e]);return this},fail:function(){for(var e=0;e<arguments.length;e++)if(arguments[e])if(Array.isArray(arguments[e]))for(var t=arguments[e],r=0;r<t.length;r++)"rejected"===n&&t[r].apply(this,s),o.push(t[r]);else"rejected"===n&&arguments[e].apply(this,s),o.push(arguments[e]);return this},always:function(){return this.done.apply(this,arguments).fail.apply(this,arguments)},progress:function(){for(var e=0;e<arguments.length;e++)if(arguments[e])if(Array.isArray(arguments[e]))for(var t=arguments[e],r=0;r<t.length;r++)"pending"===n&&i.push(t[r]);else"pending"===n&&i.push(arguments[e]);return this},then:function(){var e=arguments;return t(function(t){a.forEach(function(n,r){var o="function"==typeof e[r]&&e[r];c[n[1]](function(){var e=o&&o.apply(this,arguments);e&&"function"==typeof e.promise?e.promise().progress(t.notify).done(t.resolve).fail(t.reject):t[n[0]+"With"](this===u?t.promise():this,o?[e]:arguments)})}),e=null}).promise()},promise:function(e){if(null==e)return u;for(var t in u)e[t]=u[t];return e},state:function(){return n},debug:function(){console.log("[debug]",r,o,n)},isRejected:function(){return"rejected"===n},isResolved:function(){return"resolved"===n}},c={resolveWith:function(e){if("pending"===n){n="resolved";for(var t=s=arguments.length>1?arguments[1]:[],o=0;o<r.length;o++)r[o].apply(e,t)}return this},rejectWith:function(e){if("pending"===n){n="rejected";for(var t=s=arguments.length>1?arguments[1]:[],r=0;r<o.length;r++)o[r].apply(e,t)}return this},notifyWith:function(e){if("pending"===n)for(var t=s=arguments.length>1?arguments[1]:[],r=0;r<i.length;r++)i[r].apply(e,t);return this},resolve:function(){return this.resolveWith(this,arguments)},reject:function(){return this.rejectWith(this,arguments)},notify:function(){return this.notifyWith(this,arguments)}},l=u.promise(c);return e&&e.apply(l,[l]),l}t.when=function(){if(arguments.length<2){var e=arguments.length?arguments[0]:void 0;return e&&"function"==typeof e.isResolved&&"function"==typeof e.isRejected?e.promise():t().resolve(e).promise()}return function(e){for(var n=t(),r=e.length,o=0,i=new Array(r),s=0;s<e.length;s++)!function(t){var s=null;e[t].done?e[t].done(function(){i[t]=arguments.length<2?arguments[0]:arguments,++o==r&&n.resolve.apply(n,i)}).fail(function(){n.reject(arguments)}):(s=e[t],e[t]=new Deferred,e[t].done(function(){i[t]=arguments.length<2?arguments[0]:arguments,++o==r&&n.resolve.apply(n,i)}).fail(function(){n.reject(arguments)}).resolve(s))}(s);return n.promise()}(arguments)},e.EThing=e.EThing||{utils:{}},e.EThing.utils.Deferred=t}(this),function(e){var t=e.EThing||{},n=e.Blob||function(){},r=e.Buffer||function(){},o=t.utils.extend,i=t.utils.isId,s=t.utils.isPlainObject,a=[],u=[],c=[],l=[],p=null;t.Error=function(e){this.name="EThing.Error","string"==typeof e&&(e={message:e}),o(this,{message:"unknown error"},e)},t.Error.prototype=new Error,t.toApiUrl=function(e,n){return e=e||"",/^([a-z]+:)?\/\//.test(e)||(!/^\//.test(e)&&e&&(e="/"+e),e=t.config.apiUrl+e),n&&f(e)&&(e=D(e),"function"==typeof p&&(e=p(e))),e};var f=function(e){return new RegExp("^([a-z]+:)?//"+t.config.apiUrl.replace(/^([a-z]+:)?\/\//,"")).test(e)};t.apiUrl=function(){return t.toApiUrl()};var h=function(i){function h(e){var n=v.getResponseHeader("Content-Type")||"",r=null;if(void 0!==e)r=e;else if(/json/.test(n)||/text\/plain/.test(n))switch(v.responseType){case"":case"text":case"json":r=v.response;break;case"blob":if(i.synchronous){if(!FileReaderSync)throw new Error("FileReaderSync not supported.");var o=new FileReaderSync;r=String.fromCharCode.apply(null,new Uint8Array(o.readAsArrayBuffer(v.response)))}else{if(r=t.utils.Deferred(),!FileReader)throw new Error("FileReaderSync not supported.");(o=new FileReader).onload=function(){r.resolve(String.fromCharCode.apply(null,new Uint8Array(this.result)))},o.readAsArrayBuffer(v.response)}break;case"arraybuffer":r=String.fromCharCode.apply(null,new Uint8Array(v.response));break;case"buffer":r=v.response.toString("utf8");break;default:throw new Error(v.responseType+" response type not supported.")}t.utils.Deferred.when(r).always(function(e){try{e=JSON.parse(e)}catch(e){}var n=[new t.Error(e||(v.status?v.status+" ["+v.statusText+"]":"unknown error")),v,i];t.trigger("ething.request.error",n),c.forEach(function(e){e.apply(T,n)}),t.trigger("ething.request.complete",n),u.forEach(function(e){e.apply(T,n)}),y.rejectWith(T,n)})}function d(e){var n=[e,v,i];t.trigger("ething.request.success",n),a.forEach(function(e){e.apply(T,n)}),t.trigger("ething.request.complete",n),u.forEach(function(e){e.apply(T,n)}),y.resolveWith(T,n)}var y=new t.utils.Deferred,v=new e.XMLHttpRequest;if("string"==typeof i&&(i={url:i}),"string"!=typeof(i=o({method:"GET",context:null,url:null,data:null,contentType:null,headers:null,dataType:null,converter:null,synchronous:!1},i)).url)return null;var g=t.toApiUrl(i.url),m=f(g);i.method=i.method.toUpperCase();var T=i.context||t,b=!/^(?:GET|HEAD)$/.test(i.method),j=void 0,R=void 0!==i.data&&null!==i.data;!b&&R&&(g+=(/\?/.test(g)?"&":"?")+("string"==typeof i.data?i.data:t.utils.param(i.data))),v.open(i.method,g,!i.synchronous);var w=null;if(s(i.headers))for(var S in i.headers)i.headers.hasOwnProperty(S)&&(/^content-type$/i.test(S)&&(w=i.headers[S]),v.setRequestHeader(S,i.headers[S]));!w&&i.contentType&&v.setRequestHeader("Content-Type",w=i.contentType),b&&R&&(w?(j=i.data,(s(i.data)||Array.isArray(i.data))&&(/json/i.test(w)?j=JSON.stringify(i.data):/application\/x-www-form-urlencoded/i.test(w)&&(j=t.utils.param(i.data)))):i.data instanceof n?(v.setRequestHeader("Content-Type",w=i.data.type),j=i.data):i.data instanceof ArrayBuffer||i.data instanceof r?(v.setRequestHeader("Content-Type",w="application/octet-stream"),j=i.data):(v.setRequestHeader("Content-Type",w="application/x-www-form-urlencoded; charset=UTF-8"),j="string"==typeof i.data?i.data:t.utils.param(i.data))),m&&(v=D(v),"function"==typeof p&&(v=p(v)));var E=i.dataType;E&&"auto"!=E&&(v.responseType=E),v.onload=function(e){if(v.status>=200&&v.status<300||304===v.status){var t=v.response;if("auto"==E){if(/json/.test(v.getResponseHeader("Content-Type")||""))try{t=JSON.parse(t)}catch(e){}}else if("json"==E&&"string"==typeof t)try{t=JSON.parse(t)}catch(e){}"function"==typeof i.converter&&(t=i.converter.call(T,t,v,i)),d(t)}else h()},v.onerror=function(){h()},v.onabort=function(){h()},v.onprogress=function(e){y.notifyWith(T,[e,v,i])};var A=t.Event("ething.request.send");return t.trigger(A,[v,i]),A.isDefaultPrevented()?h("Aborded"):(l.forEach(function(e){e.call(T,v)}),v.send(j)),y.promise()},d=t.getClass=function(e){var n=e.split(/[.\\]/),r=t;return n.forEach(function(e){if(void 0===r[e])return r=void 0,!1;r=r[e]}),r};t.instanciate=function(e){var t=d(e.type);return!!t&&new t(e)};t.resourceConverter=function(e,n){if("object"==typeof e&&null!==e){var r=Array.isArray(e);r||(e=[e]),e=e.map(function(e){return t.instanciate(e)}).filter(function(e){return e}),e=t.arbo.update(e).resources,r||(e=e.length?e[0]:null)}return e},t.request=function(e,t){var n=h(e);if("function"==typeof t&&n.always(function(){t.apply(this,Array.prototype.slice.call(arguments))}),e.synchronous){var r=null;return n.always(function(e){r=e}),r}return n},t.apiRequestPrefilter=function(e){p=e},t.ajaxSend=function(e){"function"==typeof e&&l.push(e)},t.ajaxComplete=function(e){"function"==typeof e&&u.push(e)},t.ajaxSuccess=function(e){"function"==typeof e&&a.push(e)},t.ajaxError=function(e){"function"==typeof e&&c.push(e)};var y=t.DeferredObject=function(){function e(){for(var e=0;e<r.length;e++){var t=r[e].dfr,n=r[e].pending,i=r[e].fn;if(n)r[e].pending=!1,i.call(o,o).done(function(){var e=Array.prototype.slice.call(arguments);t.resolveWith(o,e)}).fail(function(){t.rejectWith(o,Array.prototype.slice.call(arguments))}).progress(function(){t.notifyWith(o,Array.prototype.slice.call(arguments))});else if(t.isResolved()||t.isRejected()){r.splice(e,1),e--;continue}break}}var n=t.utils.Deferred().resolve(),r=[],o=this;["done","fail","always","progress","then","state","isRejected","isResolved"].forEach(function(e){this[e]=function(){var t=(r.length?r[r.length-1].dfr:n)[e].apply(o,Array.prototype.slice.call(arguments));return"object"==typeof t&&"then"!==e?o:t}},this),this.promise=function(){return o},this.deferred=function(n){var o=new t.utils.Deferred;return o.always(function(){e()}),r.push({fn:n,dfr:o,pending:!0}),e(),this}},v=(e.location?window.location.protocol+"//"+window.location.hostname:"http://localhost")+"/ething/api";t.config=o({apiUrl:v},t.config),t.Resource=function(e){y.call(this),t.EventEngine(this),this._fromJson(e,!0)},t.utils.inherits(t.Resource,y),t.Resource.prototype._fromJson=function(e,n){var r=this._json&&e&&this._json.modifiedDate&&e.modifiedDate&&this._json.modifiedDate!==e.modifiedDate,i=[];return e=o({name:null,id:null,type:null,createdBy:null,createdDate:0,modifiedDate:0,data:null,description:null},e||{}),!n&&r&&Object.keys(e).forEach(function(n){void 0!==this._json[n]&&t.utils.isEqual(e[n],this._json[n])||i.push(n)},this),this._json=e,!n&&r&&(this.trigger("updated",[i]),t.trigger("ething.resource.updated",[this,i])),r},t.Resource.prototype.json=function(){return this._json},t.Resource.prototype.name=function(){return this._json.name},t.Resource.prototype.dirname=function(){return t.Resource.dirname(this._json.name)},t.Resource.prototype.basename=function(){return t.Resource.basename(this._json.name)},t.Resource.prototype.extension=function(){return t.Resource.extension(this._json.name)},t.Resource.prototype.id=function(){return this._json.id},t.Resource.prototype.createdBy=function(){return this._json.createdBy},t.Resource.prototype.type=function(){return this._json.type},t.Resource.prototype.baseType=function(){return this._json.type.split("\\").shift()},t.Resource.prototype.createdDate=function(){return new Date(this._json.createdDate)},t.Resource.prototype.ctime=function(){return this.createdDate()},t.Resource.prototype.modifiedDate=function(){return new Date(this._json.modifiedDate)},t.Resource.prototype.mtime=function(){return this.modifiedDate()},t.Resource.prototype.public=function(){return this._json.public||!1},t.Resource.prototype.data=function(e,t){return void 0===e?this._json.data:this._json.data.hasOwnProperty(e)?this._json.data[e]:t},t.Resource.prototype.description=function(){return this._json.description||""},t.Resource.prototype.remove=function(e,n){return this.deferred(function(){return t.Resource.remove(this,n)})},t.Resource.prototype.update=function(e){return this.deferred(function(){return t.get(this,e)})},t.Resource.prototype.set=function(e,n){var r=[].slice.call(arguments);return this.deferred(function(){return r.unshift(this),t.Resource.set.apply(t,r)})},t.Resource.prototype.setData=function(e,t){if("string"==typeof e&&"function"!=typeof t){var n=e,r=t,t=arguments[2];(e={})[n]=r}return this.set({data:e},t)},t.list=t.find=function(e,n){var r=null,o=null;return 1==arguments.length?"function"==typeof arguments[0]?o=arguments[0]:r=arguments[0]:arguments.length>=2&&(r=arguments[0],o=arguments[1]),t.request({url:"/resources?"+t.utils.param({q:r}),method:"GET",dataType:"json",converter:t.resourceConverter},o)},t.Resource.usage=function(e){var n=e;return t.request({url:"/usage",dataType:"json",method:"GET"},n)},t.Resource.remove=function(e,n,r){var o;if(e instanceof t.Resource)o=e,e=e.id();else if(!i(e))throw"First argument must be a Resource object or a Resource id : "+e;return 2==arguments.length&&"function"==typeof n&&(r=n,n=!1),t.request({url:"/resources/"+e+"?"+t.utils.param({children:n}),method:"DELETE",context:o},r).done(function(){t.trigger("ething.resource.removed",[e])})},t.get=function(e,n){var r;if(e instanceof t.Resource)r=e,e=e.id();else if(!i(e))throw"First argument must be a Resource object or a Resource id : "+e;var o=n;return t.request({url:"/resources/"+e,dataType:"json",method:"GET",context:r,converter:t.resourceConverter},o)},t.Resource.set=function(e,n,r){var o;if(!s(n)||!n)throw"Second argument must be a unempty object !";if(e instanceof t.Resource)o=e,e=e.id();else if(!i(e))throw"First argument must be a Resource object or a Resource id : "+e;var a=r;return t.request({url:"/resources/"+e,dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:n,context:o,headers:{"X-HTTP-Method-Override":"PATCH"},converter:t.resourceConverter},a)},t.Resource.dirname=function(e){var t=e.replace(/\/[^\/]*\/?$/,"");return t===e?"":t},t.Resource.basename=function(e){return e.replace(/.*\//,"")},t.Resource.extension=function(e){return e.indexOf(".")>=0?e.split(".").pop():""},t.Resource.fnmatch=function(e,t){for(var n,r,o=e.split(" "),i=0;i<o.length;i++)if(""!=o[i]&&(n="^"+o[i].replace(/\//g,"\\/").replace(/\*\*/g,"(\\/[^\\/]+)*").replace(/\*/g,"[^\\/]+").replace(/((?!\\))\?/g,"$1.")+"$",n="^"+n+"$",r=new RegExp(n),null!=t.match(r)))return!0;return!1},t.settings=t.settings||{},t.settings.get=function(e){return t.request({url:"/settings",dataType:"json",method:"GET"},e)},t.settings.set=function(e,n){if(!s(e))throw"First argument must be an object !";return t.request({url:"/settings",dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:e,headers:{"X-HTTP-Method-Override":"PATCH"}},n)},t.notify=function(e,n,r){var o={};if(3==arguments.length)o.body=n,o.subject=e;else if(2==arguments.length)"string"==typeof n?(o.subject=e,o.body=n):(o.body=e,r=n);else{if(1!=arguments.length)throw"Bad arguments!";o.body=e}return t.request({url:"/notification",method:"POST",contentType:"application/json; charset=utf-8",data:o},r)};var g=function(e){return e},m=null,T=null,b=null,j=null,D=g;t.auth={},t.auth.isAuthenticated=function(){return!!j},t.auth.getApp=function(){return m},t.auth.getDevice=function(){return T},t.auth.getScope=function(){return b},t.auth.reset=function(){m=null,T=null,j=null,b=null,D=g},t.auth.setApiKey=function(e){t.auth.reset(),D=function(n){return"string"==typeof n?n=t.utils.insertParam(n,"api_key",e):n.setRequestHeader("X-API-KEY",e),n}},t.auth.setBasicAuth=function(n,r){t.auth.reset(),D=function(t){return"string"==typeof t?t=t.replace(/\/\/([^:]+:[^@]+@)?/,"//"+n+":"+r+"@"):t.setRequestHeader("Authorization","Basic "+e.btoa(n+":"+r)),t}},t.initialize=function(e,n,r){return t.auth.reset(),(e=o({apiUrl:null,apiKey:null,login:null,password:null},e||{})).apiUrl&&(t.config.apiUrl=e.apiUrl),e.apiKey?t.auth.setApiKey(e.apiKey):e.login&&e.password&&t.auth.setBasicAuth(e.login,e.password),t.request({url:"/auth",dataType:"json",context:t,converter:function(e){j=e.type,e.app&&(m=new t.App(e.app)),e.device&&(T=new t.Device.Http(e.device)),e.scope&&(b=e.scope)}}).done(function(){R.forEach(function(e){e.call(t)}),t.trigger("ething.authenticated")}).done(n).fail(r)};var R=[];t.authenticated=function(e){"function"==typeof e&&(R.push(e),t.auth.isAuthenticated()&&e.call(t))},e.EThing=t}(this),function(e){var t=e.EThing;t.File=function(e){t.Resource.call(this,e)},t.utils.inherits(t.File,t.Resource),t.File.prototype.size=function(){return this._json.size},t.File.prototype.expireAfter=function(){return this._json.expireAfter||null},t.File.prototype.mime=function(){return this._json.mime},t.File.prototype.contentModifiedDate=function(){return new Date(this._json.contentModifiedDate)},t.File.prototype.thumbnailLink=function(e){return this._json.hasThumbnail?t.toApiUrl("files/"+this.id()+"/thumbnail",e):null},t.File.prototype.getContentUrl=function(e){return t.toApiUrl("files/"+this.id(),e)},t.File.prototype.isText=function(){return this._json.isText},t.File.prototype.isScript=function(){return this._json.isText&&"application/javascript"===this._json.mime},t.File.prototype.execute=function(e,n){var e=[].slice.call(arguments);return this.deferred(function(){return e.unshift(this),t.File.execute.apply(t,e)})},t.File.prototype.read=function(e,n){var r=[].slice.call(arguments);return this.deferred(function(){return r.unshift(this),t.File.read.apply(t,r)})},t.File.prototype.write=function(e,n){var r=[].slice.call(arguments);return this.deferred(function(){return r.unshift(this),t.File.write.apply(t,r)})},t.File.create=function(e,n){return"string"==typeof e&&(e={name:e}),t.request({url:"/files",dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:e,converter:t.resourceConverter},n).done(function(e){t.trigger("ething.file.created",[e])})},t.File.read=function(e,n,r){var o;if(e instanceof t.File)o=e,e=e.id();else if(!isResourceId(e))throw"First argument must be a File object or a file id !";return void 0===r&&"function"==typeof n&&(r=n,n=!1),t.request({url:"/files/"+e,method:"GET",dataType:n?t.utils.isNode?"buffer":"blob":"text",context:o},r)},t.File.execute=function(e,n,r){var o;if(e instanceof t.File)o=e,e=e.id();else if(!isResourceId(e))throw"First argument must be a File object or a file id !";return void 0===r&&"function"==typeof n&&(r=n,n=null),t.request({url:"/files/"+e+"/execute?"+t.utils.param({args:n}),method:"GET",dataType:"json",context:o},r)},t.File.write=function(e,n,r){var o,i=null;if(e instanceof t.File)o=e,i=e.id();else{if(!isResourceId(e))throw"First argument must be a File object or a file id !";i=e}var s=r;return t.request({url:"/files/"+i,dataType:"json",method:"PUT",contentType:"string"==typeof n?"text/plain":"application/octet-stream",data:n,context:o,converter:t.resourceConverter},s)}}(this),function(e){var t=e.EThing;t.Table=function(e){t.Resource.call(this,e)},t.utils.inherits(t.Table,t.Resource),t.Table.prototype.length=function(){return this._json.length},t.Table.prototype.maxLength=function(){return this._json.maxLength},t.Table.prototype.expireAfter=function(){return this._json.expireAfter},t.Table.prototype.keys=function(){var e=[];for(var t in this._json.keys)this._json.keys.hasOwnProperty(t)&&e.push(t);return e},t.Table.prototype.contentModifiedDate=function(){return new Date(this._json.contentModifiedDate)},t.Table.prototype.select=function(e,n){var r=[].slice.call(arguments);return this.deferred(function(){return r.unshift(this),t.Table.select.apply(t,r)})},t.Table.prototype.computeStatistics=function(e,n,r){var o=[].slice.call(arguments);return this.deferred(function(){return o.unshift(this),t.Table.computeStatistics.apply(t,o)})},t.Table.prototype.removeRow=function(e,n){var r=[].slice.call(arguments);return this.deferred(function(){return r.unshift(this),t.Table.removeRow.apply(t,r)})},t.Table.prototype.replaceRow=function(e,n){var r=[].slice.call(arguments);return this.deferred(function(){return r.unshift(this),t.Table.replaceRow.apply(t,r)})},t.Table.prototype.findOneAndReplace=function(e,n,r,o){var i=[].slice.call(arguments);return this.deferred(function(){return i.unshift(this),t.Table.findOneAndReplace.apply(t,i)})},t.Table.prototype.insert=function(e,n){var r=[].slice.call(arguments);return this.deferred(function(){return r.unshift(this),t.Table.insert.apply(this,r)})},t.Table.prototype.import=function(e,n){var r=[].slice.call(arguments);return this.deferred(function(){return r.unshift(this),t.Table.import.apply(this,r)})},t.Table.prototype.getContentUrl=function(e){return t.toApiUrl("tables/"+this.id(),e)},t.Table.create=function(e,n){return"string"==typeof e&&(e={name:e}),t.request({url:"/tables",dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:e,converter:t.resourceConverter},n).done(function(e){t.trigger("ething.table.created",[e])})},t.Table.select=function(e,n,r){var o,i=null;if(e instanceof t.Table)o=e,i=e.id();else{if(!isResourceId(e))throw"First argument must be a Table object or a table id !";i=e}return void 0===r&&"function"==typeof n&&(r=n,n=null),n=n||{},Array.isArray(n.fields)&&(n.fields=n.fields.join(",")),t.request({url:"/tables/"+i+"?"+t.utils.param({start:n.start,length:n.length,sort:n.sort,q:n.query,fields:n.fields,datefmt:n.datefmt}),method:"GET",dataType:"json",context:o},r)},t.Table.computeStatistics=function(e,n,r,o){var i,s=null;if(e instanceof t.Table)i=e,s=e.id();else{if(!isResourceId(e))throw"First argument must be a Table object or a table id !";s=e}return void 0===o&&"function"==typeof r&&(o=r,r=null),t.request({url:"/tables/"+s+"/statistics?"+t.utils.param({key:n,q:r}),method:"GET",dataType:"json",context:i},o)},t.Table.removeRow=function(e,n,r){var o,i=null;if(e instanceof t.Table)o=e,i=e.id();else{if(!isResourceId(e))throw"First argument must be a Table object or a table id !";i=e}var s=Array.isArray(n)?n:[n],a=r;return t.request({url:"/tables/"+i+"/remove",dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:s,context:o,converter:t.resourceConverter},a)},t.Table.replaceRow=function(e,n,r){var o,i=null;if(e instanceof t.Table)o=e,i=e.id();else{if(!isResourceId(e))throw"First argument must be a Table object or a table id !";i=e}if("object"==typeof n&&!isResourceId(n.id))throw"Second argument must be an object containing at least a document id";var s=n.id,a=r;return t.request({url:"/tables/"+i+"/id/"+s,dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:n,context:o,headers:{"X-HTTP-Method-Override":"PATCH"}},a)},t.Table.findOneAndReplace=function(e,n,r,o,i){var s,a=null,u=i,c=!1;if(e instanceof t.Table)s=e,a=e.id();else{if(!isResourceId(e))throw"First argument must be a Table object or a table id !";a=e}if("string"!=typeof n)throw"Second argument must be a query string";if("object"!=typeof r)throw"Third argument must be an object";return void 0===i&&"function"==typeof o&&(u=o,c=!1),"boolean"==typeof o&&(c=o),t.request({url:"/tables/"+a+"/replace?"+t.utils.param({q:n,upsert:c}),dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:r,context:s,converter:t.resourceConverter},u)},t.Table.insert=function(e,n,r,o){var i,s,a,u=null;if(e instanceof t.Table)s=e,u=e.id();else{if(!isResourceId(e))throw"First argument must be a Table object or a table id !";u=e}return"string"==typeof r?(a=r,i=o):i=r,t.request({url:"/tables/"+u+"?"+t.utils.param({invalid_field:a}),dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:n,context:s,converter:t.resourceConverter},i)},t.Table.import=function(e,n){var r,o,i,s;if(e instanceof t.Table)r=e,e=e.id();else if(!isResourceId(e))throw"First argument must be a Table object or a table id !";if(!Array.isArray(n))throw"The data must be an array of objects";for(var a=2;a<arguments.length;a++)switch(typeof arguments[a]){case"function":s=arguments[a];break;case"boolean":i=arguments[a];break;case"string":o=arguments[a]}return t.request({url:"/tables/"+e+"?"+t.utils.param({skip_error:i,invalid_field:o}),dataType:"json",method:"PUT",contentType:"application/json; charset=utf-8",data:n,context:r,converter:t.resourceConverter},s)}}(this),function(e){var t=e.EThing;t.App=function(e){t.Resource.call(this,e)},t.utils.inherits(t.App,t.Resource),t.App.prototype.size=function(){return this._json.size||0},t.App.prototype.iconLink=function(e){return this._json.hasIcon?t.toApiUrl("apps/"+this.id()+"/icon",e):null},t.App.prototype.getContentUrl=function(e){return t.toApiUrl("apps/"+this.id(),e)},t.App.prototype.contentModifiedDate=function(){return new Date(this._json.contentModifiedDate)},t.App.prototype.scope=function(){return"string"==typeof this._json.scope?this._json.scope:""},t.App.prototype.version=function(){return this._json.version||null},t.App.prototype.read=function(e){var n=[].slice.call(arguments);return this.deferred(function(){return n.unshift(this),t.App.read.apply(t,n)})},t.App.prototype.write=function(e,n){var r=[].slice.call(arguments);return this.deferred(function(){return r.unshift(this),t.App.write.apply(t,r)})},t.App.create=function(n,r){if(n.content&&(n.content=e.btoa(n.content)),n.icon){if(n.icon instanceof Blob){if(!FileReader)throw"no FileReader instance found";var o=new FileReader,i=t.utils.Deferred();return o.onloadend=function(){n.icon=o.result.substr(o.result.indexOf(";base64,")+8),t.request({url:"/apps",dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:n,converter:t.resourceConverter}).done(function(){i.resolveWith(this,Array.prototype.slice.call(arguments))}).fail(function(){i.rejectWith(this,Array.prototype.slice.call(arguments))})},o.readAsDataURL(n.icon),i.done(r).done(function(){t.trigger("ething.app.created",[this])}).promise()}if(n.icon instanceof ArrayBuffer){for(var s="",a=new Uint8Array(n.icon),u=0;u<a.byteLength;u++)s+=String.fromCharCode(a[u]);n.icon=e.btoa(s)}else if("string"!=n.icon)throw"invalid type for the icon attribute"}return t.request({url:"/apps",dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:n,converter:t.resourceConverter},r).done(function(e){t.trigger("ething.app.created",[e])})},t.App.read=function(e,n){var r,o=null;if(e instanceof t.App)r=e,o=e.id();else{if(!isResourceId(e))throw"First argument must be a File object or a file id !";o=e}var i=n;return t.request({url:"/apps/"+o,method:"GET",dataType:"text",context:r},i)},t.App.write=function(e,n,r){var o,i=null;if(e instanceof t.App)o=e,i=e.id();else{if(!isResourceId(e))throw"First argument must be a File object or a file id !";i=e}if("string"!=typeof n)throw"Second argument must be a string !";var s=r;return t.request({url:"/apps/"+i,dataType:"json",method:"PUT",contentType:"string"==typeof n?"text/plain":"application/octet-stream",data:n,context:o,converter:t.resourceConverter},s)},t.App.getIcon=function(e,n){var r,o=null;if(e instanceof t.App)r=e,o=e.id();else{if(!isResourceId(e))throw"First argument must be a File object or a file id !";o=e}var i=n;return t.request({url:"/apps/"+o+"/icon",method:"GET",dataType:t.utils.isNode?"buffer":"blob",context:r},i)}}(this),function(e){var t=e.EThing;t.Device=function(e){t.Resource.call(this,e),(this._json.operations||[]).forEach(function(e){if(void 0===this[e]){var n=this;this[e]=function(n,r,o){var i=[].slice.call(arguments);return this.deferred(function(){return i.unshift(e),i.unshift(this),t.Device.execute.apply(t,i)})},this[e].getApi=function(r){return t.Device.getApi(n,e,r)},this[e].executeUrl=function(t){return n.executeUrl(e,t)}}},this)},t.utils.inherits(t.Device,t.Resource),t.Device.prototype.location=function(){return this._json.location||null},t.Device.prototype.lastSeenDate=function(){return"string"==typeof this._json.lastSeenDate?new Date(this._json.lastSeenDate):null},t.Device.prototype.hasBattery=function(){return"number"==typeof this._json.battery&&this._json.battery>=0},t.Device.prototype.battery=function(){return this.hasBattery()?this._json.battery:null},t.Device.prototype.operations=function(){return this._json.operations?this._json.operations:[]},t.Device.prototype.execute=function(){var e=[].slice.call(arguments);return this.deferred(function(){return e.unshift(this),t.Device.execute.apply(t,e)})},t.Device.prototype.executeUrl=function(e,n){var r="devices/"+this.id()+"/call/"+e;if(isPlainObject(n)&&0!==Object.keys(n).length){var o=JSON.stringify(n);r+="?paramData="+encodeURIComponent(o)}return t.toApiUrl(r,!0)},t.Device.prototype.getApi=function(e,n){var r=[].slice.call(arguments);return this.deferred(function(){return r.unshift(this),t.Device.getApi.apply(t,r)})},t.Device.execute=function(e,n,r,o,i){var s;if(e instanceof t.Device)s=e,e=e.id();else{if(!isResourceId(e))throw"First argument must be a Device object or a Device id !";e=e}return 4==arguments.length?"function"==typeof o&&(i=o,o=void 0):3==arguments.length&&"function"==typeof r&&(i=r,r=void 0),t.request({url:"/devices/"+e+"/call/"+n,method:"POST",contentType:"application/json; charset=utf-8",data:void 0!==r&&null!==r?JSON.stringify(r):void 0,dataType:o?t.utils.isNode?"buffer":"blob":"auto",context:s},i)},t.Device.getApi=function(e,n,r){var o;if("function"==typeof n&&void 0===r&&(r=n,n=void 0),e instanceof t.Device)o=e,e=e.id();else{if(!isResourceId(e))throw"First argument must be a Device object or a Device id !";e=e}return t.request({url:"/devices/"+e+"/api"+(n?"/"+n:""),method:"GET",context:o,dataType:"json"},r)}}(this),function(e){function t(){l=[],p=null,f=null}function n(e){return c.request({url:"/resources",method:"GET",dataType:"json"}).then(function(e){return e=e.map(function(e){return c.instanciate(e)}).filter(function(e){return e}),r(e,!0),l}).done(e)}function r(e,t,n){Array.isArray(e)||(e=[e]);var r=[],i=[],s=[];if(t&&(l.forEach(function(t,n){if(!(t instanceof c.Folder)){for(var o in e)if(e[o].id()===t.id())return;r.push(n)}}),r.map(function(e){var t=l[e];return l.splice(e,1),t})),e.forEach(function(t,n){var r=!1;for(var a in l)if(l[a].id()===t.id()){r=a;break}if(!1===r)i.push(t),o(t);else{var u=l[r];u._fromJson(t.json())&&s.push(u),e[n]=u}}),t)for(var a=0;a<l.length;a++){var u=l[a];u instanceof c.Folder&&0==u.find(function(e){return!(e instanceof c.Folder)}).length&&(r.push(u),l.splice(a,1),a--)}var p=r.length>0||i.length>0||s.length>0;return!n&&p&&c.trigger("ething.arbo.changed",[i,r,s]),{resources:e,removed:r,added:i,updated:s,hasChanged:p}}function o(e){l.push(e);for(var t=e.dirname(),n=!1,r=0;r<l.length;r++)if(l[r]instanceof c.Folder&&l[r].name()===t){n=!0;break}return n||o(new c.Folder({name:t})),e}function i(e,t,n){if(Array.isArray(e))e.forEach(function(e){i(e,t)});else if(("string"!=typeof e||(e=s(e)))&&!0!==e.isRoot){var r=[];e instanceof c.Folder&&e.children().forEach(function(e){i(e,!0)});for(var o=0;o<l.length;o++){var a=l[o];if(a.id()==e.id()){if(r.push(a),l.splice(o,1),!t){var u=a.parent();u&&0==u.children().length&&i(u)}break}}!n&&r.length&&c.trigger("ething.arbo.changed",[[],r,[]])}}function s(e){for(var t=0;t<l.length;t++)if(l[t].id()===e)return l[t]}function a(e,t){return l.filter(function(n){if(!t||n.type()===t){var r=n.name();return"function"==typeof e?!!e.call(n,n):"string"==typeof e?r===e:Array.isArray(e)?e.indexOf(r)>=0:!(e instanceof RegExp)||e.test(r)}})}function u(){return l}var c=e.EThing||{},l=[],p=null,f=null;c.Folder=function(e){e.id||(e.id="/"+e.name),""===e.name&&(this.isRoot=!0),c.Resource.call(this,c.utils.extend({type:"Folder"},e))},c.utils.inherits(c.Folder,c.Resource),c.Folder.prototype.createdDate=function(){for(var e=this.find(),t=null,n=0;n<e.length;n++)(null===t||t>e[n].createdDate())&&(t=e[n].createdDate());return t},c.Folder.prototype.modifiedDate=function(){for(var e=this.find(),t=null,n=0;n<e.length;n++)(null===t||t<e[n].modifiedDate())&&(t=e[n].modifiedDate());return t},c.Folder.prototype.remove=function(e){var t=this;return this.deferred(function(){var n=[];return this.children().forEach(function(e){n.push(e.remove())}),c.utils.Deferred.when.apply(c.utils.Deferred,n).done(function(){"function"==typeof e&&e.call(t)})})},c.Folder.prototype.set=null,c.Folder.prototype.setData=null,c.Folder.prototype.location,c.Folder.prototype.description,c.Folder.prototype.data,c.Folder.prototype.createdBy,c.Folder.prototype.extension=function(){return""},c.Folder.prototype.children=function(e,t){var n=this._json.name.length?this._json.name+"/":"",r=a(new RegExp("^"+n+"[^/]+$"));return void 0!==e&&e&&(r=r.filter(function(r){if(!t||r.type()===t){var o=r.name().substr(n.length);if("function"==typeof e)return!!e.call(r,r,o);if("string"==typeof e)return o===e;if(Array.isArray(e))return e.indexOf(o)>=0;if(e instanceof RegExp)return e.test(o)}})),r},c.Folder.prototype.ls=c.Folder.prototype.children,c.Folder.prototype.find=function(e,t){var n=this._json.name.length?this._json.name+"/":"",r=a(n.length?new RegExp("^"+n):new RegExp("^.+"));return void 0!==e&&e&&(r=r.filter(function(r){if(!t||r.type()===t){var o=r.name().substr(n.length);if("function"==typeof e)return!!e.call(r,r,o);if("string"==typeof e)return o===e;if(Array.isArray(e))return e.indexOf(o)>=0;if(e instanceof RegExp)return e.test(o)}})),r},c.Folder.prototype.findOne=function(e,t){var n=this.find(e,t);return n.length?n[0]:null},c.Folder.prototype.length=function(){return this.children().length},c.Resource.prototype.parent=function(){if(!this.isRoot)return s("/"+this.dirname())},c.on("ething.resource.removed",function(e,t){var n=s(t);n&&i(n)}),e.EThing=e.EThing||{},e.EThing.arbo={load:function(e,n){var r;if(p&&!n)r=!0===p?(new c.utils.Deferred).resolve().promise():p;else{var i=new c.utils.Deferred;t(),c.request({url:"/resources",method:"GET",dataType:"json"}).done(function(e){p=!0,l=[],f=new c.Folder({name:""}),l.push(f),e.forEach(function(e){(e=c.instanciate(e))&&o(e)}),i.resolve()}),p=r=i.promise()}return r.done(function(){"function"==typeof e&&e(u()),c.trigger("ething.arbo.loaded")})},lastRefreshTs:0,refresh:function(){return this.lastRefreshTs=Date.now(),n.apply(this,Array.prototype.slice.call(arguments))},remove:i,update:r,findOneById:s,list:u,find:a,findOne:function(e,t){var n=a(e,t);return n.length?n[0]:null},isLoaded:function(){return!0===p||p&&"resolved"==p.state()},root:function(){return f}},e.EThing=c}(this),function(e){var t=e.EThing||{};t.Rule=function(e){this._json=e,t.DeferredObject.call(this)},t.utils.inherits(t.Rule,t.DeferredObject),t.Rule.prototype.id=function(){return this._json.id},t.Rule.prototype.events=function(){return this._json.events},t.Rule.prototype.conditions=function(){return this._json.conditions},t.Rule.prototype.actions=function(){return this._json.actions},t.Rule.prototype.enabled=function(){return!!this._json.enabled},t.Rule.prototype.isInvalid=function(){var e=!1;return this.conditions().forEach(function(t){if(!0===t.isInvalid)return e=!0,!1}),e},t.Rule.prototype.name=function(){return this._json.name},t.Rule.prototype.priority=function(){return this._json.priority},t.Rule.prototype.repeat=function(){return this._json.repeat},t.Rule.prototype.createdDate=function(){return new Date(this._json.createdDate)},t.Rule.prototype.executedDate=function(){return this._json.executedDate?new Date(this._json.executedDate):null},t.Rule.prototype.executedCount=function(){return this._json.executedCount},t.Rule.prototype.remove=function(e){return this.deferred(function(){return t.Rule.remove(this,e)})},t.Rule.prototype.set=function(e,n){return this.deferred(function(){return t.Rule.set(this,e,n)})};var n=function(e,n){return"object"==typeof e&&null!==e&&(Array.isArray(e)?e=e.map(function(e){return new t.Rule(e)}):this instanceof t.Rule&&this.id()===e.id?(this._json=e,e=this):e=new t.Rule(e)),e};t.listRules=function(e){return t.request({url:"/rules",method:"GET",dataType:"json",converter:n},e)},t.getRule=function(e,r){var o;if(e instanceof t.Rule)o=e,e=e.id();else if(!t.utils.isId(e))throw"First argument must be a Rule object or a Rule id !";var i=r;return t.request({url:"/rules/"+e,dataType:"json",method:"GET",context:o,converter:n},i)},t.Rule.create=function(e,r){return t.request({url:"/rules",dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:e,converter:n},r)},t.Rule.remove=function(e,n){var r;if(e instanceof t.Rule)r=e,e=e.id();else if(!t.utils.isId(e))throw"First argument must be a Rule object or a Rule id !";var o=n;return t.request({url:"/rules/"+e,method:"DELETE",context:r},o)},t.Rule.set=function(e,r,o){var i;if(!t.utils.isPlainObject(r)||!r)throw"Second argument must be a unempty object !";if(e instanceof t.Rule)i=e,e=e.id();else if(!t.utils.isId(e))throw"First argument must be a Rule object or a Rule id !";var s=o;return t.request({url:"/rules/"+e,dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:r,context:i,headers:{"X-HTTP-Method-Override":"PATCH"},converter:n},s)},t.Rule.trigger=function(e,n){return t.request({url:"/rules/trigger/"+encodeURIComponent(e),method:"POST"},n)}}(this),function(e){var t=e.EThing;t.Device.Denon=function(e){t.Device.call(this,e)},t.utils.inherits(t.Device.Denon,t.Device),t.Device.Denon.prototype.host=function(){return this._json.host},t.Device.Denon.prototype.isReachable=function(){return!!this._json.reachable},t.Device.Denon.create=function(e,n){return e.type="Denon",t.request({url:"/devices",dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:e,converter:t.resourceConverter},n).done(function(e){t.trigger("ething.device.created",[e])})}}(this),function(e){var t=e.EThing;t.Device.Http=function(e){t.Device.call(this,e)},t.utils.inherits(t.Device.Http,t.Device),t.Device.Http.prototype.url=function(){return this._json.url},t.Device.Http.prototype.auth=function(){return this._json.auth},t.Device.Http.prototype.scope=function(){return"string"==typeof this._json.scope?this._json.scope:""},t.Device.Http.prototype.isReachable=function(){return!!this._json.reachable},t.Device.Http.prototype.request=function(e){var n=[].slice.call(arguments);return this.deferred(function(){return n.unshift(this),t.Device.Http.request.apply(t,n)})},t.Device.Http.prototype.ajax=t.Device.Http.prototype.request,t.Device.Http.prototype.getResourceUrl=function(e,n){return t.Device.Http.getResourceUrl(this,e,n)},t.Device.Http.prototype.setSpecification=function(e,t){return"string"==typeof e&&(e=JSON.parse(e)),this.set({specification:e},t)},t.Device.Http.prototype.getSpecification=function(e){return t.Device.Http.getSpecification(this,e)},t.Device.Http.create=function(e,n){return e.type="Http",t.request({url:"/devices",dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:e,converter:t.resourceConverter},n).done(function(e){t.trigger("ething.device.created",[e])})},t.Device.Http.getResourceUrl=function(e,n,r){e instanceof t.Device.Http&&(e=e.id());var o="devices/"+e+"/request";return"string"==typeof n&&(/^\//.test(n)||(n="/"+n),o+=n),t.toApiUrl(o,r)},t.Device.Http.ajax=t.Device.Http.request=function(e,n){var r,o;if(e instanceof t.Device.Http)o=e,r=e.id();else{if(!isResourceId(e))throw"First argument must be a Device object or a Device id !";r=e}var i={url:null,context:o};return"string"==typeof n?i.url=n:extend(i,n),i.url=t.Device.Http.getResourceUrl(r,i.url),t.request(i)},t.Device.Http.getSpecification=function(e,n){var r;if(e instanceof t.Device.Http)r=e,e=e.id();else if(!t.utils.isId(e))throw"First argument must be a Device object or a Device id !";return t.request({url:"/devices/"+e+"/specification",dataType:"json",context:r,converter:function(e){return r instanceof t.Device.Http&&(r.swaggerSpecification=e),e}},n)}}(this),function(e){var t=e.EThing;t.Device.MQTT=function(e){t.Device.call(this,e)},t.utils.inherits(t.Device.MQTT,t.Device),t.Device.MQTT.prototype.host=function(){return this._json.host},t.Device.MQTT.prototype.port=function(){return this._json.port},t.Device.MQTT.prototype.auth=function(){return this._json.auth||null},t.Device.MQTT.prototype.isConnected=function(){return!!this._json.connected},t.Device.MQTT.prototype.setSubscription=function(e,t){return"string"==typeof spec&&(spec=JSON.parse(e)),this.set({subscription:e},t)},t.Device.MQTT.prototype.getSubscription=function(e){return t.Device.MQTT.getSubscription(this,e)},t.Device.MQTT.create=function(e,n){return e.type="MQTT",t.request({url:"/devices",dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:e,converter:t.resourceConverter},n).done(function(e){t.trigger("ething.device.created",[e])})},t.Device.MQTT.getSubscription=function(e,n){var r;if(e instanceof t.Device.MQTT)r=e,e=e.id();else if(!t.utils.isId(e))throw"First argument must be a Device object or a Device id !";return t.request({url:"/devices/"+e+"/subscription",dataType:"json",context:r,converter:function(e){return r instanceof t.Device.MQTT&&(r.subscription=e),e}},n)}}(this),function(e){var t=e.EThing;t.Device.MySensorsGateway=function(e){t.Device.call(this,e)},t.utils.inherits(t.Device.MySensorsGateway,t.Device),t.Device.MySensorsGateway.prototype.isMetric=function(){return this._json.isMetric},t.Device.MySensorsGateway.prototype.libVersion=function(){return this._json.libVersion},t.Device.MySensorsGateway.prototype.isConnected=function(){return!!this._json.connected},t.Device.MySensorsEthernetGateway=function(e){t.Device.call(this,e)},t.utils.inherits(t.Device.MySensorsEthernetGateway,t.Device.MySensorsGateway),t.Device.MySensorsEthernetGateway.prototype.address=function(){return this._json.address},t.Device.MySensorsSerialGateway=function(e){t.Device.call(this,e)},t.utils.inherits(t.Device.MySensorsSerialGateway,t.Device.MySensorsGateway),t.Device.MySensorsSerialGateway.prototype.port=function(){return this._json.port},t.Device.MySensorsSerialGateway.prototype.baudrate=function(){return this._json.baudrate},t.Device.MySensorsNode=function(e){t.Device.call(this,e)},t.utils.inherits(t.Device.MySensorsNode,t.Device),t.Device.MySensorsNode.prototype.nodeId=function(){return this._json.nodeId},t.Device.MySensorsNode.prototype.sketchName=function(){return this._json.sketchName},t.Device.MySensorsNode.prototype.sketchVersion=function(){return this._json.sketchVersion},t.Device.MySensorsNode.prototype.smartSleep=function(){return this._json.smartSleep},t.Device.MySensorsSensor=function(e){t.Device.call(this,e)},t.utils.inherits(t.Device.MySensorsSensor,t.Device),t.Device.MySensorsSensor.prototype.sensorId=function(){return this._json.sensorId},t.Device.MySensorsSensor.prototype.sensorType=function(){return this._json.sensorType},t.Device.MySensorsSensor.prototype.val=function(e){return this._json.data.hasOwnProperty(e)?this._json.data[e]:null},t.Device.MySensorsSensor.prototype.setValue=function(e,t,n){var r={};return r[e]=t,this.setData(r,n)},t.Device.MySensorsEthernetGateway.create=function(e,n){return e.type="MySensorsEthernetGateway",t.request({url:"/devices",dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:e,converter:t.resourceConverter},n).done(function(e){t.trigger("ething.device.created",[e])})},t.Device.MySensorsSerialGateway.create=function(e,n){return e.type="MySensorsSerialGateway",t.request({url:"/devices",dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:e,converter:t.resourceConverter},n).done(function(e){t.trigger("ething.device.created",[e])})},t.Device.MySensorsNode.create=function(e,n){return e.type="MySensorsNode",t.request({url:"/devices",dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:e,converter:t.resourceConverter},n).done(function(e){t.trigger("ething.device.created",[e])})},t.Device.MySensorsSensor.create=function(e,n){return e.type="MySensorsSensor",t.request({url:"/devices",dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:e,converter:t.resourceConverter},n).done(function(e){t.trigger("ething.device.created",[e])})}}(this),function(e){var t=e.EThing;t.Device.RFLinkGateway=function(e){t.Device.call(this,e)},t.utils.inherits(t.Device.RFLinkGateway,t.Device),t.Device.RFLinkGateway.prototype.inclusion=function(){return!!this._json.inclusion},t.Device.RFLinkGateway.prototype.version=function(){return this._json.version},t.Device.RFLinkGateway.prototype.revision=function(){return this._json.revision},t.Device.RFLinkGateway.prototype.build=function(){return this._json.build},t.Device.RFLinkGateway.prototype.isConnected=function(){return!!this._json.connected},t.Device.RFLinkSerialGateway=function(e){t.Device.call(this,e)},t.utils.inherits(t.Device.RFLinkSerialGateway,t.Device.RFLinkGateway),t.Device.RFLinkSerialGateway.prototype.port=function(){return this._json.port},t.Device.RFLinkSerialGateway.prototype.baudrate=function(){return this._json.baudrate},t.Device.RFLinkNode=function(e){t.Device.call(this,e)},t.utils.inherits(t.Device.RFLinkNode,t.Device),t.Device.RFLinkNode.prototype.protocol=function(){return this._json.protocol},t.Device.RFLinkNode.prototype.nodeId=function(){return this._json.nodeId},t.Device.RFLinkNode.prototype.switchId=function(){return this._json.switchId},t.Device.RFLinkNode.prototype.subType=function(){return this._json.subType},t.Device.RFLinkSerialGateway.create=function(e,n){return e.type="RFLinkSerialGateway",t.request({url:"/devices",dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:e,converter:t.resourceConverter},n).done(function(e){t.trigger("ething.device.created",[e])})},t.Device.RFLinkNode.create=function(e,n){return e.type="RFLinkNode",t.request({url:"/devices",dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:e,converter:t.resourceConverter},n).done(function(e){t.trigger("ething.device.created",[e])})}}(this),function(e){var t=e.EThing;t.Device.RTSP=function(e){t.Device.call(this,e)},t.utils.inherits(t.Device.RTSP,t.Device),t.Device.RTSP.prototype.url=function(){return this._json.url},t.Device.RTSP.prototype.transport=function(){return this._json.transport},t.Device.RTSP.prototype.isReachable=function(){return!!this._json.reachable},t.Device.RTSP.create=function(e,n){return e.type="RTSP",t.request({url:"/devices",dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:e,converter:t.resourceConverter},n).done(function(e){t.trigger("ething.device.created",[e])})}}(this),function(e){var t=e.EThing;t.Device.SSH=function(e){t.Device.call(this,e)},t.utils.inherits(t.Device.SSH,t.Device),t.Device.SSH.prototype.host=function(){return this._json.host},t.Device.SSH.prototype.port=function(){return this._json.port},t.Device.SSH.prototype.auth=function(){return this._json.auth||null},t.Device.SSH.prototype.isReachable=function(){return!!this._json.reachable},t.Device.SSH.create=function(e,n){return e.type="SSH",t.request({url:"/devices",dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:e,converter:t.resourceConverter},n).done(function(e){t.trigger("ething.device.created",[e])})}}(this),function(e){var t=e.EThing;t.Device.Yeelight=function(e){t.Device.call(this,e)},t.utils.inherits(t.Device.Yeelight,t.Device),t.Device.Yeelight.prototype.host=function(){return this._json.host},t.Device.Yeelight.prototype.isConnected=function(){return!!this._json.connected},t.Device.YeelightBulbRGBW=function(e){t.Device.Yeelight.call(this,e)},t.utils.inherits(t.Device.YeelightBulbRGBW,t.Device.Yeelight),t.Device.YeelightBulbRGBW.create=function(e,n){return e.type="YeelightBulbRGBW",t.request({url:"/devices",dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:e,converter:t.resourceConverter},n).done(function(e){t.trigger("ething.device.created",[e])})}}(this);