(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[6],{"33YK":function(e,t,n){(function(t){e.exports=function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=19)}([function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t){var n=e.exports={version:"2.5.3"};"number"==typeof __e&&(__e=n)},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){var o=n(23),i=n(28);e.exports=n(4)?function(e,t,n){return o.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){e.exports=!n(6)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,n){var o=n(0),i=n(1),r=n(3),s=n(29),a=n(8),c=function(e,t,n){var d,u,l,f,p=e&c.F,h=e&c.G,v=e&c.S,g=e&c.P,m=e&c.B,_=h?o:v?o[t]||(o[t]={}):(o[t]||{}).prototype,b=h?i:i[t]||(i[t]={}),y=b.prototype||(b.prototype={});for(d in h&&(n=t),n)u=!p&&_&&void 0!==_[d],l=(u?_:n)[d],f=m&&u?a(l,o):g&&"function"==typeof l?a(Function.call,l):l,_&&s(_,d,l,e&c.U),b[d]!=l&&r(b,d,f),g&&y[d]!=l&&(y[d]=l)};o.core=i,c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,e.exports=c},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){var n=0,o=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+o).toString(36))}},function(e,t,n){var o=n(31);e.exports=function(e,t,n){if(o(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,o){return e.call(t,n,o)};case 3:return function(n,o,i){return e.call(t,n,o,i)}}return function(){return e.apply(t,arguments)}}},function(e,t,n){var o=n(10);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==o(e)?e.split(""):Object(e)}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,n){var o=n(13),i=Math.min;e.exports=function(e){return e>0?i(o(e),9007199254740991):0}},function(e,t){var n=Math.ceil,o=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?o:n)(e)}},function(e,t,n){var o=n(15)("unscopables"),i=Array.prototype;void 0==i[o]&&n(3)(i,o,{}),e.exports=function(e){i[o][e]=!0}},function(e,t,n){var o=n(35)("wks"),i=n(7),r=n(0).Symbol,s="function"==typeof r;(e.exports=function(e){return o[e]||(o[e]=s&&r[e]||(s?r:i)("Symbol."+e))}).store=o},function(e,t){e.exports=function(e,t,n,o,i){var r,s=e=e||{},a=typeof e.default;"object"!==a&&"function"!==a||(r=e,s=e.default);var c,d="function"==typeof s?s.options:s;if(t&&(d.render=t.render,d.staticRenderFns=t.staticRenderFns),o&&(d._scopeId=o),i?(c=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),n&&n.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(i)},d._ssrRegister=c):n&&(c=n),c){var u=d.functional,l=u?d.render:d.beforeCreate;u?d.render=function(e,t){return c.call(t),l(e,t)}:d.beforeCreate=l?[].concat(l,c):[c]}return{esModule:r,exports:s,options:d}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={data:void 0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){return e.reduce(function(e,t){return(e[t]=t)&&e},{})};t.events=o(["drag","dragend","dragenter","dragleave","dragstart","dragover","drop"]),t.dropEffects=o(["copy","move","link","none"]),t.effectsAllowed=o(["none","copy","copyLink","copyMove","link","linkMove","move","all","uninitialized"])},function(e,t,n){n(20),e.exports=n(43)},function(e,t,n){"use strict";n(21),n(36)},function(e,t,n){n(22),e.exports=n(1).Array.includes},function(e,t,n){"use strict";var o=n(5),i=n(32)(!0);o(o.P,"Array",{includes:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(14)("includes")},function(e,t,n){var o=n(24),i=n(25),r=n(27),s=Object.defineProperty;t.f=n(4)?Object.defineProperty:function(e,t,n){if(o(e),t=r(t,!0),o(n),i)try{return s(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){var o=n(2);e.exports=function(e){if(!o(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){e.exports=!n(4)&&!n(6)(function(){return 7!=Object.defineProperty(n(26)("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){var o=n(2),i=n(0).document,r=o(i)&&o(i.createElement);e.exports=function(e){return r?i.createElement(e):{}}},function(e,t,n){var o=n(2);e.exports=function(e,t){if(!o(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!o(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!o(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!o(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){var o=n(0),i=n(3),r=n(30),s=n(7)("src"),a=Function.toString,c=(""+a).split("toString");n(1).inspectSource=function(e){return a.call(e)},(e.exports=function(e,t,n,a){var d="function"==typeof n;d&&(r(n,"name")||i(n,"name",t)),e[t]!==n&&(d&&(r(n,s)||i(n,s,e[t]?""+e[t]:c.join(String(t)))),e===o?e[t]=n:a?e[t]?e[t]=n:i(e,t,n):(delete e[t],i(e,t,n)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[s]||a.call(this)})},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){var o=n(33),i=n(12),r=n(34);e.exports=function(e){return function(t,n,s){var a,c=o(t),d=i(c.length),u=r(s,d);if(e&&n!=n){for(;d>u;)if((a=c[u++])!=a)return!0}else for(;d>u;u++)if((e||u in c)&&c[u]===n)return e||u||0;return!e&&-1}}},function(e,t,n){var o=n(9),i=n(11);e.exports=function(e){return o(i(e))}},function(e,t,n){var o=n(13),i=Math.max,r=Math.min;e.exports=function(e,t){return e=o(e),e<0?i(e+t,0):r(e,t)}},function(e,t,n){var o=n(0),i=o["__core-js_shared__"]||(o["__core-js_shared__"]={});e.exports=function(e){return i[e]||(i[e]={})}},function(e,t,n){n(37),e.exports=n(1).Array.find},function(e,t,n){"use strict";var o=n(5),i=n(38)(5),r=!0;"find"in[]&&Array(1).find(function(){r=!1}),o(o.P+o.F*r,"Array",{find:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(14)("find")},function(e,t,n){var o=n(8),i=n(9),r=n(39),s=n(12),a=n(40);e.exports=function(e,t){var n=1==e,c=2==e,d=3==e,u=4==e,l=6==e,f=5==e||l,p=t||a;return function(t,a,h){for(var v,g,m=r(t),_=i(m),b=o(a,h,3),y=s(_.length),x=0,w=n?p(t,y):c?p(t,0):void 0;y>x;x++)if((f||x in _)&&(v=_[x],g=b(v,x,m),e))if(n)w[x]=g;else if(g)switch(e){case 3:return!0;case 5:return v;case 6:return x;case 2:w.push(v)}else if(u)return!1;return l?-1:d||u?u:w}}},function(e,t,n){var o=n(11);e.exports=function(e){return Object(o(e))}},function(e,t,n){var o=n(41);e.exports=function(e,t){return new(o(e))(t)}},function(e,t,n){var o=n(2),i=n(42),r=n(15)("species");e.exports=function(e){var t;return i(e)&&(t=e.constructor,"function"!=typeof t||t!==Array&&!i(t.prototype)||(t=void 0),o(t)&&null===(t=t[r])&&(t=void 0)),void 0===t?Array:t}},function(e,t,n){var o=n(10);e.exports=Array.isArray||function(e){return"Array"==o(e)}},function(e,n,o){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e){e.component("drag",a.default),e.component("drop",d.default)}Object.defineProperty(n,"__esModule",{value:!0}),n.Drop=n.Drag=void 0,n.install=r;var s=o(44),a=i(s),c=o(47),d=i(c);n.Drag=a.default,n.Drop=d.default;var u={version:"1.1.4",install:r};n.default=u;var l=null;"undefined"!=typeof window?l=window.Vue:"undefined"!=typeof t&&(l=t.Vue),l&&l.use(u)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(45),i=n.n(o),r=n(46),s=n(16),a=s(i.a,r.a,null,null,"319bdce9");t.default=a.exports},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(17),i=function(e){return e&&e.__esModule?e:{default:e}}(o),r=n(18);t.default={props:{draggable:{type:Boolean,default:!0},transferData:{},dropEffect:{validator:function(e){return e in r.dropEffects}},effectAllowed:{validator:function(e){return e in r.effectsAllowed}},image:String,imageXOffset:{type:Number,default:0},imageYOffset:{type:Number,default:0},hideImageHtml:{type:Boolean,default:!0},tag:{type:String,default:"div"}},data:function(){return{dragging:!1}},computed:{events:function(){return r.events},scopedData:function(){return this.dragging&&this.transferData},hideImageStyle:function(){return{position:"fixed",top:"-1000px"}}},methods:{emitEvent:function(e,t){var n=t.dataTransfer;if([r.events.dragenter,r.events.dragover].includes(e)&&this.dropEffect&&(n.dropEffect=this.dropEffect),e===r.events.dragstart){if(this.effectAllowed&&(n.effectAllowed=this.effectAllowed),this.image||this.$slots.image){var o=void 0;this.image?(o=new Image,o.src=this.image):this.$slots.image&&(o=this.$slots.image[0].elm),n.setDragImage&&n.setDragImage(o,this.imageXOffset,this.imageYOffset)}void 0!==this.transferData&&(i.default.data=this.transferData,t.dataTransfer.setData("text","")),this.dragging=!0}this.$emit(e,this.transferData,t),e===r.events.dragend&&(i.default.data=void 0,this.dragging=!1)}}}},function(e,t,n){"use strict";var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n(e.tag,{tag:"component",attrs:{draggable:e.draggable},on:{drag:function(t){e.emitEvent(e.events.drag,t)},dragstart:function(t){e.emitEvent(e.events.dragstart,t)},dragenter:function(t){e.emitEvent(e.events.dragenter,t)},dragleave:function(t){e.emitEvent(e.events.dragleave,t)},dragend:function(t){e.emitEvent(e.events.dragend,t)}}},[e._t("default",null,{transferData:e.scopedData}),e._v(" "),e.hideImageHtml?n("div",{style:e.hideImageStyle},[e._t("image",null,{transferData:e.scopedData})],2):e._t("image",null,{transferData:e.scopedData})],2)},i=[],r={render:o,staticRenderFns:i};t.a=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(48),i=n.n(o),r=n(49),s=n(16),a=s(i.a,r.a,null,null,"49fe8924");t.default=a.exports},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(17),i=function(e){return e&&e.__esModule?e:{default:e}}(o),r=n(18),s=new Set;t.default={data:function(){return{transferData:void 0,isDraggingOver:!1}},props:{tag:{type:String,default:"div"}},computed:{events:function(){return r.events},scopedData:function(){return this.isDraggingOver&&this.transferData}},methods:{emitEvent:function(e,t){this.transferData=i.default.data,this.$emit(e,this.transferData,t),e===r.events.dragenter&&(s.size||t.target===this.$el)&&s.add(t.target),e===r.events.dragleave&&s.delete(t.target),e===r.events.drop&&s.clear(),this.isDraggingOver=Boolean(s.size)}}}},function(e,t,n){"use strict";var o=function(){var e=this,t=e.$createElement;return(e._self._c||t)(e.tag,{tag:"component",on:{dragenter:function(t){e.emitEvent(e.events.dragenter,t)},dragleave:function(t){e.emitEvent(e.events.dragleave,t)},dragover:function(t){t.preventDefault(),e.emitEvent(e.events.dragover,t)},drop:function(t){t.preventDefault(),e.emitEvent(e.events.drop,t)}}},[e._t("default",null,{transferData:e.scopedData})],2)},i=[],r={render:o,staticRenderFns:i};t.a=r}])}).call(this,n("yLpj"))},"4ZMo":function(e,t,n){e.exports=n("ETiO")(286)},"6UXw":function(e,t,n){"use strict";var o=n("xEAj"),i=n.n(o);i.a},QimB:function(e,t,n){"use strict";var o=n("tUa6"),i=n.n(o);i.a},YLRJ:function(e,t,n){},"kf/m":function(e,t,n){"use strict";var o=n("YLRJ"),i=n.n(o);i.a},r7mn:function(e,t,n){e.exports=n("ETiO")(287)},rOZ0:function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("q-page",[n("div",{staticClass:"leftMenu"},[n("div",{staticClass:"node-filter q-px-md q-py-sm"},[n("resource-select",{attrs:{"display-value":e.resourceFilterDisplayValue,clearable:"","hide-underline":"","stack-label":"Resource Filter"},model:{value:e.resourceFilter,callback:function(t){e.resourceFilter=t},expression:"resourceFilter"}})],1),n("q-list",{attrs:{separator:"","no-border":""}},[n("flow-recursive-menu-node",{attrs:{root:e.$ethingUI.definitions.nodes,ns:"nodes",filter:e.nodeFilter},on:{click:e.addNodeClick}})],1)],1),n("div",{staticClass:"main",style:e.dbg.enabled?{}:{right:0}},[n("div",{staticClass:"top-left-menu"},[n("span",{staticClass:"text-faded"},[e._v(e._s(e.resource.name()))])]),n("div",{staticClass:"top-right-menu"},[n("q-btn",{attrs:{label:"deploy",flat:"",color:e.dirty?"primary":"faded"},on:{click:e.deploy}}),n("q-btn",{attrs:{label:"debug",flat:"",color:e.dbg.enabled?"primary":"faded"},on:{click:e.toggle_debug}})],1),n("drop",{on:{drop:e.handleDrop}},[n("div",{ref:"flowchart",staticClass:"flowchart jtk-surface jtk-surface-nopan"},e._l(e.nodes,function(t){return n("div",{key:t.id,ref:"node",refInFor:!0,staticClass:"node",style:e.computeNodeStyle(t),attrs:{"data-id":t.id},on:{mouseover:function(n){e.nodeHoverHandler(t,!0)},mouseout:function(n){e.nodeHoverHandler(t,!1)}}},[t._cls.icon?n("q-icon",{staticClass:"icon",attrs:{name:t._cls.icon}}):e._e(),n("div",{staticClass:"content"},[n("flow-node",{staticClass:"full-width",attrs:{flow:e.resource,node:t}})],1),n("div",{staticClass:"node-btns"},[n("q-btn",{staticClass:"node-btn",attrs:{flat:"",dense:"",icon:"edit",size:"sm",color:"faded"},on:{click:function(n){e.editNode(t)}}}),n("q-btn",{staticClass:"node-btn",attrs:{flat:"",dense:"",icon:"delete",size:"sm",color:"faded"},on:{click:function(n){e.removeNode(t)}}})],1),t._dbg.show?n("div",{staticClass:"node-dbg text-no-wrap q-caption"},[n("div",[e._v("\n                id: "+e._s(t.id)+"\n              ")]),e._l(t._dbg.data,function(t,o){return n("div",{key:o},[e._v("\n                "+e._s(o)+": "+e._s(t)+"\n              ")])})],2):e._e()],1)}))])],1),e.dbg.enabled?n("div",{staticClass:"rightMenu"},[n("div",{staticClass:"text-right q-pa-sm"},[e.dbg.items.length>0?n("q-btn",{attrs:{icon:"delete",flat:"",color:"faded"},on:{click:function(t){e.dbg.items=[]}}}):e._e()],1),e.dbg.items.length>0?n("div",e._l(e.dbg.items,function(t,o){return n("div",{key:o,staticClass:"dbg-item q-pa-sm",on:{mouseover:function(n){e.setDbgActiveNode(t.node,!0)},mouseout:function(n){e.setDbgActiveNode(t.node,!1)}}},[n("div",{staticClass:"dbg-item-header q-caption"},[n("span",{staticClass:"dbg-item-header-date text-faded"},[e._v("\n            "+e._s(e.$ethingUI.utils.dateToString(1e3*t.ts))+"\n          ")]),t.node?n("span",{staticClass:"dbg-item-header-node text-purple"},[e._v("\n            ["+e._s(e.nodeIdToName(t.node))+"]\n          ")]):e._e()]),n("div",{staticClass:"dbg-item-data"},[t.exception?n("div",{staticClass:"text-negative"},[e._v("\n            "+e._s(t.data.type)+": "+e._s(t.data.message)+"\n            "),n("pre",{staticClass:"dbg-item-data-exc-traceback"},[e._v(e._s(t.data.traceback))])]):n("div",[e._v("\n            "+e._s(t.data)+"\n          ")])])])})):n("div",{staticClass:"text-faded text-center q-caption"},[e._v("\n      debug console\n    ")])]):e._e(),n("modal",{attrs:{title:(e.edit.node?"Edit":"Add")+" "+e.edit.type,icon:"add","valid-btn-disable":e.edit.error,"valid-btn-label":"Add"},on:{valid:e.onEditDone},model:{value:e.edit.show,callback:function(t){e.$set(e.edit,"show",t)},expression:"edit.show"}},[n("form-schema",{key:e.edit.key,attrs:{schema:e.edit.schema},on:{error:function(t){e.edit.error=t}},model:{value:e.edit.model,callback:function(t){e.$set(e.edit,"model",t)},expression:"edit.model"}})],1)],1)},i=[];o._withStripped=!0;n("KKXr");var r=n("cDf5"),s=n.n(r),a=(n("f3/d"),n("rGqo"),n("91GP"),n("pIFo"),n("4ZMo")),c=(n("r7mn"),n("33YK")),d=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e._l(e.tree.children,function(t,o){return e.notEmpty(t)?n("q-collapsible",{key:o},[n("template",{slot:"header"},[n("q-item-main",{attrs:{label:e.formatLabel(o)}}),n("q-item-side",{attrs:{right:""}},[n("q-chip",{attrs:{color:"light",small:"",dense:"",square:""}},[e._v("\n          "+e._s(e.getLength(t))+"\n        ")])],1)],1),n("flow-recursive-menu-node",{attrs:{root:t,ns:e.join(e.ns,o),filter:e.filter},on:{click:function(t){e.$emit("click",t)}}})],2):e._e()}),e._l(e.tree.nodes,function(t,o){return n("drag",{key:o,attrs:{"transfer-data":{name:o,node:t,type:e.join(e.ns,o)}}},[n("q-item",{staticClass:"q-px-md",staticStyle:{cursor:"pointer"},style:{color:t.color},nativeOn:{click:function(n){e.click(t,o)}}},[n("q-item-side",{style:{color:t.color},attrs:{icon:t.icon||"mdi-puzzle"}}),n("q-item-main",[n("q-item-tile",{staticClass:"ellipsis",attrs:{label:""}},[e._v(e._s(e.formatLabel(t.label)))])],1)],1)],1)})],2)},u=[];d._withStripped=!0;n("yt8O"),n("RW0V");var l={name:"FlowRecursiveMenuNode",components:{Drag:c["Drag"]},props:["root","ns","filter"],computed:{tree:function(){return this.parse(this.root)}},methods:{parse:function(e){var t={},n={};for(var o in e){var i=e[o];"class"!==i.type||i.virtual?"undefined"===typeof i.type&&(n[o]=i):this.filter&&!this.filter(i)||(t[o]=i)}return{nodes:t,children:n}},getLength:function(e){var t=this,n=this.parse(e),o=Object.keys(n.nodes).length;return Object.keys(n.children).forEach(function(e){o+=t.getLength(n.children[e])}),o},notEmpty:function(e){var t=this,n=this.parse(e);return!!Object.keys(n.nodes).length||(Object.keys(n.children).forEach(function(e){if(t.notEmpty(n.children[e]))return!0}),!1)},click:function(e,t){this.$emit("click",this.join(this.ns,t))},join:function(e,t){var n=t;return e&&(n=e+"/"+n),n},formatLabel:function(e){return/^[a-zA-Z]+$/.test(e)&&(e=e.replace(/([a-z])([A-Z])/g,"$1 $2")),e}}},f=l,p=(n("6UXw"),n("KHd+")),h=Object(p["a"])(f,d,u,!1,null,"e2d52dba",null);h.options.__file="FlowRecursiveMenuNode.vue";var v=h.exports,g=n("8VBH"),m=n("ZfkO"),_=n("EJPv"),b=n("QmqO"),y=n.n(b),x=n("NjsW"),w=n("UIO0"),k=_["a"].io(y.a.config.serverUrl+"/flow",{autoConnect:!1});k.on("connect",function(){console.log("[socketio:Flow] connected")}),k.on("disconnect",function(){console.log("[socketio:Flow] disconnected")});var O=1e4;function E(e){e._socket_ref_counter=e._socket_ref_counter||0,e._socket_ref_counter+=1,1===e._socket_ref_counter&&("undefined"!==typeof e._socket_close_timer&&null!==e._socket_close_timer?(clearTimeout(e._socket_close_timer),e._socket_close_timer=null):e.open())}function C(e){e._socket_ref_counter=e._socket_ref_counter||0,e._socket_ref_counter>0&&(e._socket_ref_counter-=1,0===e._socket_ref_counter&&(e._socket_close_timer=setTimeout(function(){e._socket_close_timer=null,e.close()},O)))}var j={strokeWidth:2,stroke:"#61B7CF",joinstyle:"round",outlineStroke:"white",outlineWidth:2},D={strokeWidth:3,stroke:"#216477",outlineWidth:5,outlineStroke:"white"},N={fill:"#216477",stroke:"#216477"},F={endpoint:"Dot",paintStyle:{stroke:"#7AB02C",fill:"transparent",radius:7,strokeWidth:1},maxConnections:-1,isSource:!0,connector:["Flowchart",{stub:[40,60],gap:55,cornerRadius:5,alwaysRespectStubs:!0}],connectorStyle:j,hoverPaintStyle:N,connectorHoverStyle:D,dragOptions:{}},S={endpoint:"Dot",paintStyle:{fill:"#7AB02C",radius:7},hoverPaintStyle:N,maxConnections:-1,dropOptions:{hoverClass:"hover",activeClass:"active"},isTarget:!0},$=function(e){},A={name:"PageFlow",components:{Drag:c["Drag"],Drop:c["Drop"],FlowRecursiveMenuNode:v,FlowNode:g["a"],ResourceSelect:x["a"]},data:function(){return{instance:null,nodes:[],edit:{type:null,show:!1,model:void 0,error:!1,node:null,schema:{},key:0,extra:null},meta:{},dirty:!1,dbg:{enabled:!1,items:[],opened:!1},resourceFilter:null}},computed:{resource:function(){var e=this.$route.params.id,t=this.$store.getters["ething/get"](e);return e&&e.length&&(t||this.$router.replace("/404")),t},resourceFilterDisplayValue:function(){return null===this.resourceFilter?"none":this.resourceFilter.basename()}},methods:{computeNodeStyle:function(e){var t={"border-color":e.color,width:e._meta.width+"px",height:e._meta.height+"px"};return t},nodeFilter:function(e){return!this.resourceFilter||!!this.$ethingUI.isSubclass(e,"nodes/ResourceNode")&&w["a"].methods.filter.call(this,this.resourceFilter,e.properties.resource)},nodeHoverHandler:function(e,t){e._dbg=Object.assign(e._dbg,{show:t&&this.dbg.enabled})},handleDrop:function(e,t){this.addNodeClick(e.type,{x:t.offsetX,y:t.offsetY})},deploy:function(){var e=this,t=this.exportFlow();t&&this.resource.set({flow:t}).then(function(){e.dirty=!1,e.resource.deploy()}).catch(function(e){console.error(e)})},toggle_debug:function(){this.dbg.enabled=!this.dbg.enabled,this.dbg.enabled?this.start_debug():this.stop_debug()},start_debug:function(){this.dbg.opened||(this.dbg.opened=!0,E(k),k.on("dbg_data",this.debug_data_handler),k.on("dbg_info",this.debug_info_handler),k.emit("dbg_open",{flow_id:this.resource.id()}))},stop_debug:function(){this.dbg.opened&&(this.dbg.opened=!1,this.resource&&k.emit("dbg_close",{flow_id:this.resource.id()}),k.off("dbg_data",this.debug_data_handler),k.off("dbg_info",this.debug_info_handler),C(k))},debug_data_handler:function(e){e.data=JSON.parse(e.data),console.log("[socketio:Flow] data:",e),this.dbg.items.push(e)},debug_info_handler:function(e){e.data=JSON.parse(e.data),console.log("[socketio:Flow] info:",e);var t=this.getNode(e.node);t._dbg=Object.assign(t._dbg,{data:e.data})},addNodesToFlow:function(e,t){var n=this,o=e.length;function i(){o--,o<=0&&t&&t(e)}o?e.forEach(function(e){n.addNodeToFlow(e,i)}):t&&t(e)},addNodeToFlow:function(e,t){var n=this;if(this.instance){if("undefined"===typeof e.id&&(e.id=this.getId()),"undefined"===typeof e.type)throw"no node.type defined";var o=e.type,i=this.getNodeCls(o);if(!i)return console.warn("unknown node type "+o),void(t&&t(null));"undefined"===typeof e.name&&(e.name=i.label),"undefined"===typeof e.color&&(e.color=this.$ethingUI.utils.colorNameToHex(i.color)),"undefined"===typeof e.x&&(e.x=0),"undefined"===typeof e.y&&(e.y=0),e._cls=i;var r=i.node||"Base";"string"===typeof r&&(r=m["a"][r]),r=Vue.extend(r);var s=r.options.metadata;e._meta="function"===typeof s?s.call(this):s,this.$set(e,"_dbg",{show:!1,data:{}}),this.nodes.push(e),this.$nextTick(function(){var o=n.getNodeElement(e.id);e._el=o,o.style.left=e.x+"px",o.style.top=e.y+"px",n.instance.batch(function(){i.inputs&&i.inputs.forEach(function(t,i){n.instance.addEndpoint(o,S,{anchor:"ContinuousLeft",uuid:e.id+".inputs."+t,overlays:[["Label",{location:[-2.2,.5],label:t,cssClass:"endpointInputLabel",visible:!0}]]})}),i.outputs&&i.outputs.forEach(function(t,i){n.instance.addEndpoint(o,F,{anchor:"ContinuousRight",uuid:e.id+".outputs."+t,overlays:[["Label",{location:[3,.5],label:t,cssClass:"endpointOutputLabel",visible:!0}]]})}),n.instance.draggable(o,{grid:[20,20],stop:function(e,t){n.dirty=!0}}),t&&t(e)})})}},removeNodeToFlow:function(e){var t=this;"string"!==typeof e&&(e=e.id);var n=this.getNodeElement(e),o=this.instance.getEndpoints(n);for(var i in o.forEach(function(e){t.instance.deleteEndpoint(e)}),this.nodes)if(this.nodes[i].id===e){this.nodes.splice(i,1);break}},nodeIdToName:function(e){var t=this.getNode(e);return t&&t.name?t.name:e},removeNode:function(e){this.removeNodeToFlow(e),this.dirty=!0},setDbgActiveNode:function(e,t){"object"===s()(e)&&(e=e.id);var n=this.getNodeElement(e);n&&n.classList.toggle("active",t)},getId:function(){return String(Math.floor(1e7*Math.random())+1)},getNodeElement:function(e){if(this.$refs.node)for(var t in this.$refs.node){var n=this.$refs.node[t];if(n.getAttribute("data-id")==e)return n}},getNodeCls:function(e){return this.$ethingUI.get(e)},getNode:function(e){for(var t in this.nodes)if(this.nodes[t].id===e)return this.nodes[t]},addNodeClick:function(e,t){var n=this.getNodeCls(e);this._initEditObj(e),this.edit.extra=t,this.resourceFilter&&this.$ethingUI.isSubclass(n,"nodes/ResourceNode")&&Object.assign(this.edit.model,{resource:this.resourceFilter.id()})},editNode:function(e){var t=e.type;this._initEditObj(t),this.edit.node=e,this.edit.model=Object.assign(this.edit.model,this.cleanNode(e))},_initEditObj:function(e){var t=this.getNodeCls(e);this.edit.node=null,this.edit.type=e;var n=Object.assign({},t.properties);delete n.x,delete n.y;var o=(t.required||[]).filter(function(e){return-1===["x","y"].indexOf(e)});this.edit.schema={type:"object",properties:n,required:o,description:t.description},this.edit.model={name:t.label,color:this.$ethingUI.utils.colorNameToHex(t.color)},this.edit.error=!1,this.edit.key++,this.edit.show=!0,this.edit.extra=null},onEditDone:function(){this.edit.show=!1;var e=Object.assign({},this.edit.model,this.edit.extra||{});this.edit.node?Object.assign(this.edit.node,e):this.addNodeToFlow(Object.assign({type:this.edit.type},e)),this.dirty=!0},cleanNode:function(e){var t=Object.assign({},e);return delete t._dbg,delete t._cls,delete t._el,delete t._meta,t.x=parseInt(e._el.style.left),t.y=parseInt(e._el.style.top),t},exportFlow:function(){if(this.instance){var e=this.nodes.map(this.cleanNode),t=this.instance.getConnections().map(function(e){var t=e.endpoints,n=t[0].element.getAttribute("data-id"),o=t[1].element.getAttribute("data-id"),i=t[0].getUuid().split(".").pop(),r=t[1].getUuid().split(".").pop();return{src:[n,i],dest:[o,r]}});return{nodes:e,connections:t}}},importFlow:function(e,t){var n=this;this.instance&&this.addNodesToFlow(e.nodes,function(){e.connections.forEach(function(e){var t=e.src,o=e.dest;n.instance.connect({uuids:[t[0]+".outputs."+t[1],o[0]+".inputs."+o[1]],editable:!0})}),t&&t()})},load:function(e){var t=this,n=this.resource.attr("flow");this.importFlow(n,function(){t.dirty=!1,e&&e()})}},mounted:function(){var e=this,t=this.instance=a["jsPlumb"].getInstance({DragOptions:{cursor:"pointer",zIndex:2e3},ConnectionOverlays:[["Arrow",{location:1,visible:!0,width:11,length:11,id:"ARROW",events:{}}],["Label",{location:.1,id:"label",cssClass:"aLabel",events:{}}]],Container:this.$refs.flowchart});t.batch(function(){t.bind("connection",function(t,n){$(t.connection),e.dirty=!0}),t.bind("click",function(n,o){confirm("Delete connection from "+n.sourceId+" to "+n.targetId+"?")&&(t.deleteConnection(n),e.dirty=!0)}),e.load()})},beforeDestroy:function(){this.stop_debug()}},M=A,I=(n("QimB"),n("kf/m"),Object(p["a"])(M,o,i,!1,null,"5c4a2122",null));I.options.__file="Flow.vue";t["default"]=I.exports},tUa6:function(e,t,n){},xEAj:function(e,t,n){}}]);