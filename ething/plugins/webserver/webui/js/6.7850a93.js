(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[6],{"33YK":function(t,e,n){(function(e){t.exports=function(t){function e(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=19)}([function(t,e){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(t,e){var n=t.exports={version:"2.5.3"};"number"==typeof __e&&(__e=n)},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,n){var o=n(23),i=n(28);t.exports=n(4)?function(t,e,n){return o.f(t,e,i(1,n))}:function(t,e,n){return t[e]=n,t}},function(t,e,n){t.exports=!n(6)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,e,n){var o=n(0),i=n(1),r=n(3),s=n(29),a=n(8),c=function(t,e,n){var d,u,l,f,p=t&c.F,h=t&c.G,v=t&c.S,g=t&c.P,m=t&c.B,_=h?o:v?o[e]||(o[e]={}):(o[e]||{}).prototype,b=h?i:i[e]||(i[e]={}),y=b.prototype||(b.prototype={});for(d in h&&(n=e),n)u=!p&&_&&void 0!==_[d],l=(u?_:n)[d],f=m&&u?a(l,o):g&&"function"==typeof l?a(Function.call,l):l,_&&s(_,d,l,t&c.U),b[d]!=l&&r(b,d,f),g&&y[d]!=l&&(y[d]=l)};o.core=i,c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,t.exports=c},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e){var n=0,o=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++n+o).toString(36))}},function(t,e,n){var o=n(31);t.exports=function(t,e,n){if(o(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,o){return t.call(e,n,o)};case 3:return function(n,o,i){return t.call(e,n,o,i)}}return function(){return t.apply(e,arguments)}}},function(t,e,n){var o=n(10);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==o(t)?t.split(""):Object(t)}},function(t,e){var n={}.toString;t.exports=function(t){return n.call(t).slice(8,-1)}},function(t,e){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e,n){var o=n(13),i=Math.min;t.exports=function(t){return t>0?i(o(t),9007199254740991):0}},function(t,e){var n=Math.ceil,o=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?o:n)(t)}},function(t,e,n){var o=n(15)("unscopables"),i=Array.prototype;void 0==i[o]&&n(3)(i,o,{}),t.exports=function(t){i[o][t]=!0}},function(t,e,n){var o=n(35)("wks"),i=n(7),r=n(0).Symbol,s="function"==typeof r;(t.exports=function(t){return o[t]||(o[t]=s&&r[t]||(s?r:i)("Symbol."+t))}).store=o},function(t,e){t.exports=function(t,e,n,o,i){var r,s=t=t||{},a=typeof t.default;"object"!==a&&"function"!==a||(r=t,s=t.default);var c,d="function"==typeof s?s.options:s;if(e&&(d.render=e.render,d.staticRenderFns=e.staticRenderFns),o&&(d._scopeId=o),i?(c=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),n&&n.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(i)},d._ssrRegister=c):n&&(c=n),c){var u=d.functional,l=u?d.render:d.beforeCreate;u?d.render=function(t,e){return c.call(e),l(t,e)}:d.beforeCreate=l?[].concat(l,c):[c]}return{esModule:r,exports:s,options:d}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={data:void 0}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){return t.reduce(function(t,e){return(t[e]=e)&&t},{})};e.events=o(["drag","dragend","dragenter","dragleave","dragstart","dragover","drop"]),e.dropEffects=o(["copy","move","link","none"]),e.effectsAllowed=o(["none","copy","copyLink","copyMove","link","linkMove","move","all","uninitialized"])},function(t,e,n){n(20),t.exports=n(43)},function(t,e,n){"use strict";n(21),n(36)},function(t,e,n){n(22),t.exports=n(1).Array.includes},function(t,e,n){"use strict";var o=n(5),i=n(32)(!0);o(o.P,"Array",{includes:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),n(14)("includes")},function(t,e,n){var o=n(24),i=n(25),r=n(27),s=Object.defineProperty;e.f=n(4)?Object.defineProperty:function(t,e,n){if(o(t),e=r(e,!0),o(n),i)try{return s(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},function(t,e,n){var o=n(2);t.exports=function(t){if(!o(t))throw TypeError(t+" is not an object!");return t}},function(t,e,n){t.exports=!n(4)&&!n(6)(function(){return 7!=Object.defineProperty(n(26)("div"),"a",{get:function(){return 7}}).a})},function(t,e,n){var o=n(2),i=n(0).document,r=o(i)&&o(i.createElement);t.exports=function(t){return r?i.createElement(t):{}}},function(t,e,n){var o=n(2);t.exports=function(t,e){if(!o(t))return t;var n,i;if(e&&"function"==typeof(n=t.toString)&&!o(i=n.call(t)))return i;if("function"==typeof(n=t.valueOf)&&!o(i=n.call(t)))return i;if(!e&&"function"==typeof(n=t.toString)&&!o(i=n.call(t)))return i;throw TypeError("Can't convert object to primitive value")}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e,n){var o=n(0),i=n(3),r=n(30),s=n(7)("src"),a=Function.toString,c=(""+a).split("toString");n(1).inspectSource=function(t){return a.call(t)},(t.exports=function(t,e,n,a){var d="function"==typeof n;d&&(r(n,"name")||i(n,"name",e)),t[e]!==n&&(d&&(r(n,s)||i(n,s,t[e]?""+t[e]:c.join(String(e)))),t===o?t[e]=n:a?t[e]?t[e]=n:i(t,e,n):(delete t[e],i(t,e,n)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[s]||a.call(this)})},function(t,e){var n={}.hasOwnProperty;t.exports=function(t,e){return n.call(t,e)}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e,n){var o=n(33),i=n(12),r=n(34);t.exports=function(t){return function(e,n,s){var a,c=o(e),d=i(c.length),u=r(s,d);if(t&&n!=n){for(;d>u;)if((a=c[u++])!=a)return!0}else for(;d>u;u++)if((t||u in c)&&c[u]===n)return t||u||0;return!t&&-1}}},function(t,e,n){var o=n(9),i=n(11);t.exports=function(t){return o(i(t))}},function(t,e,n){var o=n(13),i=Math.max,r=Math.min;t.exports=function(t,e){return t=o(t),t<0?i(t+e,0):r(t,e)}},function(t,e,n){var o=n(0),i=o["__core-js_shared__"]||(o["__core-js_shared__"]={});t.exports=function(t){return i[t]||(i[t]={})}},function(t,e,n){n(37),t.exports=n(1).Array.find},function(t,e,n){"use strict";var o=n(5),i=n(38)(5),r=!0;"find"in[]&&Array(1).find(function(){r=!1}),o(o.P+o.F*r,"Array",{find:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),n(14)("find")},function(t,e,n){var o=n(8),i=n(9),r=n(39),s=n(12),a=n(40);t.exports=function(t,e){var n=1==t,c=2==t,d=3==t,u=4==t,l=6==t,f=5==t||l,p=e||a;return function(e,a,h){for(var v,g,m=r(e),_=i(m),b=o(a,h,3),y=s(_.length),x=0,w=n?p(e,y):c?p(e,0):void 0;y>x;x++)if((f||x in _)&&(v=_[x],g=b(v,x,m),t))if(n)w[x]=g;else if(g)switch(t){case 3:return!0;case 5:return v;case 6:return x;case 2:w.push(v)}else if(u)return!1;return l?-1:d||u?u:w}}},function(t,e,n){var o=n(11);t.exports=function(t){return Object(o(t))}},function(t,e,n){var o=n(41);t.exports=function(t,e){return new(o(t))(e)}},function(t,e,n){var o=n(2),i=n(42),r=n(15)("species");t.exports=function(t){var e;return i(t)&&(e=t.constructor,"function"!=typeof e||e!==Array&&!i(e.prototype)||(e=void 0),o(e)&&null===(e=e[r])&&(e=void 0)),void 0===e?Array:e}},function(t,e,n){var o=n(10);t.exports=Array.isArray||function(t){return"Array"==o(t)}},function(t,n,o){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t){t.component("drag",a.default),t.component("drop",d.default)}Object.defineProperty(n,"__esModule",{value:!0}),n.Drop=n.Drag=void 0,n.install=r;var s=o(44),a=i(s),c=o(47),d=i(c);n.Drag=a.default,n.Drop=d.default;var u={version:"1.1.4",install:r};n.default=u;var l=null;"undefined"!=typeof window?l=window.Vue:"undefined"!=typeof e&&(l=e.Vue),l&&l.use(u)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(45),i=n.n(o),r=n(46),s=n(16),a=s(i.a,r.a,null,null,"319bdce9");e.default=a.exports},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(17),i=function(t){return t&&t.__esModule?t:{default:t}}(o),r=n(18);e.default={props:{draggable:{type:Boolean,default:!0},transferData:{},dropEffect:{validator:function(t){return t in r.dropEffects}},effectAllowed:{validator:function(t){return t in r.effectsAllowed}},image:String,imageXOffset:{type:Number,default:0},imageYOffset:{type:Number,default:0},hideImageHtml:{type:Boolean,default:!0},tag:{type:String,default:"div"}},data:function(){return{dragging:!1}},computed:{events:function(){return r.events},scopedData:function(){return this.dragging&&this.transferData},hideImageStyle:function(){return{position:"fixed",top:"-1000px"}}},methods:{emitEvent:function(t,e){var n=e.dataTransfer;if([r.events.dragenter,r.events.dragover].includes(t)&&this.dropEffect&&(n.dropEffect=this.dropEffect),t===r.events.dragstart){if(this.effectAllowed&&(n.effectAllowed=this.effectAllowed),this.image||this.$slots.image){var o=void 0;this.image?(o=new Image,o.src=this.image):this.$slots.image&&(o=this.$slots.image[0].elm),n.setDragImage&&n.setDragImage(o,this.imageXOffset,this.imageYOffset)}void 0!==this.transferData&&(i.default.data=this.transferData,e.dataTransfer.setData("text","")),this.dragging=!0}this.$emit(t,this.transferData,e),t===r.events.dragend&&(i.default.data=void 0,this.dragging=!1)}}}},function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n(t.tag,{tag:"component",attrs:{draggable:t.draggable},on:{drag:function(e){t.emitEvent(t.events.drag,e)},dragstart:function(e){t.emitEvent(t.events.dragstart,e)},dragenter:function(e){t.emitEvent(t.events.dragenter,e)},dragleave:function(e){t.emitEvent(t.events.dragleave,e)},dragend:function(e){t.emitEvent(t.events.dragend,e)}}},[t._t("default",null,{transferData:t.scopedData}),t._v(" "),t.hideImageHtml?n("div",{style:t.hideImageStyle},[t._t("image",null,{transferData:t.scopedData})],2):t._t("image",null,{transferData:t.scopedData})],2)},i=[],r={render:o,staticRenderFns:i};e.a=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(48),i=n.n(o),r=n(49),s=n(16),a=s(i.a,r.a,null,null,"49fe8924");e.default=a.exports},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(17),i=function(t){return t&&t.__esModule?t:{default:t}}(o),r=n(18),s=new Set;e.default={data:function(){return{transferData:void 0,isDraggingOver:!1}},props:{tag:{type:String,default:"div"}},computed:{events:function(){return r.events},scopedData:function(){return this.isDraggingOver&&this.transferData}},methods:{emitEvent:function(t,e){this.transferData=i.default.data,this.$emit(t,this.transferData,e),t===r.events.dragenter&&(s.size||e.target===this.$el)&&s.add(e.target),t===r.events.dragleave&&s.delete(e.target),t===r.events.drop&&s.clear(),this.isDraggingOver=Boolean(s.size)}}}},function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement;return(t._self._c||e)(t.tag,{tag:"component",on:{dragenter:function(e){t.emitEvent(t.events.dragenter,e)},dragleave:function(e){t.emitEvent(t.events.dragleave,e)},dragover:function(e){e.preventDefault(),t.emitEvent(t.events.dragover,e)},drop:function(e){e.preventDefault(),t.emitEvent(t.events.drop,e)}}},[t._t("default",null,{transferData:t.scopedData})],2)},i=[],r={render:o,staticRenderFns:i};e.a=r}])}).call(this,n("yLpj"))},"4ZMo":function(t,e,n){t.exports=n("ETiO")(286)},"6UXw":function(t,e,n){"use strict";var o=n("xEAj"),i=n.n(o);i.a},X9VJ:function(t,e,n){"use strict";var o=n("yemq"),i=n.n(o);i.a},YLRJ:function(t,e,n){},"kf/m":function(t,e,n){"use strict";var o=n("YLRJ"),i=n.n(o);i.a},r7mn:function(t,e,n){t.exports=n("ETiO")(287)},rOZ0:function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-page",[n("div",{staticClass:"leftMenu"},[n("div",{staticClass:"node-filter q-px-md q-py-sm"},[n("resource-select",{attrs:{"display-value":t.resourceFilterDisplayValue,clearable:"","hide-underline":"","stack-label":"Resource Filter"},model:{value:t.resourceFilter,callback:function(e){t.resourceFilter=e},expression:"resourceFilter"}})],1),n("q-list",{attrs:{separator:"","no-border":""}},[n("flow-recursive-menu-node",{attrs:{root:t.$ethingUI.definitions.nodes,ns:"nodes",filter:t.nodeFilter},on:{click:t.addNodeClick}})],1)],1),n("div",{staticClass:"main",style:t.dbg.enabled?{}:{right:0}},[n("div",{staticClass:"top-left-menu"},[n("span",{staticClass:"text-faded"},[t._v(t._s(t.resource.name()))])]),n("div",{staticClass:"top-right-menu"},[n("q-btn",{attrs:{label:"deploy",flat:"",color:t.dirty?"primary":"faded"},on:{click:t.deploy}}),n("q-btn",{attrs:{label:"debug",flat:"",color:t.dbg.enabled?"primary":"faded"},on:{click:t.toggle_debug}})],1),n("drop",{on:{drop:t.handleDrop}},[n("div",{ref:"flowchart",staticClass:"flowchart jtk-surface jtk-surface-nopan"},t._l(t.nodes,function(e){return n("div",{key:e.id,ref:"node",refInFor:!0,staticClass:"node",style:{"border-color":e.color},attrs:{"data-id":e.id},on:{mouseover:function(n){t.nodeHoverHandler(e,!0)},mouseout:function(n){t.nodeHoverHandler(e,!1)}}},[e._cls.icon?n("q-icon",{staticClass:"icon",attrs:{name:e._cls.icon}}):t._e(),n("div",{staticClass:"content"},[n("strong",{staticClass:"ellipsis"},[t._v(t._s(t.nodeTitle(e)))])]),n("div",{staticClass:"node-btns"},[n("q-btn",{staticClass:"node-btn",attrs:{flat:"",dense:"",icon:"edit",size:"sm",color:"faded"},on:{click:function(n){t.editNode(e)}}}),n("q-btn",{staticClass:"node-btn",attrs:{flat:"",dense:"",icon:"delete",size:"sm",color:"faded"},on:{click:function(n){t.removeNode(e)}}})],1),e._dbg.show?n("div",{staticClass:"node-dbg text-no-wrap q-caption"},[n("div",[t._v("\n                id: "+t._s(e.id)+"\n              ")]),t._l(e._dbg.data,function(e,o){return n("div",{key:o},[t._v("\n                "+t._s(o)+": "+t._s(e)+"\n              ")])})],2):t._e()],1)}))])],1),t.dbg.enabled?n("div",{staticClass:"rightMenu"},[n("div",{staticClass:"text-right q-pa-sm"},[t.dbg.items.length>0?n("q-btn",{attrs:{icon:"delete",flat:"",color:"faded"},on:{click:function(e){t.dbg.items=[]}}}):t._e()],1),t.dbg.items.length>0?n("div",t._l(t.dbg.items,function(e,o){return n("div",{key:o,staticClass:"dbg-item q-pa-sm",on:{mouseover:function(n){t.setDbgActiveNode(e.node,!0)},mouseout:function(n){t.setDbgActiveNode(e.node,!1)}}},[n("div",{staticClass:"dbg-item-header q-caption"},[n("span",{staticClass:"dbg-item-header-date text-faded"},[t._v("\n            "+t._s(t.$ethingUI.utils.dateToString(1e3*e.ts))+"\n          ")]),e.node?n("span",{staticClass:"dbg-item-header-node text-purple"},[t._v("\n            ["+t._s(t.nodeIdToName(e.node))+"]\n          ")]):t._e()]),n("div",{staticClass:"dbg-item-data"},[e.exception?n("div",{staticClass:"text-negative"},[t._v("\n            "+t._s(e.data.type)+": "+t._s(e.data.message)+"\n            "),n("pre",{staticClass:"dbg-item-data-exc-traceback"},[t._v(t._s(e.data.traceback))])]):n("div",[t._v("\n            "+t._s(e.data)+"\n          ")])])])})):n("div",{staticClass:"text-faded text-center q-caption"},[t._v("\n      debug console\n    ")])]):t._e(),n("modal",{attrs:{title:(t.edit.node?"Edit":"Add")+" "+t.edit.type,icon:"add","valid-btn-disable":t.edit.error,"valid-btn-label":"Add"},on:{valid:t.onEditDone},model:{value:t.edit.show,callback:function(e){t.$set(t.edit,"show",e)},expression:"edit.show"}},[n("form-schema",{key:t.edit.key,attrs:{schema:t.edit.schema},on:{error:function(e){t.edit.error=e}},model:{value:t.edit.model,callback:function(e){t.$set(t.edit,"model",e)},expression:"edit.model"}})],1)],1)},i=[];o._withStripped=!0;n("KKXr");var r=n("cDf5"),s=n.n(r),a=(n("f3/d"),n("rGqo"),n("91GP"),n("pIFo"),n("4ZMo")),c=(n("r7mn"),n("33YK")),d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t._l(t.tree.children,function(e,o){return t.notEmpty(e)?n("q-collapsible",{key:o},[n("template",{slot:"header"},[n("q-item-main",{attrs:{label:t.formatLabel(o)}}),n("q-item-side",{attrs:{right:""}},[n("q-chip",{attrs:{color:"light",small:"",dense:"",square:""}},[t._v("\n          "+t._s(t.getLength(e))+"\n        ")])],1)],1),n("flow-recursive-menu-node",{attrs:{root:e,ns:t.join(t.ns,o),filter:t.filter},on:{click:function(e){t.$emit("click",e)}}})],2):t._e()}),t._l(t.tree.nodes,function(e,o){return n("drag",{key:o,attrs:{"transfer-data":{name:o,node:e,type:t.join(t.ns,o)}}},[n("q-item",{staticClass:"q-px-md",staticStyle:{cursor:"pointer"},style:{color:e.color},nativeOn:{click:function(n){t.click(e,o)}}},[n("q-item-side",{style:{color:e.color},attrs:{icon:e.icon||"mdi-puzzle"}}),n("q-item-main",[n("q-item-tile",{staticClass:"ellipsis",attrs:{label:""}},[t._v(t._s(t.formatLabel(e.label)))])],1)],1)],1)})],2)},u=[];d._withStripped=!0;n("yt8O"),n("RW0V");var l={name:"FlowRecursiveMenuNode",components:{Drag:c["Drag"]},props:["root","ns","filter"],computed:{tree:function(){return this.parse(this.root)}},methods:{parse:function(t){var e={},n={};for(var o in t){var i=t[o];"class"!==i.type||i.virtual?"undefined"===typeof i.type&&(n[o]=i):this.filter&&!this.filter(i)||(e[o]=i)}return{nodes:e,children:n}},getLength:function(t){var e=this,n=this.parse(t),o=Object.keys(n.nodes).length;return Object.keys(n.children).forEach(function(t){o+=e.getLength(n.children[t])}),o},notEmpty:function(t){var e=this,n=this.parse(t);return!!Object.keys(n.nodes).length||(Object.keys(n.children).forEach(function(t){if(e.notEmpty(n.children[t]))return!0}),!1)},click:function(t,e){this.$emit("click",this.join(this.ns,e))},join:function(t,e){var n=e;return t&&(n=t+"/"+n),n},formatLabel:function(t){return/^[a-zA-Z]+$/.test(t)&&(t=t.replace(/([a-z])([A-Z])/g,"$1 $2")),t}}},f=l,p=(n("6UXw"),n("KHd+")),h=Object(p["a"])(f,d,u,!1,null,"e2d52dba",null);h.options.__file="FlowRecursiveMenuNode.vue";var v=h.exports,g=n("EJPv"),m=n("QmqO"),_=n.n(m),b=n("NjsW"),y=g["a"].io(_.a.config.serverUrl+"/flow",{autoConnect:!1});y.on("connect",function(){console.log("[socketio:Flow] connected")}),y.on("disconnect",function(){console.log("[socketio:Flow] disconnected")});var x=1e4;function w(t){t._socket_ref_counter=t._socket_ref_counter||0,t._socket_ref_counter+=1,1===t._socket_ref_counter&&("undefined"!==typeof t._socket_close_timer&&null!==t._socket_close_timer?(clearTimeout(t._socket_close_timer),t._socket_close_timer=null):t.open())}function k(t){t._socket_ref_counter=t._socket_ref_counter||0,t._socket_ref_counter>0&&(t._socket_ref_counter-=1,0===t._socket_ref_counter&&(t._socket_close_timer=setTimeout(function(){t._socket_close_timer=null,t.close()},x)))}var E={strokeWidth:2,stroke:"#61B7CF",joinstyle:"round",outlineStroke:"white",outlineWidth:2},O={strokeWidth:3,stroke:"#216477",outlineWidth:5,outlineStroke:"white"},C={fill:"#216477",stroke:"#216477"},j={endpoint:"Dot",paintStyle:{stroke:"#7AB02C",fill:"transparent",radius:7,strokeWidth:1},maxConnections:-1,isSource:!0,connector:["Flowchart",{stub:[40,60],gap:55,cornerRadius:5,alwaysRespectStubs:!0}],connectorStyle:E,hoverPaintStyle:C,connectorHoverStyle:O,dragOptions:{}},D={endpoint:"Dot",paintStyle:{fill:"#7AB02C",radius:7},hoverPaintStyle:C,maxConnections:-1,dropOptions:{hoverClass:"hover",activeClass:"active"},isTarget:!0},F=function(t){},N={name:"PageFlow",components:{Drag:c["Drag"],Drop:c["Drop"],FlowRecursiveMenuNode:v,ResourceSelect:b["a"]},data:function(){return{instance:null,nodes:[],edit:{type:null,show:!1,model:void 0,error:!1,node:null,schema:{},key:0,extra:null},meta:{},dirty:!1,dbg:{enabled:!1,items:[],opened:!1},resourceFilter:null}},watch:{resourceFilter:function(t,e){console.log(t)}},computed:{resource:function(){var t=this.$route.params.id,e=this.$store.getters["ething/get"](t);return t&&t.length&&(e||this.$router.replace("/404")),e},resourceFilterDisplayValue:function(){return null===this.resourceFilter?"none":this.resourceFilter.basename()}},methods:{nodeFilter:function(t){if(this.resourceFilter){if(this.$ethingUI.isSubclass(t,"nodes/ResourceNode")){var e=t.properties.resource.must_throw;if(!e)return!0;var n=this.$ethingUI.get(this.resourceFilter).signals;for(var o in n)if(this.$ethingUI.isSubclass(n[o],e))return!0}return!1}return!0},nodeHoverHandler:function(t,e){t._dbg=Object.assign(t._dbg,{show:e&&this.dbg.enabled})},handleDrop:function(t,e){this.addNodeClick(t.type,{x:e.offsetX-80,y:e.offsetY-30})},deploy:function(){var t=this,e=this.exportFlow();e&&this.resource.set({flow:e}).then(function(){t.dirty=!1,t.resource.deploy()}).catch(function(t){console.error(t)})},toggle_debug:function(){this.dbg.enabled=!this.dbg.enabled,this.dbg.enabled?this.start_debug():this.stop_debug()},start_debug:function(){this.dbg.opened||(this.dbg.opened=!0,w(y),y.on("dbg_data",this.debug_data_handler),y.on("dbg_info",this.debug_info_handler),y.emit("dbg_open",{flow_id:this.resource.id()}))},stop_debug:function(){this.dbg.opened&&(this.dbg.opened=!1,this.resource&&y.emit("dbg_close",{flow_id:this.resource.id()}),y.off("dbg_data",this.debug_data_handler),y.off("dbg_info",this.debug_info_handler),k(y))},debug_data_handler:function(t){t.data=JSON.parse(t.data),console.log("[socketio:Flow] data:",t),this.dbg.items.push(t)},debug_info_handler:function(t){t.data=JSON.parse(t.data),console.log("[socketio:Flow] info:",t);var e=this.getNode(t.node);e._dbg=Object.assign(e._dbg,{data:t.data})},addNodesToFlow:function(t,e){var n=this,o=t.length;function i(){o--,o<=0&&e&&e(t)}o?t.forEach(function(t){n.addNodeToFlow(t,i)}):e&&e(t)},addNodeToFlow:function(t,e){var n=this;if(this.instance){if("undefined"===typeof t.id&&(t.id=this.getId()),"undefined"===typeof t.type)throw"no node.type defined";var o=t.type,i=this.getNodeCls(o);if(!i)return console.warn("unknown node type "+o),void(e&&e(null));"undefined"===typeof t.name&&(t.name=i.label),"undefined"===typeof t.color&&(t.color=this.$ethingUI.utils.colorNameToHex(i.color)),"undefined"===typeof t.x&&(t.x=0),"undefined"===typeof t.y&&(t.y=0),t._cls=i,this.$set(t,"_dbg",{show:!1,data:{}}),this.nodes.push(t),this.$nextTick(function(){var o=n.getNodeElement(t.id);t._el=o,o.style.left=t.x+"px",o.style.top=t.y+"px",n.instance.batch(function(){i.inputs&&i.inputs.forEach(function(e,i){n.instance.addEndpoint(o,D,{anchor:"ContinuousLeft",uuid:t.id+".inputs."+e,overlays:[["Label",{location:[-2.2,.5],label:e,cssClass:"endpointInputLabel",visible:!0}]]})}),i.outputs&&i.outputs.forEach(function(e,i){n.instance.addEndpoint(o,j,{anchor:"ContinuousRight",uuid:t.id+".outputs."+e,overlays:[["Label",{location:[3,.5],label:e,cssClass:"endpointOutputLabel",visible:!0}]]})}),n.instance.draggable(o,{grid:[20,20],stop:function(t,e){n.dirty=!0}}),e&&e(t)})})}},removeNodeToFlow:function(t){var e=this;"string"!==typeof t&&(t=t.id);var n=this.getNodeElement(t),o=this.instance.getEndpoints(n);for(var i in o.forEach(function(t){e.instance.deleteEndpoint(t)}),this.nodes)if(this.nodes[i].id===t){this.nodes.splice(i,1);break}},nodeIdToName:function(t){var e=this.getNode(t);return e&&e.name?e.name:t},removeNode:function(t){this.removeNodeToFlow(t),this.dirty=!0},setDbgActiveNode:function(t,e){"object"===s()(t)&&(t=t.id);var n=this.getNodeElement(t);n&&n.classList.toggle("active",e)},getId:function(){return String(Math.floor(1e7*Math.random())+1)},getNodeElement:function(t){if(this.$refs.node)for(var e in this.$refs.node){var n=this.$refs.node[e];if(n.getAttribute("data-id")==t)return n}},getNodeCls:function(t){return this.$ethingUI.get(t)},getNode:function(t){for(var e in this.nodes)if(this.nodes[e].id===t)return this.nodes[e]},addNodeClick:function(t,e){this._initEditObj(t),this.edit.extra=e},editNode:function(t){var e=t.type;this._initEditObj(e),this.edit.node=t,this.edit.model=Object.assign(this.edit.model,this.cleanNode(t))},_initEditObj:function(t){var e=this.getNodeCls(t);this.edit.node=null,this.edit.type=t;var n=Object.assign({},e.properties);delete n.x,delete n.y;var o=(e.required||[]).filter(function(t){return-1===["x","y"].indexOf(t)});this.edit.schema={type:"object",properties:n,required:o,description:e.description},this.edit.model={name:e.label,color:this.$ethingUI.utils.colorNameToHex(e.color)},this.edit.error=!1,this.edit.key++,this.edit.show=!0,this.edit.extra=null},onEditDone:function(){this.edit.show=!1;var t=Object.assign({},this.edit.model,this.edit.extra||{});this.edit.node?Object.assign(this.edit.node,t):this.addNodeToFlow(Object.assign({type:this.edit.type},t)),this.dirty=!0},nodeTitle:function(t){return t.name||t.type},cleanNode:function(t){var e=Object.assign({},t);return delete e._dbg,delete e._cls,delete e._el,e.x=parseInt(t._el.style.left),e.y=parseInt(t._el.style.top),e},exportFlow:function(){if(this.instance){var t=this.nodes.map(this.cleanNode),e=this.instance.getConnections().map(function(t){var e=t.endpoints,n=e[0].element.getAttribute("data-id"),o=e[1].element.getAttribute("data-id"),i=e[0].getUuid().split(".").pop(),r=e[1].getUuid().split(".").pop();return{src:[n,i],dest:[o,r]}});return{nodes:t,connections:e}}},importFlow:function(t,e){var n=this;this.instance&&this.addNodesToFlow(t.nodes,function(){t.connections.forEach(function(t){var e=t.src,o=t.dest;n.instance.connect({uuids:[e[0]+".outputs."+e[1],o[0]+".inputs."+o[1]],editable:!0})}),e&&e()})},load:function(t){var e=this,n=this.resource.attr("flow");this.importFlow(n,function(){e.dirty=!1,t&&t()})}},mounted:function(){var t=this,e=this.instance=a["jsPlumb"].getInstance({DragOptions:{cursor:"pointer",zIndex:2e3},ConnectionOverlays:[["Arrow",{location:1,visible:!0,width:11,length:11,id:"ARROW",events:{}}],["Label",{location:.1,id:"label",cssClass:"aLabel",events:{}}]],Container:this.$refs.flowchart});e.batch(function(){e.bind("connection",function(e,n){F(e.connection),t.dirty=!0}),e.bind("click",function(n,o){confirm("Delete connection from "+n.sourceId+" to "+n.targetId+"?")&&(e.deleteConnection(n),t.dirty=!0)}),t.load()})},beforeDestroy:function(){this.stop_debug()}},S=N,$=(n("X9VJ"),n("kf/m"),Object(p["a"])(S,o,i,!1,null,"7df6af82",null));$.options.__file="Flow.vue";e["default"]=$.exports},xEAj:function(t,e,n){},yemq:function(t,e,n){}}]);