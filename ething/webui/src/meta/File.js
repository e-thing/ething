(function (root, factory) {
    if (typeof define === 'function' && define.amd) {
        // AMD. Register as an anonymous module.
        define(['jquery', 'ething', 'ui/utils', 'form'], factory);
    }
}(this, function ($, EThing, UI) {
	
	return {
		
		'bases': ['Resource'],
		
		'icon': function(resource){
			
			if(resource instanceof EThing.File){
				if(resource.extension()==='plot') {
					return '<g transform="scale(0.04) translate(180,200)" stroke-width="0"><path d="M415,102.509c-22.091,0-40,17.909-40,40c0,5.542,1.128,10.821,3.166,15.62l-83.791,83.792c-4.799-2.038-10.078-3.167-15.621-3.167s-10.822,1.129-15.621,3.167l-50.053-50.053c2.038-4.799,3.166-10.078,3.166-15.621c0-22.091-17.909-40-40-40c-22.091,0-40,17.909-40,40c0,5.542,1.128,10.821,3.166,15.62l-83.792,83.791c-4.799-2.038-10.078-3.167-15.621-3.167c-22.091,0-40,17.909-40,40s17.909,40,40,40s40-17.909,40-40c0-5.542-1.128-10.821-3.166-15.62l83.792-83.791c4.799,2.038,10.078,3.166,15.621,3.166c5.542,0,10.821-1.128,15.62-3.166l50.054,50.054c-2.038,4.799-3.166,10.078-3.166,15.62c0,22.091,17.909,40,40,40c22.091,0,40-17.909,40-40c0-5.542-1.128-10.821-3.166-15.62l83.791-83.792c4.799,2.038,10.078,3.166,15.621,3.166c22.091,0,40-17.909,40-40S437.091,102.509,415,102.509z"/></g>';
				} else if(/^text/.test(resource.mime())) {
					return '<g transform="scale(0.09) translate(30,30)" stroke-width="0"><path d="M63.928,106.078H194.79v15.562H63.928V106.078z M63.928,177.707H194.79v15.562H63.928V177.707z M236.072,229.081H63.928v-15.562h172.144V229.081z M236.072,157.454H63.928v-15.562h172.144V157.454z M236.072,85.827H63.928 V70.265h172.144V85.827z"/></g>';
				} else if(/^image/.test(resource.mime())) {
					return '<g transform="scale(0.035) translate(190,190)" stroke-width="0"><path d="M534.75,68.238c-8.945-8.945-19.694-13.417-32.261-13.417H45.681c-12.562,0-23.313,4.471-32.264,13.417C4.471,77.185,0,87.936,0,100.499v347.173c0,12.566,4.471,23.318,13.417,32.264c8.951,8.946,19.702,13.419,32.264,13.419h456.815c12.56,0,23.312-4.473,32.258-13.419c8.945-8.945,13.422-19.697,13.422-32.264V100.499C548.176,87.936,543.699,77.185,534.75,68.238z M511.623,447.672c0,2.478-0.899,4.613-2.707,6.427c-1.81,1.8-3.952,2.703-6.427,2.703H45.681c-2.473,0-4.615-0.903-6.423-2.703c-1.807-1.813-2.712-3.949-2.712-6.427V100.495c0-2.474,0.902-4.611,2.712-6.423c1.809-1.803,3.951-2.708,6.423-2.708h456.815c2.471,0,4.613,0.905,6.42,2.708c1.801,1.812,2.707,3.949,2.707,6.423V447.672L511.623,447.672z"/><path d="M127.91,237.541c15.229,0,28.171-5.327,38.831-15.987c10.657-10.66,15.987-23.601,15.987-38.826c0-15.23-5.333-28.171-15.987-38.832c-10.66-10.656-23.603-15.986-38.831-15.986c-15.227,0-28.168,5.33-38.828,15.986c-10.656,10.66-15.986,23.601-15.986,38.832c0,15.225,5.327,28.169,15.986,38.826C99.742,232.211,112.683,237.541,127.91,237.541z"/><polygon points="210.134,319.765 164.452,274.088 73.092,365.447 73.092,420.267 475.085,420.267 475.085,292.36 356.315,173.587 "/></g>';
				} else if(/^video/.test(resource.mime())) {
					return '<g transform="scale(0.035) translate(220,200)" stroke-width="0"><path d="M357.714,423.331c0,9.328-10.676,16.891-23.847,16.891H23.847C10.676,440.222,0,432.659,0,423.331V203.735c0-9.33,10.676-16.892,23.847-16.892h310.02c13.171,0,23.847,7.564,23.847,16.892V423.331L357.714,423.331z"/><circle cx="89.428" cy="118.706" r="59.619"/><circle cx="253.381" cy="103.801" r="74.524"/><path d="M491.858,447.677c0,0-1.986,14.904-15.899,14.904c-13.912,0-103.34-83.42-103.34-94.397V258.882c0-10.976,87.443-94.398,103.34-94.398c15.899,0,15.899,14.905,15.899,14.905V447.677z"/></g>';
				} else if(/^application/.test(resource.mime())) {
					return '<g transform="scale(0.04) translate(140,140)" stroke-width="0"><rect x="14.94" y="243.2" transform="matrix(0.3417 -0.9398 0.9398 0.3417 -74.4662 422.7561)" width="499.196" height="42.666"/><polygon points="121.6,142.933 0,264.533 121.6,386.133 151.467,356.267 59.733,264.533 151.467,172.8 "/><polygon points="407.467,142.933 377.6,172.8 469.333,264.533 377.6,356.267 407.467,386.133 529.067,264.533 "/></g>';
				}
			}
			
			return '<text x="16" y="24" font-size="22" font-weight="bold" font-family="Arial" text-anchor="middle">F</text>';
		},
		
		'properties' : {
			"mime": {
				label: "mime type"
			},
			"length": {
				label: "rows",
				default: 0
			},
			"contentModifiedDate": {
				label: "content last update",
				formatter: UI.dateToString
			},
			"size": {
				formatter: UI.sizeToString,
				default: 0
			},
			"expireAfter": {
				label: "expire after",
				description: "This resource will be automatically removed after a specific duration of inactivity.",
				formatter: function(v){
					return v ? UI.dateDiffToString(v) : "never";
				},
				isOptional: true,
				editable: function(){
					return new $.Form.Duration({
						minute: false,
						hour: true,
						day: true,
						value: 86400
					});
				}
			}
		}
	}
}))