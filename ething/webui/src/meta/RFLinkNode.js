(function (root, factory) {
    if (typeof define === 'function' && define.amd) {
        // AMD. Register as an anonymous module.
        define(['jquery', 'ething', 'form', 'ui/resourceselect'], factory);
    }
}(this, function ($, EThing) {
	
	var RFLink_protocols = ["X10","Kaku","AB400D","Waveman","EMW200","Impuls","RisingSun","Philips","Energenie","Energenie5","GDR2","NewKaku","HomeEasy","Anslut","Kambrook","Ikea Koppla","PT2262","Lightwave","EMW100","BSB","MDRemote","Conrad","Livolo","TRC02RGB","Aoke","TRC022RGB","Eurodomest","Livolo App","Blyss","Byron","Byron MP","SelectPlus","Doorbell","FA20RF","Chuango","Plieger","SilverCrest","Mertik","HomeConfort","Powerfix","TriState","Deltronic","FA500","HT12E","EV1527","Elmes","Aster","Sartano","Europe","Avidsen","BofuMotor","BrelMotor","RTS","ElroDB","Dooya","Unitec","Maclean","R546","Diya","X10Secure","Atlantic","SilvercrestDB","MedionDB","VMC","Keeloq","CustomSwitch","GeneralSwitch","Koch","Kingpin","Funkbus","Nice","Forest","MC145026","Lobeco","Friedland","BFT","Novatys","Halemeier","Gaposa","MiLightv1","MiLightv2","HT6P20","Doitrand","Warema","Ansluta","Livcol","Bosch","Ningbo","Ditec","Steffen","AlectoSA","GPIOset","KonigSec","RM174RF","Liwin","YW_Secu","Mertik_GV60","Ningbo64","X2D","HRCMotor","Velleman","RFCustom","YW_Sensor","LEGRANDCAD","SysfsGpio"].sort();
	
	
	return {
		
		'bases': ['RFLinkGateway'],
		
		'icon': function(){
			
			if(this.resource){
				
				var sensor = this.resource, icon = null;
				
				if(this.resource.interfaces()){
					icon = this.meta.get(this.resource.interfaces()).icon();
					if(icon) return icon;
				}
				
				// type dependent
				if(sensor.attr('subType') === 'thermometer' || sensor.attr('subType') === 'weatherStation'){
					icon = '<g transform="scale(0.04) translate(120,120)" stroke-width="0"><path d="M305.949,424.6c0-1.9,0-1.9,0-3.799V229.5c0-11.5-7.6-19.1-19.099-19.1c-11.5,0-19.1,9.6-19.1,19.1v191.199c0,1.9,0,1.9,0,3.801c-23,7.699-38.2,28.699-38.2,53.5c0,32.5,24.9,57.4,57.4,57.4c32.499,0,57.399-24.9,57.399-57.4C344.25,453.301,328.949,432.301,305.949,424.6z"/><path d="M344.25,401.699V57.4c0-32.5-24.9-57.4-57.4-57.4c-32.5,0-57.4,26.8-57.4,57.4v344.2c-23,17.201-38.2,45.9-38.2,76.5c0,53.5,42.1,95.6,95.6,95.6c53.5,0,95.599-42.1,95.599-95.6C382.449,447.5,367.15,418.9,344.25,401.699z M286.85,554.699c-42.1,0-76.5-34.398-76.5-76.5c0-28.699,15.3-53.5,38.2-66.898V57.4c0-21,17.2-38.2,38.2-38.2s38.199,17.2,38.199,38.2v353.799c23,13.4,38.201,38.201,38.201,66.9C363.35,520.199,328.949,554.699,286.85,554.699z"/>';
				} else if(sensor.attr('subType') === 'switch') {
					icon = '<g transform="scale(0.03) translate(220,220)" stroke-width="0"><path d="M178.624,242.367c-38.651,0-58.198,30.622-58.198,63.656c0,32.971,19.563,63.623,58.198,63.623c38.619,0,58.23-30.67,58.23-63.623C236.854,272.99,217.227,242.367,178.624,242.367z M178.624,351.625c-26.989,0-38.333-23.277-38.333-45.584c0-22.356,11.344-45.632,38.333-45.632c26.989,0,38.333,23.276,38.333,45.632C216.958,328.348,205.613,351.625,178.624,351.625z"/><path d="M592.611,136.855H19.436C8.711,136.855,0,145.518,0,156.26v299.511c0,10.758,8.711,19.389,19.436,19.389h573.175c10.726,0,19.404-8.631,19.404-19.389V156.26C612,145.518,603.321,136.855,592.611,136.855z M436.01,251.062h23.244v116.412H436.01V251.062z M38.793,175.665h264.113v260.701H38.793V175.665z"/></g>';
				} else if(sensor.attr('subType') === 'light') {
					icon = '<g transform="scale(0.6) translate(10,10)" ><path d="M21.59,23.694L21.59,23.694l-10.413-0.003c-0.253,0-0.467-0.189-0.497-0.441c-0.121-1.022-0.478-2.465-1.499-3.526c-0.001-0.002-0.002-0.003-0.004-0.005c-2.524-2.132-3.971-5.241-3.971-8.54C5.207,5.015,10.222,0,16.385,0s11.178,5.015,11.178,11.179c0,3.321-1.465,6.449-4.019,8.581c-0.98,1.026-1.337,2.47-1.458,3.493C22.058,23.505,21.844,23.694,21.59,23.694z M11.611,22.691l9.545,0.003c0.187-1.127,0.64-2.552,1.708-3.664c2.366-1.979,3.7-4.828,3.7-7.852C26.563,5.566,21.998,1,16.385,1S6.207,5.566,6.207,11.179c0,3.021,1.333,5.869,3.659,7.812c0.03,0.025,0.057,0.054,0.08,0.085C10.983,20.18,11.426,21.58,11.611,22.691z"/><path d="M21.59,26.718H11.177c-0.276,0-0.5-0.224-0.5-0.5s0.224-0.5,0.5-0.5H21.59c0.276,0,0.5,0.224,0.5,0.5S21.867,26.718,21.59,26.718z"/><path d="M21.59,29.744H11.177c-0.276,0-0.5-0.224-0.5-0.5s0.224-0.5,0.5-0.5H21.59c0.276,0,0.5,0.224,0.5,0.5S21.867,29.744,21.59,29.744z"/><path d="M18.564,32.771h-4.36c-0.276,0-0.5-0.224-0.5-0.5s0.224-0.5,0.5-0.5h4.36c0.276,0,0.5,0.224,0.5,0.5S18.84,32.771,18.564,32.771z"/></g>';
				} else if(sensor.attr('subType') === 'door') {
					icon = '<path transform="scale(0.04) translate(150,150)" stroke-width="0" d="M184.646,0v21.72H99.704v433.358h31.403V53.123h53.539V492.5l208.15-37.422v-61.235V37.5L184.646,0z M222.938,263.129c-6.997,0-12.67-7.381-12.67-16.486c0-9.104,5.673-16.485,12.67-16.485s12.67,7.381,12.67,16.485C235.608,255.748,229.935,263.129,222.938,263.129z"/>';
				} else if(sensor.attr('subType') === 'motion') {
					icon = '<g transform="scale(0.036) translate(200,200)" stroke-width="0"><g><g><path d="M72.758,4.042c-34.176,0-61.979,27.803-61.979,61.979S38.582,128,72.758,128c34.176,0,61.979-27.803,61.979-61.979S106.934,4.042,72.758,4.042z M72.758,111.832c-25.26,0-45.811-20.55-45.811-45.811s20.55-45.811,45.811-45.811c25.26,0,45.81,20.55,45.81,45.811S98.018,111.832,72.758,111.832z"/></g></g><g><g><path d="M299.116,491.789h-21.558c-4.465,0-8.084,3.62-8.084,8.084c0,4.465,3.62,8.084,8.084,8.084h21.558c4.465,0,8.084-3.62,8.084-8.084C307.2,495.409,303.58,491.789,299.116,491.789z"/></g></g><g><g><path d="M363.789,491.789h-21.558c-4.465,0-8.084,3.62-8.084,8.084c0,4.465,3.62,8.084,8.084,8.084h21.558c4.465,0,8.084-3.62,8.084-8.084C371.874,495.409,368.254,491.789,363.789,491.789z"/></g></g><g><g><path d="M439.242,28.295h-21.558c-4.465,0-8.084,3.62-8.084,8.084s3.62,8.084,8.084,8.084h21.558c4.465,0,8.084-3.62,8.084-8.084S443.707,28.295,439.242,28.295z"/></g></g><g><g><path d="M385.347,28.295h-64.674c-4.465,0-8.084,3.62-8.084,8.084s3.62,8.084,8.084,8.084h64.674c4.465,0,8.084-3.62,8.084-8.084S389.812,28.295,385.347,28.295z"/></g></g><g><g><path d="M503.916,28.295h-21.558c-4.465,0-8.084,3.62-8.084,8.084s3.62,8.084,8.084,8.084h21.558c4.465,0,8.084-3.62,8.084-8.084S508.38,28.295,503.916,28.295z"/></g></g><g><g><path d="M492.283,352.321c-10.611-14.147-30.046-17.953-45.21-8.856l-28.136,16.882l-79.972-79.972c2.206-5.592,3.416-11.597,3.516-17.808c0.223-13.83-5.041-26.834-14.822-36.614l-84.479-84.479h69.41v18.863c0,19.316,15.716,35.032,35.032,35.032c19.316,0,35.032-15.716,35.032-35.032v-41.348c0-26.235-21.343-47.578-47.578-47.578H207.369c-26.406,0-51.232,10.283-69.905,28.955l-69.948,69.948c0.013,0.002,0.025,0.006,0.038,0.01c-1.759,1.482-2.88,3.7-2.88,6.182v88.926H35.032C15.716,265.432,0,281.147,0,300.463c0,19.316,15.716,35.032,35.032,35.032h52.127c26.235,0,47.578-21.343,47.578-47.578v-37.999l66.715,66.715l-68.948,68.948c-8.987,8.985-13.936,20.934-13.936,33.642v53.704c0,6.942,2.038,13.413,5.536,18.863h-19.01c-4.465,0-8.084,3.62-8.084,8.084c0,4.465,3.62,8.084,8.084,8.084h129.347c4.465,0,8.084-3.62,8.084-8.084c0-4.465-3.62-8.084-8.084-8.084h-51.347c3.498-5.45,5.536-11.922,5.536-18.863v-45.003l97.601-91.5l94.263,85.695c8.978,8.162,20.439,12.38,32.008,12.38c7.903,0,15.857-1.969,23.103-5.995l45.865-25.48c8.689-4.828,14.861-13.171,16.934-22.892S498.247,360.273,492.283,352.321z M118.568,287.916c0,17.32-14.09,31.41-31.41,31.41H35.032c-10.401,0-18.863-8.463-18.863-18.863c0-10.401,8.463-18.863,18.863-18.863h37.726c4.465,0,8.084-3.62,8.084-8.084v-77.494l37.726,37.726V287.916z M482.593,376.759c-1.098,5.151-4.37,9.573-8.973,12.131l-45.865,25.48c-11.786,6.547-26.407,4.853-36.382-4.216l-93.306-84.824l3.873-3.631c2.957-2.772,3.374-7.317,0.972-10.582c-0.032-0.044-0.065-0.087-0.096-0.132c-2.841-3.864-8.422-4.375-11.92-1.095L175.019,418.523c-1.631,1.528-2.556,3.663-2.556,5.898v48.005c0,10.55-8.633,19.536-19.183,19.36c-10.254-0.17-18.543-8.566-18.543-18.86v-53.704c0-8.33,3.309-16.319,9.2-22.21l74.664-74.664c3.157-3.157,3.157-8.276,0-11.432l-86.23-86.23c-0.001-0.001-0.002-0.002-0.003-0.002L84.19,176.505l64.707-64.707c15.508-15.508,36.541-24.219,58.471-24.219h127.706c17.348,0,31.41,14.062,31.41,31.41v40.848c0,10.55-8.633,19.536-19.183,19.36c-10.254-0.17-18.543-8.566-18.543-18.86v-26.947c0-4.465-3.62-8.084-8.084-8.084h-96.78c-2.645,0-5.216,1.167-6.763,3.313c-2.394,3.321-1.94,7.732,0.816,10.488l97.814,97.814c6.653,6.653,10.62,15.642,10.558,25.05c-0.064,9.542-3.94,18.404-10.89,24.919l-1.258,1.179c-2.961,2.777-3.37,7.325-0.961,10.594c0.032,0.044,0.065,0.087,0.097,0.132c2.84,3.857,8.415,4.36,11.91,1.084l1.272-1.192c1.375-1.289,2.661-2.646,3.87-4.055l81.613,81.613c2.623,2.624,6.695,3.125,9.876,1.216l33.548-20.129c8.036-4.82,18.333-2.804,23.956,4.693C482.509,366.236,483.691,371.606,482.593,376.759z"/></g></g></g>';
				} else if(sensor.attr('subType') === 'multimeter') {
					icon = '<g transform="scale(0.002) translate(13000,8000) rotate(180)" stroke-width="0"><path d="M2125.7,4953.6c-132.4-65.1-253.9-191-319.1-332.1l-45.6-99.8V104.6v-4417.1l45.6-99.8c56.4-123.7,191-260.5,316.9-327.8l93.3-49.9h2778.3h2778.3l115,62.9c130.2,71.6,219.2,165,290.9,301.7l49.9,91.2L8235.8,72c6.5,4953.2,19.6,4516.9-164.9,4723.1c-58.6,65.1-147.6,134.6-210.6,162.8l-108.5,52.1H4993H2236.4L2125.7,4953.6z M7764.8,4619.3c112.9-60.8,106.4,195.3,106.4-4503.9c0-4744.8,6.5-4469.2-121.5-4521.2c-47.8-19.5-722.8-26-2780.5-21.7l-2719.7,6.5l-58.6,60.8l-60.8,58.6l-6.5,4354.1c-2.2,2982.3,2.2,4380.2,17.4,4438.8c43.4,158.4-167.1,147.6,2860.8,149.8C6827.2,4641,7736.6,4634.5,7764.8,4619.3z"></path><path d="M2878.9,2600.7V1298.4h2127.1h2127.2v1302.3V3903H5006.1H2878.9V2600.7z M6764.2,2600.7v-933.3H6074h-690.2l-497.1,622.9c-275.7,342.9-514.4,642.5-534,666.3c-34.7,43.4-36.9,41.2-180.2-71.6c-95.5-78.1-138.9-123.7-125.9-141.1c10.8-13,197.5-247.4,416.7-523.1c219.2-273.5,405.9-512.2,418.9-525.3c15.2-21.7-147.6-28.2-807.4-28.2h-827v933.3V3534h1758.1h1758.1V2600.7z"></path><path d="M3124.2,276c-149.8-43.4-271.3-236.6-236.6-375.5c32.6-128.1,191-251.8,323.4-251.8c154.1,0,336.4,210.5,308.2,356C3486.7,180.5,3280.5,319.5,3124.2,276z M3237.1-23.5c15.2-26-26-52.1-54.3-34.7C3158.9-43,3174.1-4,3204.5-4C3215.4-4,3228.4-12.6,3237.1-23.5z"></path><path d="M4932.3,278.2c-78.1-23.9-197.5-136.7-230.1-219.2c-71.6-171.5,104.2-410.2,303.9-410.2c86.8,0,175.8,47.8,245.3,128.1c69.5,84.6,91.2,178,58.6,271.3c-26,80.3-173.6,230.1-225.7,230.1c-17.4,0-43.4,4.3-60.8,8.7C5008.2,291.2,4967,286.9,4932.3,278.2z M5038.6-23.5c15.2-26-26.1-52.1-54.3-34.7C4960.5-43,4975.7-4,5006.1-4C5016.9-4,5029.9-12.6,5038.6-23.5z"></path><path d="M6709.9,258.7c-104.2-47.8-197.5-149.8-217.1-240.9c-10.9-47.8,0-95.5,36.9-169.3c123.7-251.8,395-264.8,553.5-28.2c62.9,93.3,62.9,178,2.2,288.7C6998.6,260.9,6848.9,321.6,6709.9,258.7z M6840.2-23.5c15.2-26-26.1-52.1-54.3-34.7C6762-43,6777.2-4,6807.6-4C6818.5-4,6831.5-12.6,6840.2-23.5z"></path><path d="M4769.5-1688.3c-384.2-102-701.1-449.3-768.4-842.2c-86.8-512.2,319.1-1054.9,861.7-1148.2C5490.1-3785,6117.4-3157.8,6011-2530.5C5911.2-1946.6,5312.1-1540.7,4769.5-1688.3z M5294.7-2083.3c121.6-54.3,247.5-180.1,303.9-306.1c67.3-147.6,65.1-429.8-6.5-575.2c-65.1-134.6-160.6-230.1-295.2-295.2c-145.4-71.6-427.6-73.8-575.2-6.5c-271.3,123.7-412.4,427.6-347.3,748.8c47.8,225.7,212.7,403.7,431.9,466.7C4938.8-2013.9,5173.2-2029.1,5294.7-2083.3z"></path></g>';
				}
				
				if(icon) return icon;
				
			}
			
			return this.meta.get(this.bases).icon();
		},
		
		'name': 'RFLink Node',
		
		'description' : 'See <a href="//rflink.nl" target="_blank">RFLink website</a>',
		
		'path' : ['RFLink', 'Node'],
		
		'properties' : {
			"gateway": {
				editable: function(){
					return new $.Form.ResourceSelect({
						filter: function(r){
							return r.isTypeof("RFLinkGateway");
						},
						validators: [$.Form.validator.NotEmpty]
					});
				}
			},
			"subType": {
				editable: function(){
					return new $.Form.Select({
						items: [
							'switch',
							'light',
							'door',
							'motion',
							'thermometer',
							'weatherStation',
							'multimeter'
						],
						validators: [$.Form.validator.NotEmpty],
						onattach: function(){
							this.change(function(){
								
								switch(this.value()){
									case 'switch':
									case 'door':
									case 'motion':
										this.parent().setVisible('switchId',true);
										break;
									default:
										this.parent().setVisible('switchId',false);
										break;
								}
								
							}).change();
						}
					});
				}
			},
			"protocol": {
				editable: function(){
					return new $.Form.Select({
						items: RFLink_protocols,
						editable: true,
						validators: [$.Form.validator.NotEmpty]
					});
				}
			},
			"nodeId": {
				editable: function(){
					return new $.Form.Text({
						validators: [$.Form.validator.NotEmpty]
					});
				}
			},
			"switchId": {
				editable: function(){
					return new $.Form.Text({
						validators: [$.Form.validator.NotEmpty]
					});
				}
			}
		},
		'widget': function(){
			var widget = null;
			if(this.resource){
				var sensor = this.resource;
				// type dependent
				if(sensor.attr('subType') === 'thermometer' || sensor.attr('subType') === 'weatherStation'){
					widget = 'GenericWeather';
				} else if(sensor.attr('subType') === 'switch'){
					widget = 'GenericSwitch';
				} else if(sensor.attr('subType') === 'light'){
					widget = 'GenericRGBW';
				} else if(sensor.attr('subType') === 'door' || sensor.attr('subType') === 'motion'){
					widget = {
						type: 'GenericSwitch',
						options: {
							readonly: true
						}
					};
				}
			}
			return widget;
		}
	}
}))