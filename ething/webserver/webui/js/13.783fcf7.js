(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[13],{Bv2Z:function(t,e,n){"use strict";var i=n("xBp9"),a=n.n(i);a.a},HrpU:function(t,e,n){},QVVK:function(t,e,n){},Rlhe:function(t,e,n){"use strict";var i=n("UymS"),a=n.n(i);a.a},UymS:function(t,e,n){},hxHi:function(t,e,n){"use strict";var i=n("QVVK"),a=n.n(i);a.a},tB8M:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-page",[n("q-tabs",{attrs:{"two-lines":"","no-pane-border":"",color:"secondary"}},[n("q-tab",{attrs:{slot:"title",default:"",label:"settings",name:"settings",icon:"settings"},slot:"title"}),n("q-tab",{attrs:{slot:"title",label:"log",name:"log",icon:"message"},slot:"title"}),n("q-tab",{attrs:{slot:"title",label:"api key",name:"apikey",icon:"mdi-key"},slot:"title"}),n("q-tab",{attrs:{slot:"title",label:"data",name:"backup",icon:"mdi-database"},slot:"title"}),n("q-tab",{attrs:{slot:"title",label:"plugins",name:"plugins",icon:"mdi-puzzle"},slot:"title"}),n("q-tab",{attrs:{slot:"title",label:"about",name:"about",icon:"info"},slot:"title"}),n("q-tab-pane",{attrs:{name:"settings"}},[n("settings-view")],1),n("q-tab-pane",{attrs:{name:"log"}},[n("log-view")],1),n("q-tab-pane",{attrs:{name:"apikey"}},[n("apikey-view")],1),n("q-tab-pane",{attrs:{name:"backup"}},[n("backup-view")],1),n("q-tab-pane",{attrs:{name:"plugins"}},[n("plugins-view")],1),n("q-tab-pane",{attrs:{name:"about"}},[n("dl",{staticClass:"horizontal"},[n("dt",[t._v("UI")]),n("dd",[t._v("version: "+t._s(t.$ui.VERSION))]),n("dt",[t._v("Server")]),n("dd",[t._v("version: "+t._s(t.$ethingUI.info.VERSION))]),n("dt",[t._v("JS api")]),n("dd",[t._v("version: "+t._s(t.$ething.VERSION))]),n("dt",[t._v("Python")]),n("dd",[t._v("version: "+t._s(t.$ethingUI.info.python.version)+" type: "+t._s(t.$ethingUI.info.python.type))]),n("dt",[t._v("Platform")]),n("dd",[t._v(t._s(t.$ethingUI.info.platform.name))]),n("dt",[t._v("NodeJS")]),n("dd",[t._v("version: "+t._s(t.$ethingUI.info.nodejs.version))])])])],1)],1)},a=[];i._withStripped=!0;var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return!1===t.loading?n("div",[n("div",{staticClass:"q-mt-xl"},[n("div",{staticClass:"q-title q-title-opacity"},[t._v("General")]),n("form-schema",{staticClass:"q-my-md",attrs:{schema:t.$ethingUI.config},on:{error:function(e){t.error=e}},model:{value:t.settings,callback:function(e){t.settings=e},expression:"settings"}})],1),t._l(t.plugins,function(e,i){return"object"===typeof e.schema?n("div",{key:i,staticClass:"q-mt-xl"},[n("div",{staticClass:"q-title q-title-opacity"},[t._v(t._s(i))]),n("form-schema",{staticClass:"q-my-md",attrs:{schema:e.schema},on:{error:function(t){e.error=t}},model:{value:t.settings[i],callback:function(e){t.$set(t.settings,i,e)},expression:"settings[name]"}})],1):t._e()}),t.saveError?n("q-alert",{staticClass:"q-mt-xl",attrs:{type:"negative"}},[t._v("\n    "+t._s(String(t.saveError))+"\n  ")]):t._e(),n("div",{staticClass:"q-mt-xl"},[n("q-btn",{attrs:{disable:t.globalError,loading:t.saving,color:"secondary",icon:"done",label:"save changes"},on:{click:t.onSave}})],1)],2):n("div",{staticClass:"absolute-center text-faded"},[t._v("loading ...")])},s=[];o._withStripped=!0;n("f3/d");var l={name:"SettingsView",data:function(){var t={};for(var e in this.$ethingUI.plugins){var n=this.$ethingUI.plugins[e];n.schema&&(t[e]={error:!1,schema:n.schema})}return{loading:!0,saving:!1,error:!1,saveError:!1,settings:{},plugins:t,logLevels:[{label:"debug",value:"debug"},{label:"info",value:"info"},{label:"warning",value:"warning"},{label:"error",value:"error"},{label:"fatal",value:"fatal"}]}},computed:{globalError:function(){var t=this.error;if(!t)for(var e in this.plugins){this.plugins[e].error&&(t=!0);break}return t}},methods:{load:function(){var t=this;this.loading=!0,this.$ething.settings.get().then(function(e){for(var n in console.log(e),t.plugins)"undefined"==typeof e[n]&&(e[n]={});t.settings=e,t.loading=!1})},onSave:function(){var t=this,e=this.settings;console.log(e),this.saving=!0,this.saveError=!1,this.$ething.settings.set(e).catch(function(e){t.saveError=e}).finally(function(){t.saving=!1})}},mounted:function(){this.load()}},r=l,c=(n("u8Bd"),n("KHd+")),d=Object(c["a"])(r,o,s,!1,null,"2e39bdc7",null);d.options.__file="SettingsView.vue";var u=d.exports,g=function(){var t=this,e=t.$createElement,n=t._self._c||e;return!1===t.loading?n("div",[n("q-input",{staticClass:"inline",attrs:{placeholder:"filter","hide-underline":"",color:"secondary"},model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}}),n("q-select",{staticClass:"inline",attrs:{options:t.lengthOptions,suffix:"results",color:"secondary","hide-underline":""},model:{value:t.length,callback:function(e){t.length=e},expression:"length"}}),n("q-btn",{attrs:{color:"secondary",flat:"",icon:"refresh",label:"refresh"},on:{click:t.load}}),n("div",{staticClass:"column gutter-y-xs q-mt-sm"},t._l(t.logs,function(e,i){return n("div",{staticClass:"log row gutter-x-xs",class:e.cls,attrs:{keys:i}},[n("div",{staticClass:"date col-md-auto col-sm-4"},[t._v("\n        "+t._s(e.date)+"\n      ")]),n("div",{staticClass:"level col-md-1 col-sm-4"},[t._v("\n        "+t._s(e.level)+"\n      ")]),n("div",{staticClass:"level col-md-2 col-sm-4"},[t._v("\n        "+t._s(e.name)+"\n      ")]),n("div",{staticClass:"message col-md col-sm-12"},[t._v("\n        "+t._s(e.message)+"\n      ")])])}))],1):n("div",[t._v("loading ...")])},v=[];g._withStripped=!0;n("KKXr"),n("rGqo");var m={name:"LogView",data:function(){return{loading:!0,logs:[],filter:"",length:100,lengthOptions:[100,200,500,1e3].map(function(t){return{label:String(t),value:t}})}},methods:{load:function(){var t=this;this.loading=!0,this.$ething.request({url:"utils/read_log?line="+this.length+"&filter="+encodeURIComponent(this.filter),dataType:"json"}).then(function(e){t.logs=[],e.forEach(function(e){var n=e.split("::",4);if(4==n.length){var i=n[0].trim(),a=n[1].trim(),o=n[2].trim().toUpperCase(),s=n[3].trim();t.logs.push({date:i,name:a,level:o,cls:o.toLowerCase(),message:s})}else t.logs.length&&(t.logs[t.logs.length-1].message+="\n"+e)}),t.logs.reverse()}).finally(function(){t.loading=!1})}},mounted:function(){this.load()}},p=m,f=(n("hxHi"),Object(c["a"])(p,g,v,!1,null,"1923c293",null));f.options.__file="LogView.vue";var h=f.exports,_=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[!1===t.loading?n("div",[n("div",{staticClass:"q-my-md"},[n("q-btn",{attrs:{icon:"add",label:"new API key",rounded:"",color:"secondary"},on:{click:function(e){t.create()}}})],1),t.apikeys.length>0?n("div",[t._m(0),t._l(t.apikeys,function(e){return n("div",{key:e.id,staticClass:"item row items-center gutter-x-sm"},[n("div",{staticClass:"date col-xs-5 col-sm-4 col-md-3 text-faded ellipsis"},[t._v("\n          "+t._s(t.$ethingUI.utils.dateToString(e.modifiedDate))+"\n        ")]),n("div",{staticClass:"key col"},[t._v("\n          "+t._s(e.value)+"\n        ")]),n("div",{staticClass:"controls col-auto"},[n("q-btn",{attrs:{icon:"settings",round:"",flat:"",dense:"",color:"faded"},on:{click:function(n){t.edit(e)}}}),n("q-btn",{attrs:{icon:"delete",round:"",flat:"",dense:"",color:"negative"},on:{click:function(n){t.remove(e)}}})],1)])})],2):n("div",{staticClass:"absolute-center text-faded"},[t._v("No API keys")])]):n("div",[t._v("loading ...")]),n("modal",{attrs:{title:t.editing?"Edit API key":"Create a new API key",icon:"mdi-key","valid-btn-label":t.editing?"Edit":"Create","cancel-btn-label":"Cancel","valid-btn-disable":t.error||t.addLoading},on:{valid:t.add},model:{value:t.modal,callback:function(e){t.modal=e},expression:"modal"}},[n("form-schema",{attrs:{schema:t.schema},on:{error:function(e){t.error=e}},model:{value:t.model,callback:function(e){t.model=e},expression:"model"}}),t.serverError?n("q-alert",{staticClass:"q-mb-xl",attrs:{type:"negative"}},[t._v("\n      "+t._s(String(t.serverError))+"\n    ")]):t._e()],1)],1)},b=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"item row items-center gutter-x-sm"},[n("div",{staticClass:"date col-xs-5 col-sm-4 col-md-3 text-secondary ellipsis"},[t._v("\n          date\n        ")]),n("div",{staticClass:"key col text-secondary"},[t._v("\n          value\n        ")])])}];_._withStripped=!0;n("INYr"),n("91GP");var y={name:"ApikeyView",data:function(){return{loading:!0,apikeys:[],schema:{type:"object",additionalProperties:!1,required:["name"],properties:{name:{type:"string",minLength:1},scope:{type:"string",format:"scope",default:""}}},model:{},error:!1,modal:!1,addLoading:!1,serverError:!1,editing:!1}},methods:{load:function(){var t=this;this.loading=!0,EThing.request({url:"apikey",dataType:"json"}).then(function(e){t.apikeys=e,t.loading=!1}).catch(function(t){console.error(t)})},reset:function(){this.serverError=!1,this.error=!1,this.model={},this.editing=!1},add:function(){var t=this,e=Object.assign({},this.model);this.addLoading=!0,this.serverError=!1,console.log(e),EThing.request({method:this.editing?"PATCH":"POST",url:this.editing?"apikey/"+this.editing.id:"apikey",dataType:"json",data:e}).then(function(e){var n=t.apikeys||[];n.push(e),t.apikeys=n,t.modal=!1}).catch(function(e){t.serverError=e}).finally(function(){t.addLoading=!1})},create:function(){this.reset(),this.modal=!0},edit:function(t){this.reset(),this.model=Object.assign({},t),this.editing=t,this.modal=!0},remove:function(t){var e=this;EThing.request({method:"DELETE",url:"apikey/"+t.id}).then(function(){var n=e.apikeys.findIndex(function(e){return e.id===t.id});-1!==n&&e.apikeys.splice(n,1)}).catch(function(t){console.error(t)})}},mounted:function(){this.load()}},q=y,k=Object(c["a"])(q,_,b,!1,null,null,null);k.options.__file="ApikeyView.vue";var C=k.exports,x=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"layout"},[n("q-card",{staticClass:"q-ma-sm"},[n("q-card-title",[t._v("\n      Export\n      "),n("q-icon",{attrs:{slot:"right",name:"mdi-cloud-download"},slot:"right"})],1),n("q-card-main",[t._v("\n      Export all your data for backup.\n    ")]),n("q-card-separator"),n("q-card-actions",[n("q-btn",{attrs:{flat:"",loading:t.exportLoading},on:{click:t.do_export}},[t._v("Export")])],1)],1),n("q-card",{staticClass:"q-ma-sm"},[n("q-card-title",[t._v("\n      Import\n      "),n("q-icon",{attrs:{slot:"right",name:"mdi-cloud-upload"},slot:"right"})],1),n("q-card-main",[t._v("\n      Import data from a backup file.\n\n      "),n("div",{staticClass:"q-mt-md"},[n("input",{ref:"file",staticClass:"cursor-pointer",attrs:{type:"file",accept:".json"},on:{change:t.importFileChange}})])]),n("q-card-separator"),n("q-card-actions",[n("q-btn",{attrs:{flat:"",loading:t.importLoading},on:{click:function(e){t.confirm(t.do_import)}}},[t._v("Import")])],1)],1),n("q-card",{staticClass:"q-ma-sm"},[n("q-card-title",[t._v("\n      Clear\n      "),n("q-icon",{attrs:{slot:"right",name:"mdi-delete"},slot:"right"})],1),n("q-card-main",[t._v("\n      Clear all your data.\n    ")]),n("q-card-separator"),n("q-card-actions",[n("q-btn",{attrs:{flat:"",loading:t.clearLoading},on:{click:function(e){t.confirm(t.do_clear)}}},[t._v("Clear")])],1)],1)],1)},w=[];x._withStripped=!0;var E=n("dunZ"),S={name:"BackupView",data:function(){return{exportLoading:!1,importLoading:!1,importFileReadLoading:!1,importFile:null,clearLoading:!1}},methods:{do_export:function(){var t=this;this.exportLoading=!0,EThing.request({url:"utils/export",dataType:"json"}).then(function(t){E["a"].saveAs(t,"ething_data.json")}).catch(function(t){console.error(t)}).finally(function(){t.exportLoading=!1})},confirm:function(t){this.$q.dialog({title:"Are you sure ?",color:"primary",message:"All your data will be lost. Are you sure you want to proceed ?",ok:"OK",cancel:"Cancel"}).then(function(){t()}).catch(function(){})},do_import:function(){var t=this;this.importFile&&(this.importLoading=!0,EThing.request({method:"POST",url:"utils/import",data:this.importFile}).then(function(t){}).catch(function(t){console.error(t)}).finally(function(){t.importLoading=!1}))},do_clear:function(){var t=this;this.clearLoading=!0,EThing.request({url:"utils/reset"}).then(function(t){}).catch(function(t){console.error(t)}).finally(function(){t.clearLoading=!1})},importFileChange:function(t,e){var n=this;if(e=Array.prototype.slice.call(e||t.target.files),this.importFile=null,e&&e.length){var i=e[0];console.log(i),this.importFileReadLoading=!0;var a=new FileReader;a.onloadend=function(t){var e=a.result;console.log(e),n.importFileReadLoading=!1,n.importFile={content:e}},a.readAsText(i)}}}},L=S,I=(n("Rlhe"),Object(c["a"])(L,x,w,!1,null,"963e06c2",null));I.options.__file="BackupView.vue";var $=I.exports,V=function(){var t=this,e=t.$createElement,n=t._self._c||e;return!1===t.loading?n("div",[n("div",{staticClass:"layout"},t._l(t.plugins,function(e){return n("q-card",{key:e.name,staticClass:"q-ma-sm"},[n("q-card-title",[t._v("\n        "+t._s(e.name)+"\n        "),e.version?n("span",{attrs:{slot:"subtitle"},slot:"subtitle"},[t._v("version: "+t._s(e.version))]):t._e(),n("q-icon",{attrs:{slot:"right",name:"mdi-puzzle"},slot:"right"})],1),n("q-card-main",[t._v("\n        "+t._s(t.getPluginDescription(e))+"\n      ")]),n("q-card-separator"),n("q-card-actions",[n("q-btn",{attrs:{flat:"",loading:e.loading,color:e.loaded?"faded":"secondary"},on:{click:function(n){t.enableDisable(e)}}},[t._v(t._s(e.loaded?"Disable":"Enable"))])],1)],1)}))]):n("div",{staticClass:"absolute-center text-faded"},[t._v("loading ...")])},T=[];V._withStripped=!0;var j={name:"PluginsView",data:function(){var t=[];for(var e in this.$ethingUI.plugins)t.push(Object.assign({name:e,loaded:!1,loading:!1},this.$ethingUI.plugins[e]));return{plugins:t,loading:!1}},methods:{load:function(){var t=this;this.loading=!0,EThing.request({url:"plugin",dataType:"json"}).then(function(e){for(var n in e)for(var i in t.plugins){var a=t.plugins[i];if(a.name===n){a.loaded=!!e[n].loaded;break}}}).catch(function(t){console.error(t)}).finally(function(){t.loading=!1})},getPluginDescription:function(t){return t.description||t.schema&&t.schema.description||"no description"},enableDisable:function(t){t.loading=!0,EThing.request({method:"POST",url:"plugin/"+t.name+"/"+(t.loaded?"unload":"load"),dataType:"json"}).then(function(e){t.loaded=!!e.loaded}).catch(function(t){console.error(t)}).finally(function(){t.loading=!1})}},mounted:function(){this.load()}},O=j,P=(n("Bv2Z"),Object(c["a"])(O,V,T,!1,null,"2c310e23",null));P.options.__file="PluginsView.vue";var U=P.exports,A={name:"PageSettings",components:{SettingsView:u,LogView:h,ApikeyView:C,BackupView:$,PluginsView:U}},F=A,B=Object(c["a"])(F,i,a,!1,null,null,null);B.options.__file="Settings.vue";e["default"]=B.exports},u8Bd:function(t,e,n){"use strict";var i=n("HrpU"),a=n.n(i);a.a},xBp9:function(t,e,n){}}]);